<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="pingback" href="https://machinelearningmastery.com/xmlrpc.php" />

<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>

<!-- This site is optimized with the Yoast SEO plugin v9.0.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting</title>
<link rel="canonical" href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/" />
<link rel="publisher" href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/"/>
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting" />
<meta property="og:description" content="Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites. The EMC Data Science Global Hackathon dataset, or the &#8216;Air Quality &hellip;" />
<meta property="og:url" content="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/" />
<meta property="og:site_name" content="Machine Learning Mastery" />
<meta property="article:publisher" content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" />
<meta property="article:author" content="https://www.facebook.com/jason.brownlee.39" />
<meta property="article:section" content="Deep Learning for Time Series" />
<meta property="article:published_time" content="2018-10-14T18:00:09+00:00" />
<meta property="article:modified_time" content="2018-08-30T00:34:26+00:00" />
<meta property="og:updated_time" content="2018-08-30T00:34:26+00:00" />
<meta property="og:image" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median.png" />
<meta property="og:image:secure_url" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median.png" />
<meta property="og:image:width" content="1280" />
<meta property="og:image:height" content="960" />
<meta property="og:image:alt" content="MAE by Forecast Lead Time via Local Median" />
<script type='application/ld+json'>{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Feed" href="https://feeds.feedburner.com/MachineLearningMastery" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Comments Feed" href="https://machinelearningmastery.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting Comments Feed" href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style type="text/css" media="all">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link rel='stylesheet' id='crayon-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wpautoterms_css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.4' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-style-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-rrssb-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='woo-testimonials-css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='theme-stylesheet-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21' type='text/css' media='all' />
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8'></script>
<link rel='https://api.w.org/' href='https://machinelearningmastery.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://machinelearningmastery.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://machinelearningmastery.com/?p=6313' />
<link rel="alternate" type="application/json+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting%2F&#038;format=xml" />
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

    <script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>

<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>

<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css" />

<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css" />

<!-- Theme version -->
<meta name="generator" content="Canvas 5.9.21" />
<meta name="generator" content="WooFramework 6.2.9" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" sizes="32x32" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" />
<meta name="msapplication-TileImage" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" />
</head>
<body class="post-template-default single single-post postid-6313 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">

	<div id="inner-wrapper">

	<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>

	<header id="header" class="col-full">

		<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png" alt="Machine Learning Mastery" /></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
	    <div class="header-widget">
	        <div id="text-53" class="widget widget_text">			<div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
		</div><div id="search-3" class="widget widget_search"><div class="search_main">
    <form method="get" class="searchform" action="https://machinelearningmastery.com/" >
        <input type="text" class="field s" name="s" value="Search..." onfocus="if (this.value == 'Search...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search...';}" />
		<input type="hidden" name="post_type" value="post" />
        <button type="submit" class="fa fa-search submit" name="submit" value="Search"></button>
    </form>
    <div class="fix"></div>
</div></div>	    </div>
	
	</header>
	<nav id="navigation" class="col-full" role="navigation">

	
	<section class="menus">

		<a href="https://machinelearningmastery.com" class="nav-home"><span>Home</span></a>

	<h3>Main Menu</h3><ul id="main-nav" class="nav fl"><li id="menu-item-6503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li id="menu-item-6501" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li id="menu-item-6506" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
	<li id="menu-item-6508" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
	<li id="menu-item-6511" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
	<li id="menu-item-6509" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
	<li id="menu-item-6515" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
	<li id="menu-item-6512" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
	<li id="menu-item-6507" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
	<li id="menu-item-6513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
	<li id="menu-item-6516" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
	<li id="menu-item-6517" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
	<li id="menu-item-6522" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
	<li id="menu-item-6518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
	<li id="menu-item-6510" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
	<li id="menu-item-6519" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
	<li id="menu-item-6520" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
	<li id="menu-item-6523" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
	<li id="menu-item-6514" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li id="menu-item-6502" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li id="menu-item-6500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li id="menu-item-6504" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li id="menu-item-6505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul>	<div class="side-nav">
		</div><!-- /#side-nav -->

	</section><!-- /.menus -->

	<a href="#top" class="nav-close"><span>Return to Content</span></a>

</nav>
       
    <!-- #content Starts -->
	    <div id="content" class="col-full">
    
    	<div id="main-sidebar-container">    

            <!-- #main Starts -->
                        <section id="main">                       
<article class="post-6313 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
	<header>
	<h1 class="title entry-title">How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting</h1>	</header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" title="Posts by Jason Brownlee" rel="author">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-15T05:00:09+1100">October 15, 2018</abbr>  <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span>  </div>
	<section class="entry">
<p>Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites.</p>
<p>The EMC Data Science Global Hackathon dataset, or the &#8216;<em>Air Quality Prediction</em>&#8216; dataset for short, describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>An important first step when working with a new time series forecasting dataset is to develop a baseline in model performance by which the skill of all other more sophisticated strategies can be compared. Baseline forecasting strategies are simple and fast. They are referred to as &#8216;naive&#8217; strategies because they assume very little or nothing about the specific forecasting problem.</p>
<p>In this tutorial, you will discover how to develop naive forecasting methods for the multistep multivariate air pollution time series forecasting problem.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a test harness for evaluating forecasting strategies for the air pollution dataset.</li>
<li>How to develop global naive forecast strategies that use data from the entire training dataset.</li>
<li>How to develop local naive forecast strategies that use data from the specific interval that is being forecasted.</li>
</ul>
<p>Letâ€™s get started.</p>
<div id="attachment_6322" style="width: 650px" class="wp-caption aligncenter"><img class="size-full wp-image-6322" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Baseline-Forecasts-for-Multi-Site-Multivariate-Air-Pollution-Time-Series-Forecasting.jpg" alt="How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting" width="640" height="480" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Baseline-Forecasts-for-Multi-Site-Multivariate-Air-Pollution-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Baseline-Forecasts-for-Multi-Site-Multivariate-Air-Pollution-Time-Series-Forecasting-300x225.jpg 300w" sizes="(max-width: 640px) 100vw, 640px" /><p class="wp-caption-text">How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting<br />Photo by <a href="https://www.flickr.com/photos/zongo/38524476520/">DAVID HOLT</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into six parts; they are:</p>
<ul>
<li>Problem Description</li>
<li>Naive Methods</li>
<li>Model Evaluation</li>
<li>Global Naive Methods</li>
<li>Chunk Naive Methods</li>
<li>Summary of Results</li>
</ul>
<h2>Problem Description</h2>
<p>The Air Quality Prediction dataset describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>Specifically, weather observations such as temperature, pressure, wind speed, and wind direction are provided hourly for eight days for multiple sites. The objective is to predict air quality measurements for the next 3 days at multiple sites. The forecast lead times are not contiguous; instead, specific lead times must be forecast over the 72 hour forecast period. They are:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6af520681591" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6af520681591-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6af520681591-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Further, the dataset is divided into disjoint but contiguous chunks of data, with eight days of data followed by three days that require a forecast.</p>
<p>Not all observations are available at all sites or chunks and not all output variables are available at all sites and chunks. There are large portions of missing data that must be addressed.</p>
<p>The dataset was used as the basis for a <a href="https://www.kaggle.com/c/dsg-hackathon">short duration machine learning competition</a> (or hackathon) on the Kaggle website in 2012.</p>
<p>Submissions for the competition were evaluated against the true observations that were withheld from participants and scored using Mean Absolute Error (MAE). Submissions required the value of -1,000,000 to be specified in those cases where a forecast was not possible due to missing data. In fact, a template of where to insert missing values was provided and required to be adopted for all submissions (what a pain).</p>
<p>A winning entrant achieved a MAE of 0.21058 on the withheld test set (<a href="https://www.kaggle.com/c/dsg-hackathon/leaderboard">private leaderboard</a>) using random forest on lagged observations. A writeup of this solution is available in the post:</p>
<ul>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a>, 2012.</li>
</ul>
<p>In this tutorial, we will explore how to develop naive forecasts for the problem that can be used as a baseline to determine whether a model has skill on the problem or not.</p>
<p><div class="woo-sc-hr"></div></p>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" target="_blank" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;">Download Your FREE Mini-Course</a><script data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" data-config="%7B%7D" type="text/javascript" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js"></script></p>
</center>
<p><div class="woo-sc-hr"></div></p>
<h2>Naive Forecast Methods</h2>
<p>A baseline in forecast performance provides a point of comparison.</p>
<p>It is a point of reference for all other modeling techniques on your problem. If a model achieves performance at or below the baseline, the technique should be fixed or abandoned.</p>
<p>The technique used to generate a forecast to calculate the baseline performance must be easy to implement and naive of problem-specific details. The principle is that if a sophisticated forecast method cannot outperform a model that uses little or no problem-specific information, then it does not have skill.</p>
<p>There are problem-agnostic forecast methods that can and should be used first, followed by naive methods that use a modicum of problem-specific information.</p>
<p>Two examples of problem agnostic naive forecast methods that could be used include:</p>
<ul>
<li>Persist the last observed value for each series.</li>
<li>Forecast the average of observed values for each series.</li>
</ul>
<p>The data is divided into chunks, or intervals, of time. Each chunk of time has multiple variables at multiple sites to forecast. The persistence forecast method makes sense at this chunk-level of organization of the data.</p>
<p>Other persistence methods could be explored; for example:</p>
<ul>
<li>Forecast observations from the previous day for the next three days for each series.</li>
<li>Forecast observations from the previous three days for the next three days for each series.</li>
</ul>
<p>These are desirable baseline methods to explore, but the large amount of missing data and discontiguous structure of most of the data chunks make them challenging to implement without non-trivial data preparation.</p>
<p>Forecasting the average observations for each series can be elaborated further; for example:</p>
<ul>
<li>Forecast the global (across-chunk) average value for each series.</li>
<li>Forecast the local (within-chunk) average value for each series.</li>
</ul>
<p>A three-day forecast is required for each series with different start-times, e.g. times of day. As such, the forecast lead times for each chunk will fall on different hours of the day.</p>
<p>A further elaboration of forecasting the average value is to incorporate the hour of day that is being forecasted; for example:</p>
<ul>
<li>Forecast the global (across-chunk) average value for the hour of day for each forecast lead time.</li>
<li>Forecast the local (within-chunk) average value for the hour of day for each forecast lead time.</li>
</ul>
<p>Many variables are measured at multiple sites; as such, it may be possible to use information across series, such as in the calculation of averages or averages per hour of day for forecast lead times. These are interesting, but may exceed the mandate of naive.</p>
<p>This is a good starting point, although there may be further elaborations of the naive methods that you may want to consider and explore as an exercise. Remember, the goal is to use very little problem specific information in order to develop a forecast baseline.</p>
<p>In summary, we will investigate five different naive forecasting methods for this problem, the best of which will provide a lower-bound on performance by which other models can be compared. They are:</p>
<ol>
<li>Global Average Value per Series</li>
<li>Global Average Value for Forecast Lead Time per Series</li>
<li>Local Persisted Value per Series</li>
<li>Local Average Value per Series</li>
<li>Local Average Value for Forecast Lead Time per Series</li>
</ol>
<h2>Model Evaluation</h2>
<p>Before we can evaluate naive forecasting methods, we must develop a test harness.</p>
<p>This includes at least how the data will be prepared and how forecasts will be evaluated.</p>
<h3>Load Dataset</h3>
<p>The first step is to download the dataset and load it into memory.</p>
<p>The dataset can be downloaded for free from the Kaggle website. You may have to create an account and log in, in order to be able to download the dataset.</p>
<p>Download the entire dataset, e.g. &#8220;<em>Download All</em>&#8221; to your workstation and unzip the archive in your current working directory with the folder named &#8216;<em>AirQualityPrediction</em>&#8216;.</p>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction) Data</a></li>
</ul>
<p>Our focus will be the &#8216;<em>TrainingData.csv</em>&#8216; file that contains the training dataset, specifically data in chunks where each chunk is eight contiguous days of observations and target variables.</p>
<p>We can load the data file into memory using the Pandas <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv() function</a> and specify the header row on line 0.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6c0754310789" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6c0754310789-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c0754310789-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6c0754310789-1"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c0754310789-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can group data by the &#8216;chunkID&#8217; variable (column index 1).</p>
<p>First, let&#8217;s get a list of the unique chunk identifiers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6c3220822821" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
chunk_ids = unique(values[:, 1])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6c3220822821-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6c3220822821-1"><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can then collect all rows for each chunk identifier and store them in a dictionary for easy access.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6c5494321502" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
chunks = dict()
# sort rows by chunk id
for chunk_id in chunk_ids:
	selection = values[:, chunk_ix] == chunk_id
	chunks[chunk_id] = values[selection, :]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6c5494321502-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c5494321502-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c5494321502-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c5494321502-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c5494321502-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6c5494321502-1"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c5494321502-2"><span class="crayon-p"># sort rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c5494321502-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c5494321502-4"><span class="crayon-h">	</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c5494321502-5"><span class="crayon-e">	</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Below defines a function named <em>to_chunks()</em> that takes a NumPy array of the loaded data and returns a dictionary of <em>chunk_id</em> to rows for the chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6c8413320601" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6c8413320601-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c8413320601-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c8413320601-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c8413320601-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c8413320601-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c8413320601-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c8413320601-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c8413320601-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6c8413320601-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6c8413320601-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6c8413320601-1"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c8413320601-2"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c8413320601-3"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c8413320601-4"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c8413320601-5"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c8413320601-6"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c8413320601-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c8413320601-8"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6c8413320601-9"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6c8413320601-10"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>The complete example that loads the dataset and splits it into chunks is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6ca361617113" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load data and split into chunks
from numpy import unique
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
print('Total Chunks: %d' % len(chunks))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ca361617113-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ca361617113-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-1"><span class="crayon-p"># load data and split into chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-4">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-5"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-6"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-7"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-8"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-9"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-10"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-11"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-12"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-13"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-16"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-17"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-18"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-19"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ca361617113-20"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ca361617113-21"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total Chunks: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Running the example prints the number of chunks in the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6cc533237596" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Total Chunks: 208</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6cc533237596-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6cc533237596-1">Total Chunks: 208</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Data Preparation</h3>
<p>Now that we know how to load the data and split it into chunks, we can separate into train and test datasets.</p>
<p>Each chunk covers an interval of eight days of hourly observations, although the number of actual observations within each chunk may vary widely.</p>
<p>We can split each chunk into the first five days of observations for training and the last three for test.</p>
<p>Each observation has a row called &#8216;<em>position_within_chunk</em>&#8216; that varies from 1 to 192 (8 days * 24 hours). We can therefore take all rows with a value in this column that is less than or equal to 120 (5 * 24) as training data and any values more than 120 as test data.</p>
<p>Further, any chunks that don&#8217;t have any observations in the train or test split can be dropped as not viable.</p>
<p>When working with the naive models, we are only interested in the target variables, and none of the input meteorological variables. Therefore, we can remove the input data and have the train and test data only comprised of the 39 target variables for each chunk, as well as the position within chunk and hour of observation.</p>
<p>The <em>split_train_test()</em> function below implements this behavior; given a dictionary of chunks, it will split each into a list of train and test chunk data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6cf157071497" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6cf157071497-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6cf157071497-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-1"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-2"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-3"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-4"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-5"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-8"><span class="crayon-h">		</span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-9"><span class="crayon-h">		</span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-10"><span class="crayon-h">		</span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-12"><span class="crayon-h">			</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-13"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-14"><span class="crayon-h">		</span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-15"><span class="crayon-h">		</span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-16"><span class="crayon-h">		</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6cf157071497-17"><span class="crayon-h">		</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6cf157071497-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>We do not require the entire test dataset; instead, we only require the observations at specific lead times over the three day period, specifically the lead times:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6d2504638061" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6d2504638061-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6d2504638061-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Where, each lead time is relative to the end of the training period.</p>
<p>First, we can put these lead times into a function for easy reference:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6d5661575923" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6d5661575923-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d5661575923-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d5661575923-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6d5661575923-1"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d5661575923-2"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d5661575923-3"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Next, we can reduce the test dataset down to just the data at the preferred lead times.</p>
<p>We can do that by looking at the &#8216;<em>position_within_chunk</em>&#8216; column and using the lead time as an offset from the end of the training dataset, e.g. 120 + 1, 120 +2, etc.</p>
<p>If we find a matching row in the test set, it is saved, otherwise a row of NaN observations is generated.</p>
<p>The function <em>to_forecasts()</em> below implements this and returns a NumPy array with one row for each forecast lead time for each chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6d7798958583" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6d7798958583-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b6d7798958583-25">25</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-1"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-2"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-3"><span class="crayon-h">	</span><span class="crayon-p"># get lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-4"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-5"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-6"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-7"><span class="crayon-h">	</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-8"><span class="crayon-h">	</span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-9"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-10"><span class="crayon-h">		</span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-11"><span class="crayon-h">		</span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-12"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-13"><span class="crayon-h">			</span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-14"><span class="crayon-h">			</span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-15"><span class="crayon-h">			</span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-16"><span class="crayon-h">			</span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-17"><span class="crayon-h">			</span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-18"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-19"><span class="crayon-h">				</span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-20"><span class="crayon-h">				</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-21"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-22"><span class="crayon-h">			</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-23"><span class="crayon-h">				</span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6d7798958583-24"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6d7798958583-25"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We can tie all of this together and split the dataset into train and test sets and save the results to new files.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6da792664137" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split data into train and test sets
from numpy import unique
from numpy import nan
from numpy import array
from numpy import savetxt
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]

# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
# split into train/test
train, test = split_train_test(chunks)
# flatten training chunks to rows
train_rows = array([row for rows in train for row in rows])
# print(train_rows.shape)
print('Train Rows: %s' % str(train_rows.shape))
# reduce train to forecast lead times only
test_rows = to_forecasts(test)
print('Test Rows: %s' % str(test_rows.shape))
# save datasets
savetxt('AirQualityPrediction/naive_train.csv', train_rows, delimiter=',')
savetxt('AirQualityPrediction/naive_test.csv', test_rows, delimiter=',')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b6da792664137-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6da792664137-84">84</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-1"><span class="crayon-p"># split data into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">savetxt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-8"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-9"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-10"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-11"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-12"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-13"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-14"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-15"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-16"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-18">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-19"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-20"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-21"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-22"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-23"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-24"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-25"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-26"><span class="crayon-h">		</span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-27"><span class="crayon-h">		</span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-28"><span class="crayon-h">		</span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-29"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-30"><span class="crayon-h">			</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-31"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-32"><span class="crayon-h">		</span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-33"><span class="crayon-h">		</span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-34"><span class="crayon-h">		</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-35"><span class="crayon-h">		</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-38"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-39"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-40"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-42"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-43"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-44"><span class="crayon-h">	</span><span class="crayon-p"># get lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-45"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-46"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-47"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-48"><span class="crayon-h">	</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-49"><span class="crayon-h">	</span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-50"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-51"><span class="crayon-h">		</span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-52"><span class="crayon-h">		</span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-53"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-54"><span class="crayon-h">			</span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-55"><span class="crayon-h">			</span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-56"><span class="crayon-h">			</span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-57"><span class="crayon-h">			</span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-58"><span class="crayon-h">			</span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-59"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-60"><span class="crayon-h">				</span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-61"><span class="crayon-h">				</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-62"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-63"><span class="crayon-h">			</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-64"><span class="crayon-h">				</span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-65"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-66"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-67">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-68"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-69"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-70"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-71"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-72"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-73"><span class="crayon-p"># split into train/test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-74"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-75"><span class="crayon-p"># flatten training chunks to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-76"><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">row </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">train </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-77"><span class="crayon-p"># print(train_rows.shape)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-78"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-79"><span class="crayon-p"># reduce train to forecast lead times only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-80"><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-81"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-82"><span class="crayon-p"># save datasets</span></div><div class="crayon-line" id="crayon-5bd2bf145b6da792664137-83"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6da792664137-84"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>Running the example first comments that chunk 69 is removed from the dataset for having insufficient data.</p>
<p>We can then see that we have 42 columns in each of the train and test sets, one for the chunk id, position within chunk, hour of day, and the 39 training variables.</p>
<p>We can also see the dramatically smaller version of the test dataset with rows only at the forecast lead times.</p>
<p>The new train and test datasets are saved in the &#8216;<em>naive_train.csv</em>&#8216; and &#8216;<em>naive_test.csv</em>&#8216; files respectively.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6df871507464" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&gt;dropping chunk=69: train=(0, 95), test=(28, 95)
Train Rows: (23514, 42)
Test Rows: (2070, 42)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6df871507464-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6df871507464-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6df871507464-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6df871507464-1">&gt;dropping chunk=69: train=(0, 95), test=(28, 95)</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6df871507464-2">Train Rows: (23514, 42)</div><div class="crayon-line" id="crayon-5bd2bf145b6df871507464-3">Test Rows: (2070, 42)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Forecast Evaluation</h3>
<p>Once forecasts have been made, they need to be evaluated.</p>
<p>It is helpful to have a simpler format when evaluating forecasts. For example, we will use the three-dimensional structure of <em>[chunks][variables][time]</em>, where variable is the target variable number from 0 to 38 and time is the lead time index from 0 to 9.</p>
<p>Models are expected to make predictions in this format.</p>
<p>We can also restructure the test dataset to have this dataset for comparison. The <em>prepare_test_forecasts()</em> function below implements this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6e1989649104" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e1989649104-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e1989649104-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-1"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-2"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-3"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-4"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-6"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-7"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-8"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-9"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-10"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-11"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e1989649104-12"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e1989649104-13"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We will evaluate a model using the mean absolute error, or MAE. This is the metric that was used in the competition and is a sensible choice given the non-Gaussian distribution of the target variables.</p>
<p>If a lead time contains no data in the test set (e.g. <em>NaN</em>), then no error will be calculated for that forecast. If the lead time does have data in the test set but no data in the forecast, then the full magnitude of the observation will be taken as error. Finally, if the test set has an observation and a forecast was made, then the absolute difference will be recorded as the error.</p>
<p>The <em>calculate_error()</em> function implements these rules and returns the error for a given forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6e4550373711" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6e4550373711-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e4550373711-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e4550373711-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e4550373711-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e4550373711-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6e4550373711-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6e4550373711-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6e4550373711-1"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e4550373711-2"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e4550373711-3"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e4550373711-4"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e4550373711-5"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6e4550373711-6"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf145b6e4550373711-7"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Errors are summed across all chunks and all lead times, then averaged.</p>
<p>The overall MAE will be calculated, but we will also calculate a MAE for each forecast lead time. This can help with model selection generally as some models may perform differently at different lead times.</p>
<p>The evaluate_forecasts() function below implements this, calculating the MAE and per-lead time MAE for the provided predictions and expected values in <em>[chunk][variable][time]</em> format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6ed985434687" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b6ed985434687-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6ed985434687-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-1"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-3"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-4"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-5"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-8"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-9"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-10"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-11"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-12"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-13"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-14"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-15"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-16"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-17"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-18"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-19"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-20"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-21"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-22"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-23"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-24"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-25"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-26"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf145b6ed985434687-27"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6ed985434687-28"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>Once we have the evaluation of a model, we can present it.</p>
<p>The <em>summarize_error()</em> function below first prints a one-line summary of a model&#8217;s performance then creates a plot of MAE per forecast lead time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6f0040320732" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6f0040320732-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f0040320732-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f0040320732-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f0040320732-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f0040320732-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f0040320732-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f0040320732-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f0040320732-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f0040320732-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f0040320732-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6f0040320732-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f0040320732-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f0040320732-3"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f0040320732-4"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f0040320732-5"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f0040320732-6"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f0040320732-7"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f0040320732-8"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f0040320732-9"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f0040320732-10"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We are now ready to start exploring the performance of naive forecasting methods.</p>
<h2>Global Naive Methods</h2>
<p>In this section, we will explore naive forecast methods that use all data in the training dataset, not constrained to the chunk for which we are making a prediction.</p>
<p>We will look at two approaches:</p>
<ul>
<li>Forecast Average Value per Series</li>
<li>Forecast Average Value for Hour-of-Day per Series</li>
</ul>
<h3>Forecast Average Value per Series</h3>
<p>The first step is to implement a general function for making a forecast for each chunk.</p>
<p>The function takes the training dataset and the input columns (chunk id, position in chunk, and hour) for the test set and returns forecasts for all chunks with the expected 3D format of <em>[chunk][variable][time]</em>.</p>
<p>The function enumerates the chunks in the forecast, then enumerates the 39 target columns, calling another new function named <em>forecast_variable()</em> in order to make a prediction for each lead time for a given target variable.</p>
<p>The complete function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6f4806679598" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6f4806679598-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6f4806679598-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-1"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-3"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-4"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-5"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-6"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-7"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-8"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-9"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-10"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-11"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-12"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6f4806679598-13"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6f4806679598-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We can now implement a version of the <em>forecast_variable()</em> that calculates the mean for a given series and forecasts that mean for each lead time.</p>
<p>First, we must collect all observations in the target column across all chunks, then calculate the average of the observations while also ignoring the NaN values. The <em>nanmean()</em> NumPy function will calculate the mean of an array and ignore <em>NaN</em> values.</p>
<p>The <em>forecast_variable()</em> function below implements this behavior.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6fb198715775" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# collect obs from all chunks
	all_obs = list()
	for chunk in train_chunks:
		all_obs += [x for x in chunk[:, col_ix]]
	# return the average, ignoring nan
	value = nanmean(all_obs)
	return [value for _ in lead_times]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fb198715775-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fb198715775-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fb198715775-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fb198715775-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fb198715775-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fb198715775-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fb198715775-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-3"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fb198715775-4"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-5"><span class="crayon-h">	</span><span class="crayon-p"># collect obs from all chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fb198715775-6"><span class="crayon-h">	</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fb198715775-8"><span class="crayon-h">		</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-9"><span class="crayon-h">	</span><span class="crayon-p"># return the average, ignoring nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fb198715775-10"><span class="crayon-h">	</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmean</span><span class="crayon-sy">(</span><span class="crayon-v">all_obs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fb198715775-11"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">value </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We now have everything we need.</p>
<p>The complete example of forecasting the global mean for each series across all forecast lead times is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b6fe006229534" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast global mean
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmean
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# collect obs from all chunks
	all_obs = list()
	for chunk in train_chunks:
		all_obs += [x for x in chunk[:, col_ix]]
	# return the average, ignoring nan
	value = nanmean(all_obs)
	return [value for _ in lead_times]

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Global Mean', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b6fe006229534-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b6fe006229534-128">128</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-1"><span class="crayon-p"># forecast global mean</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmean</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-26"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-27"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-28"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-29"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-30"><span class="crayon-h">	</span><span class="crayon-p"># collect obs from all chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-31"><span class="crayon-h">	</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-32"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-33"><span class="crayon-h">		</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-34"><span class="crayon-h">	</span><span class="crayon-p"># return the average, ignoring nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-35"><span class="crayon-h">	</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmean</span><span class="crayon-sy">(</span><span class="crayon-v">all_obs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">value </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-38"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-39"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-40"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-41"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-42"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-43"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-44"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-45"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-46"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-47"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-48"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-49"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-50"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-51"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-52">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-53"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-54"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-55"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-56"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-57"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-58"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-59"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-60"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-61"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-62"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-63"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-64"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-65"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-66">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-67"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-68"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-69"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-70"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-71"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-72"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-73"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-74">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-75"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-76"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-77"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-78"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-79"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-80"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-81"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-82"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-83"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-84"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-85"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-86"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-87"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-88"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-89"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-90"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-91"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-92"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-93"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-94"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-95"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-96"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-97"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-98"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-99"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-100"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-101"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-102"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-103">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-104"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-105"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-106"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-107"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-108"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-109"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-110"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-111"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-112"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-113"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-114">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-115"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-116"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-117"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-118"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-119"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-120"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-121"><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-122"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-123"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-124"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-125"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-126"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b6fe006229534-127"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b6fe006229534-128"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Global Mean'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0085 seconds] -->
<p>Running the example first prints the overall MAE of 0.634, followed by the MAE scores for each forecast lead time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b704627392046" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# Global Mean: [0.634 MAE] +1 0.635, +2 0.629, +3 0.638, +4 0.650, +5 0.649, +10 0.635, +17 0.634, +24 0.641, +48 0.613, +72 0.618</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b704627392046-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b704627392046-1"># Global Mean: [0.634 MAE] +1 0.635, +2 0.629, +3 0.638, +4 0.650, +5 0.649, +10 0.635, +17 0.634, +24 0.641, +48 0.613, +72 0.618</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot is created showing the MAE scores for each forecast lead time from +1 hour to +72 hours.</p>
<p>We cannot see any obvious relationship in forecast lead time to forecast error as we might expect with a more skillful model.</p>
<div id="attachment_6314" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6314" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Mean.png" alt="MAE by Forecast Lead Time With Global Mean" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Mean.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Mean-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Mean-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Mean-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time With Global Mean</p></div>
<p>We can update the example to forecast the global median instead of the mean.</p>
<p>The median may make more sense to use as a central tendency than the mean for this data given the non-Gaussian like distribution the data seems to show.</p>
<p>NumPy provides the <em>nanmedian()</em> function that we can use in place of <em>nanmean()</em> in the <em>forecast_variable()</em> function.</p>
<p>The complete updated example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b707495624507" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast global median
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# collect obs from all chunks
	all_obs = list()
	for chunk in train_chunks:
		all_obs += [x for x in chunk[:, col_ix]]
	# return the average, ignoring nan
	value = nanmedian(all_obs)
	return [value for _ in lead_times]

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Global Median', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b707495624507-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b707495624507-128">128</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b707495624507-1"><span class="crayon-p"># forecast global median</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-26"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-27"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-28"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-29"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-30"><span class="crayon-h">	</span><span class="crayon-p"># collect obs from all chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-31"><span class="crayon-h">	</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-32"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-33"><span class="crayon-h">		</span><span class="crayon-v">all_obs</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-34"><span class="crayon-h">	</span><span class="crayon-p"># return the average, ignoring nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-35"><span class="crayon-h">	</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_obs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">value </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-38"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-39"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-40"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-41"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-42"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-43"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-44"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-45"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-46"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-47"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-48"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-49"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-50"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-51"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-52">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-53"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-54"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-55"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-56"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-57"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-58"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-59"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-60"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-61"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-62"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-63"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-64"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-65"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-66">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-67"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-68"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-69"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-70"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-71"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-72"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-73"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-74">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-75"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-76"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-77"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-78"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-79"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-80"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-81"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-82"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-83"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-84"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-85"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-86"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-87"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-88"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-89"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-90"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-91"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-92"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-93"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-94"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-95"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-96"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-97"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-98"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-99"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-100"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-101"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-102"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-103">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-104"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-105"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-106"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-107"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-108"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-109"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-110"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-111"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-112"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-113"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-114">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-115"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-116"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-117"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-118"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-119"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-120"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-121"><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-122"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-123"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-124"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-125"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-126"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b707495624507-127"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b707495624507-128"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Global Median'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0085 seconds] -->
<p>Running the example shows a drop in MAE to about 0.59, suggesting that indeed using the median as the central tendency may be a better baseline strategy.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b70e865541684" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Global Median: [0.598 MAE] +1 0.601, +2 0.594, +3 0.600, +4 0.611, +5 0.615, +10 0.594, +17 0.592, +24 0.602, +48 0.585, +72 0.580</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b70e865541684-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b70e865541684-1">Global Median: [0.598 MAE] +1 0.601, +2 0.594, +3 0.600, +4 0.611, +5 0.615, +10 0.594, +17 0.592, +24 0.602, +48 0.585, +72 0.580</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of MAE per lead time is also created.</p>
<div id="attachment_6315" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6315" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median.png" alt="MAE by Forecast Lead Time With Global Median" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time With Global Median</p></div>
<h3>Forecast Average Value for Hour-of-Day per Series</h3>
<p>We can update the naive model for calculating a central tendency by series to only include rows that have the same hour of day as the forecast lead time.</p>
<p>For example, if the +1 lead time has the hour 6 (e.g. 0600 or 6AM), then we can find all other rows in the training dataset across all chunks for that hour and calculate the median value for a given target variable from those rows.</p>
<p>We record the hour of day on the test dataset and make it available to the model when making forecasts. One wrinkle is that in some cases the test dataset did not have a record for a given lead time and one had to be invented with <em>NaN</em> values, including a <em>NaN</em> value for the hour. In these cases, no forecast is required so we will skip them and forecast a <em>NaN</em> value.</p>
<p>The <em>forecast_variable()</em> function below implements this behavior, returning forecasts for each lead time for a given variable.</p>
<p>It is not very efficient, and it might be a lot more efficient to pre-calculate the median values for each hour for each variable first and then forecast using a lookup table. Efficiency is not a concern at this point as we are looking for a baseline of model performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b712880768418" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	forecast = list()
	# convert target number into column number
	col_ix = 3 + target_ix
	# enumerate lead times
	for i in range(len(lead_times)):
		# get the hour for this forecast lead time
		hour = chunk_test[i, 2]
		# check for no test data
		if isnan(hour):
			forecast.append(nan)
			continue
		# get all rows in training for this hour
		all_rows = list()
		for rows in train_chunks:
			[all_rows.append(row) for row in rows[rows[:,2]==hour]]
		# calculate the central tendency for target
		all_rows = array(all_rows)
		value = nanmedian(all_rows[:, col_ix])
		forecast.append(value)
	return forecast</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b712880768418-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b712880768418-22">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b712880768418-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-3"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-4"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-5"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-8"><span class="crayon-h">		</span><span class="crayon-p"># get the hour for this forecast lead time</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-9"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-10"><span class="crayon-h">		</span><span class="crayon-p"># check for no test data</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hour</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-12"><span class="crayon-h">			</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">nan</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-13"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-14"><span class="crayon-h">		</span><span class="crayon-p"># get all rows in training for this hour</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-15"><span class="crayon-h">		</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-16"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-17"><span class="crayon-h">			</span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hour</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-18"><span class="crayon-h">		</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-19"><span class="crayon-h">		</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-20"><span class="crayon-h">		</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b712880768418-21"><span class="crayon-h">		</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b712880768418-22"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>The complete example of forecasting the global median value by hour of the day across is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b715194061577" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast global median by hour of day
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	forecast = list()
	# convert target number into column number
	col_ix = 3 + target_ix
	# enumerate lead times
	for i in range(len(lead_times)):
		# get the hour for this forecast lead time
		hour = chunk_test[i, 2]
		# check for no test data
		if isnan(hour):
			forecast.append(nan)
			continue
		# get all rows in training for this hour
		all_rows = list()
		for rows in train_chunks:
			[all_rows.append(row) for row in rows[rows[:,2]==hour]]
		# calculate the central tendency for target
		all_rows = array(all_rows)
		value = nanmedian(all_rows[:, col_ix])
		forecast.append(value)
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Global Median by Hour', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b715194061577-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf145b715194061577-139">139</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b715194061577-1"><span class="crayon-p"># forecast global median by hour of day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-26"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-27"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-28"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-29"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-30"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-31"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-32"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-33"><span class="crayon-h">		</span><span class="crayon-p"># get the hour for this forecast lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-34"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-35"><span class="crayon-h">		</span><span class="crayon-p"># check for no test data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-36"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hour</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-37"><span class="crayon-h">			</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">nan</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-38"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-39"><span class="crayon-h">		</span><span class="crayon-p"># get all rows in training for this hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-40"><span class="crayon-h">		</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-41"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-42"><span class="crayon-h">			</span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hour</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-43"><span class="crayon-h">		</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-44"><span class="crayon-h">		</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-45"><span class="crayon-h">		</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-46"><span class="crayon-h">		</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-47"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-48">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-49"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-50"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-51"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-52"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-53"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-54"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-55"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-56"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-57"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-58"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-59"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-60"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-61"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-62"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-63">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-64"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-65"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-66"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-67"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-68"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-69"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-70"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-71"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-72"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-73"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-74"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-75"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-76"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-77">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-78"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-79"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-80"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-81"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-82"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-83"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-84"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-85">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-86"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-87"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-88"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-89"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-90"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-91"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-92"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-93"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-94"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-95"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-96"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-97"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-98"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-99"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-100"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-101"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-102"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-103"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-104"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-105"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-106"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-107"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-108"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-109"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-110"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-111"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-112"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-113"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-114">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-115"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-116"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-117"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-118"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-119"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-120"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-121"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-122"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-123"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-124"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-125">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-126"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-127"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-128"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-129"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-130"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-131"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-132"><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-133"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-134"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-135"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-136"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-137"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b715194061577-138"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b715194061577-139"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Global Median by Hour'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0094 seconds] -->
<p>Running the example summarizes the performance of the model with a MAE of 0.567, which is an improvement over the global median for each series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b71b101652250" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Global Median by Hour: [0.567 MAE] +1 0.573, +2 0.565, +3 0.567, +4 0.579, +5 0.589, +10 0.559, +17 0.565, +24 0.567, +48 0.558, +72 0.551</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b71b101652250-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b71b101652250-1">Global Median by Hour: [0.567 MAE] +1 0.573, +2 0.565, +3 0.567, +4 0.579, +5 0.589, +10 0.559, +17 0.565, +24 0.567, +48 0.558, +72 0.551</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the MAE by forecast lead time is also created showing that +72 had the lowest overall forecast error. This is interesting, and may suggest that hour-based information may be useful in more sophisticated models.</p>
<div id="attachment_6316" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6316" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-By-Hour-of-Day.png" alt="MAE by Forecast Lead Time With Global Median By Hour of Day" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-By-Hour-of-Day.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-By-Hour-of-Day-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-By-Hour-of-Day-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-With-Global-Median-By-Hour-of-Day-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time With Global Median By Hour of Day</p></div>
<h2>Chunk Naive Methods</h2>
<p>It is possible that using information specific to the chunk may have more predictive power than using global information from the entire training dataset.</p>
<p>We can explore this with three local or chunk-specific naive forecasting methods; they are:</p>
<ul>
<li>Forecast Last Observation per Series</li>
<li>Forecast Average Value per Series</li>
<li>Forecast Average Value for Hour-of-Day per Series</li>
</ul>
<p>The last two of which are the chunk-specific version of the global strategies that were evaluated in the previous section.</p>
<h3>Forecast Last Observation per Series</h3>
<p>Forecasting the last non-NaN observation for a chunk is perhaps the simplest model, classically called the persistence model or the naive model.</p>
<p>The <em>forecast_variable()</em> function below implements this forecast strategy.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b720475568947" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# extract the history for the series
	history = chunk_train[:, col_ix]
	# persist a nan if we do not find any valid data
	persisted = nan
	# enumerate history in verse order looking for the first non-nan
	for value in reversed(history):
		if not isnan(value):
			persisted = value
			break
	# persist the same value for all lead times
	forecast = [persisted for _ in range(len(lead_times))]
	return forecast</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b720475568947-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b720475568947-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b720475568947-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-3"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-4"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-5"><span class="crayon-h">	</span><span class="crayon-p"># extract the history for the series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-6"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-7"><span class="crayon-h">	</span><span class="crayon-p"># persist a nan if we do not find any valid data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-8"><span class="crayon-h">	</span><span class="crayon-v">persisted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-9"><span class="crayon-h">	</span><span class="crayon-p"># enumerate history in verse order looking for the first non-nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-10"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">reversed</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-12"><span class="crayon-h">			</span><span class="crayon-v">persisted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">value</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-13"><span class="crayon-e">			</span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-14"><span class="crayon-h">	</span><span class="crayon-p"># persist the same value for all lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b720475568947-15"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">persisted </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b720475568947-16"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>The complete example for evaluating the persistence forecast strategy on the test set is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b722010773017" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# persist last observation
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# extract the history for the series
	history = chunk_train[:, col_ix]
	# persist a nan if we do not find any valid data
	persisted = nan
	# enumerate history in verse order looking for the first non-nan
	for value in reversed(history):
		if not isnan(value):
			persisted = value
			break
	# persist the same value for all lead times
	forecast = [persisted for _ in range(len(lead_times))]
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Persistence', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b722010773017-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf145b722010773017-133">133</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b722010773017-1"><span class="crayon-p"># persist last observation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-26"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-27"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-28"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-29"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-30"><span class="crayon-h">	</span><span class="crayon-p"># extract the history for the series</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-31"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-32"><span class="crayon-h">	</span><span class="crayon-p"># persist a nan if we do not find any valid data</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-33"><span class="crayon-h">	</span><span class="crayon-v">persisted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-34"><span class="crayon-h">	</span><span class="crayon-p"># enumerate history in verse order looking for the first non-nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-35"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">reversed</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-36"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-37"><span class="crayon-h">			</span><span class="crayon-v">persisted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-38"><span class="crayon-e">			</span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-39"><span class="crayon-h">	</span><span class="crayon-p"># persist the same value for all lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-40"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">persisted </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-41"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-42">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-43"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-44"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-45"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-46"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-47"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-48"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-49"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-50"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-51"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-52"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-53"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-54"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-55"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-56"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-57">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-58"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-59"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-60"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-61"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-62"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-63"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-64"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-65"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-66"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-67"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-68"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-69"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-70"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-72"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-73"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-74"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-75"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-76"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-77"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-78"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-79">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-80"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-81"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-82"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-83"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-84"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-85"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-86"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-87"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-88"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-89"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-90"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-91"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-92"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-93"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-94"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-95"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-96"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-97"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-98"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-99"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-100"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-101"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-102"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-103"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-104"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-105"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-106"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-107"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-108">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-109"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-110"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-111"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-112"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-113"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-114"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-115"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-116"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-117"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-118"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-119">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-120"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-121"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-122"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-123"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-124"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-125"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-126"><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-127"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-128"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-129"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-130"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-131"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b722010773017-132"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b722010773017-133"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Persistence'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>Running the example prints the overall MAE and the MAE per forecast lead time.</p>
<p>We can see that the persistence forecast appears to out-perform all of the global strategies evaluated in the previous section.</p>
<p>This adds some support that the reasonable assumption that chunk-specific information is important in modeling this problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b729087453394" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Persistence: [0.520 MAE] +1 0.217, +2 0.330, +3 0.400, +4 0.471, +5 0.515, +10 0.648, +17 0.656, +24 0.589, +48 0.671, +72 0.708</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b729087453394-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b729087453394-1">Persistence: [0.520 MAE] +1 0.217, +2 0.330, +3 0.400, +4 0.471, +5 0.515, +10 0.648, +17 0.656, +24 0.589, +48 0.671, +72 0.708</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of MAE per forecast lead time is created.</p>
<p>Importantly, this plot shows the expected behavior of increasing error with the increase in forecast lead time. Namely, the further one predicts into the future, the more challenging it is, and in turn, the more error one would be expected to make.</p>
<div id="attachment_6317" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6317" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Persistence.png" alt="MAE by Forecast Lead Time via Persistence" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Persistence.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Persistence-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Persistence-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Persistence-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time via Persistence</p></div>
<h3>Forecast Average Value per Series</h3>
<p>Instead of persisting the last observation for the series, we can persist the average value for the series using only the data in the chunk.</p>
<p>Specifically, we can calculate the median of the series, which as we found in the previous section seems to lead to better performance.</p>
<p>The <em>forecast_variable()</em> implements this local strategy.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b72d846063133" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# extract the history for the series
	history = chunk_train[:, col_ix]
	# calculate the central tendency
	value = nanmedian(history)
	# persist the same value for all lead times
	forecast = [value for _ in range(len(lead_times))]
	return forecast</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72d846063133-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72d846063133-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72d846063133-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72d846063133-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72d846063133-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b72d846063133-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72d846063133-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-3"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72d846063133-4"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-5"><span class="crayon-h">	</span><span class="crayon-p"># extract the history for the series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72d846063133-6"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-7"><span class="crayon-h">	</span><span class="crayon-p"># calculate the central tendency</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72d846063133-8"><span class="crayon-h">	</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-9"><span class="crayon-h">	</span><span class="crayon-p"># persist the same value for all lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72d846063133-10"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">value </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72d846063133-11"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b72f902918120" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast local median
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	# convert target number into column number
	col_ix = 3 + target_ix
	# extract the history for the series
	history = chunk_train[:, col_ix]
	# calculate the central tendency
	value = nanmedian(history)
	# persist the same value for all lead times
	forecast = [value for _ in range(len(lead_times))]
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Local Median', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b72f902918120-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b72f902918120-128">128</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-1"><span class="crayon-p"># forecast local median</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-9"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-26"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-27"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-28"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-29"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-30"><span class="crayon-h">	</span><span class="crayon-p"># extract the history for the series</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-31"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-32"><span class="crayon-h">	</span><span class="crayon-p"># calculate the central tendency</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-33"><span class="crayon-h">	</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-34"><span class="crayon-h">	</span><span class="crayon-p"># persist the same value for all lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-35"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">value </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-38"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-39"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-40"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-41"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-42"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-43"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-44"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-45"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-46"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-47"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-48"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-49"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-50"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-51"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-52">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-53"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-54"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-55"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-56"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-57"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-58"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-59"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-60"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-61"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-62"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-63"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-64"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-65"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-66">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-67"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-68"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-69"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-70"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-71"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-72"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-73"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-74">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-75"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-76"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-77"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-78"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-79"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-80"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-81"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-82"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-83"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-84"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-85"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-86"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-87"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-88"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-89"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-90"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-91"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-92"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-93"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-94"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-95"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-96"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-97"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-98"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-99"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-100"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-101"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-102"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-103">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-104"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-105"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-106"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-107"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-108"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-109"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-110"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-111"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-112"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-113"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-114">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-115"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-116"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-117"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-118"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-119"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-120"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-121"><span class="crayon-p"># forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-122"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-123"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-124"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-125"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-126"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b72f902918120-127"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b72f902918120-128"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Local Median'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>Running the example summarizes the performance of this naive strategy, showing a MAE of about 0.568, which is worse than the above persistence strategy.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b735541269362" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Local Median: [0.568 MAE] +1 0.535, +2 0.542, +3 0.550, +4 0.568, +5 0.568, +10 0.562, +17 0.567, +24 0.605, +48 0.590, +72 0.593</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b735541269362-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b735541269362-1">Local Median: [0.568 MAE] +1 0.535, +2 0.542, +3 0.550, +4 0.568, +5 0.568, +10 0.562, +17 0.567, +24 0.605, +48 0.590, +72 0.593</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of MAE per forecast lead time is also created showing the familiar increasing curve of error per lead time.</p>
<div id="attachment_6318" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6318" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median.png" alt="MAE by Forecast Lead Time via Local Median" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time via Local Median</p></div>
<h3>Forecast Average Value for Hour-of-Day per Series</h3>
<p>Finally, we can dial in the persistence strategy by using the average value per series for the specific hour of day at each forecast lead time.</p>
<p>This approach was found to be effective at the global strategy. It may be effective using only the data from the chunk, although at the risk of using a much smaller data sample.</p>
<p>The <em>forecast_variable()</em> function below implements this strategy, first finding all rows with the hour of the forecast lead time, then calculating the median of those rows for the given target variable.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b739834864142" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	forecast = list()
	# convert target number into column number
	col_ix = 3 + target_ix
	# enumerate lead times
	for i in range(len(lead_times)):
		# get the hour for this forecast lead time
		hour = chunk_test[i, 2]
		# check for no test data
		if isnan(hour):
			forecast.append(nan)
			continue
		# select rows in chunk with this hour
		selected = chunk_train[chunk_train[:,2]==hour]
		# calculate the central tendency for target
		value = nanmedian(selected[:, col_ix])
		forecast.append(value)
	return forecast</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b739834864142-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b739834864142-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b739834864142-1"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-3"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-4"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-5"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-8"><span class="crayon-h">		</span><span class="crayon-p"># get the hour for this forecast lead time</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-9"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-10"><span class="crayon-h">		</span><span class="crayon-p"># check for no test data</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hour</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-12"><span class="crayon-h">			</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">nan</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-13"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-14"><span class="crayon-h">		</span><span class="crayon-p"># select rows in chunk with this hour</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-15"><span class="crayon-h">		</span><span class="crayon-v">selected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hour</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-16"><span class="crayon-h">		</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-17"><span class="crayon-h">		</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">selected</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b739834864142-18"><span class="crayon-h">		</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b739834864142-19"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b73c111888478" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# forecast local median per hour of day
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import unique
from numpy import array
from numpy import nanmedian
from matplotlib import pyplot

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# forecast all lead times for one variable
def forecast_variable(train_chunks, chunk_train, chunk_test, lead_times, target_ix):
	forecast = list()
	# convert target number into column number
	col_ix = 3 + target_ix
	# enumerate lead times
	for i in range(len(lead_times)):
		# get the hour for this forecast lead time
		hour = chunk_test[i, 2]
		# check for no test data
		if isnan(hour):
			forecast.append(nan)
			continue
		# select rows in chunk with this hour
		selected = chunk_train[chunk_train[:,2]==hour]
		# calculate the central tendency for target
		value = nanmedian(selected[:, col_ix])
		forecast.append(value)
	return forecast

# forecast for each chunk, returns [chunk][variable][time]
def forecast_chunks(train_chunks, test_input):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks to forecast
	for i in range(len(train_chunks)):
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(39):
			yhat = forecast_variable(train_chunks, train_chunks[i], test_input[i], lead_times, j)
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# forecast
test_input = [rows[:, :3] for rows in test_chunks]
forecast = forecast_chunks(train_chunks, test_input)
# evaluate forecast
actual = prepare_test_forecasts(test_chunks)
total_mae, times_mae = evaluate_forecasts(forecast, actual)
# summarize forecast
summarize_error('Local Median by Hour', total_mae, times_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b73c111888478-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf145b73c111888478-135">135</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-1"><span class="crayon-p"># forecast local median per hour of day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-8"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-10"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-11"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-12"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-13"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-14"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-15"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-16"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-17"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-18"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-19"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-20">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-21"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-22"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-23"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-24">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-25"><span class="crayon-p"># forecast all lead times for one variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-26"><span class="crayon-e">def </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-27"><span class="crayon-h">	</span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-28"><span class="crayon-h">	</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-29"><span class="crayon-h">	</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-30"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-31"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-32"><span class="crayon-h">		</span><span class="crayon-p"># get the hour for this forecast lead time</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-33"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-34"><span class="crayon-h">		</span><span class="crayon-p"># check for no test data</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-35"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hour</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-36"><span class="crayon-h">			</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">nan</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-37"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-38"><span class="crayon-h">		</span><span class="crayon-p"># select rows in chunk with this hour</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-39"><span class="crayon-h">		</span><span class="crayon-v">selected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hour</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-40"><span class="crayon-h">		</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-41"><span class="crayon-h">		</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">selected</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-42"><span class="crayon-h">		</span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-43"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-44">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-45"><span class="crayon-p"># forecast for each chunk, returns [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-46"><span class="crayon-e">def </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-47"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-48"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-49"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-50"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-51"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-52"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-53"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-54"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_variable</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-55"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-56"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-57"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-58"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-60"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-61"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-62"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-63"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-64"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-65"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-66"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-67"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-68"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-69"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-70"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-71"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-72"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-73">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-74"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-75"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-76"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-77"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-78"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-79"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-80"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-81">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-82"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-83"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-84"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-85"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-86"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-87"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-88"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-89"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-90"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-91"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-92"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-93"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-94"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-95"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-96"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-97"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-98"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-99"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-100"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-101"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-102"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-103"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-104"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-105"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-106"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-107"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-108"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-109"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-110">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-111"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-112"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-113"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-114"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-115"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-116"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-117"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-118"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-119"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-120"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-121">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-122"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-123"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-124"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-125"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-126"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-127"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-128"><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-129"><span class="crayon-v">test_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-130"><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-131"><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-132"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-133"><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b73c111888478-134"><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5bd2bf145b73c111888478-135"><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-s">'Local Median by Hour'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0089 seconds] -->
<p>Running the example prints the overall MAE of about 0.574, which is worse than the global variation of the same strategy.</p>
<p>As suspected, this is likely due to the small sample size, that is at most five rows of training data contributing to each forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b742955801767" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Local Median by Hour: [0.574 MAE] +1 0.561, +2 0.559, +3 0.568, +4 0.577, +5 0.577, +10 0.556, +17 0.551, +24 0.588, +48 0.601, +72 0.608</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b742955801767-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b742955801767-1">Local Median by Hour: [0.574 MAE] +1 0.561, +2 0.559, +3 0.568, +4 0.577, +5 0.577, +10 0.556, +17 0.551, +24 0.588, +48 0.601, +72 0.608</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of MAE per forecast lead time is also created showing the familiar increasing curve of error per lead time.</p>
<div id="attachment_6319" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6319" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-By-Hour-of-Day.png" alt="MAE by Forecast Lead Time via Local Median By Hour of Day" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-By-Hour-of-Day.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-By-Hour-of-Day-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-By-Hour-of-Day-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/MAE-by-Forecast-Lead-Time-via-Local-Median-By-Hour-of-Day-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">MAE by Forecast Lead Time via Local Median By Hour of Day</p></div>
<h2>Summary of Results</h2>
<p>We can summarize the performance of all of the naive forecast methods reviewed in this tutorial.</p>
<p>The example below lists each method using a shorthand of &#8216;<em>g</em>&#8216; and &#8216;<em>l</em>&#8216; for global and local and &#8216;<em>h</em>&#8216; for the hour-of-day variations. The example creates a bar chart so that we can compare the naive strategies based on their relative performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf145b746284585230" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# summary of results
from matplotlib import pyplot
# results
results = {
	'g-mean':0.634,
	'g-med':0.598,
	'g-med-h':0.567,
	'l-per':0.520,
	'l-med':0.568,
	'l-med-h':0.574}
# plot
pyplot.bar(results.keys(), results.values())
locs, labels = pyplot.xticks()
pyplot.setp(labels, rotation=30)
pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf145b746284585230-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf145b746284585230-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf145b746284585230-1"><span class="crayon-p"># summary of results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-2"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-3"><span class="crayon-p"># results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-4"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-5"><span class="crayon-h">	</span><span class="crayon-s">'g-mean'</span><span class="crayon-o">:</span><span class="crayon-cn">0.634</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-6"><span class="crayon-h">	</span><span class="crayon-s">'g-med'</span><span class="crayon-o">:</span><span class="crayon-cn">0.598</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-7"><span class="crayon-h">	</span><span class="crayon-s">'g-med-h'</span><span class="crayon-o">:</span><span class="crayon-cn">0.567</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-8"><span class="crayon-h">	</span><span class="crayon-s">'l-per'</span><span class="crayon-o">:</span><span class="crayon-cn">0.520</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-9"><span class="crayon-h">	</span><span class="crayon-s">'l-med'</span><span class="crayon-o">:</span><span class="crayon-cn">0.568</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-10"><span class="crayon-h">	</span><span class="crayon-s">'l-med-h'</span><span class="crayon-o">:</span><span class="crayon-cn">0.574</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-11"><span class="crayon-p"># plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-12"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">bar</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">keys</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-13"><span class="crayon-v">locs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">labels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">xticks</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf145b746284585230-14"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">setp</span><span class="crayon-sy">(</span><span class="crayon-v">labels</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf145b746284585230-15"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Running the example creates a bar chart comparing the MAE for each of the six strategies.</p>
<p>We can see that the persistence strategy was better than all of the other methods and that the second best strategy was the global median for each series that used the hour of day.</p>
<p>Models evaluated on this train/test separation of the dataset must achieve an overall MAE lower than 0.520 in order to be considered skillful.</p>
<div id="attachment_6320" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6320" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Bar-Chart-with-Summary-of-Naive-Forecast-Methods.png" alt="Bar Chart with Summary of Naive Forecast Methods" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Bar-Chart-with-Summary-of-Naive-Forecast-Methods.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Bar-Chart-with-Summary-of-Naive-Forecast-Methods-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Bar-Chart-with-Summary-of-Naive-Forecast-Methods-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Bar-Chart-with-Summary-of-Naive-Forecast-Methods-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">Bar Chart with Summary of Naive Forecast Methods</p></div>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Cross-Site Naive Forecast</strong>. Develop a naive forecast strategy that uses information about each variable across sites, e.g. different target variables for the same variable at different sites.</li>
<li><strong>Hybrid Approach</strong>. Develop a hybrid forecast strategy that combines elements of two or more of the naive forecast strategies at different lead times described in this tutorial.</li>
<li><strong>Ensemble of Naive Methods</strong>. Develop an ensemble forecast strategy that creates a linear combination of two or more forecast strategies described in this tutorial.</li>
</ul>
<p>If you explore any of these extensions, I&#8217;d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Posts</h3>
<ul>
<li><a href="https://machinelearningmastery.com/standard-multivariate-multi-step-multi-site-time-series-forecasting-problem/">A Standard Multivariate, Multi-Step, and Multi-Site Time Series Forecasting Problem</a></li>
<li><a href="https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/">How to Make Baseline Predictions for Time Series Forecasting with Python</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a></li>
<li><a href="https://github.com/benhamner/Air-Quality-Prediction-Hackathon-Winning-Model">Winning Code for the EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/discussion/1821">General approaches to partitioning the models?</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop naive forecasting methods for the multistep multivariate air pollution time series forecasting problem.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a test harness for evaluating forecasting strategies for the air pollution dataset.</li>
<li>How to develop global naive forecast strategies that use data from the entire training dataset.</li>
<li>How to develop local naive forecast strategies that use data from the specific interval that is being forecasted.</li>
</ul>
<p>Do you have any questions?<br />
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52">			<div class="textwidget"><p><center><br />
<div class="woo-sc-hr"></div></p>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img style="border: 0;" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" alt="Deep Learning for Time Series Forecasting" align="left" /></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>&#8230;with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br />
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br />
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more&#8230;</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br />
<div class="woo-sc-hr"></div><br />
</center></p>
</div>
		</div></div>	</section><!-- /.entry -->
	<div class="fix"></div>
<aside id="post-author">
	<div class="profile-image"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' /></div>
	<div class="profile-content">
		<h4>About Jason Brownlee</h4>
		Jason Brownlee, Ph.D. is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
			<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">&rarr;</span>			</a>
		</div><!--#profile-link-->
			</div>
	<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
	        <div class="post-entries">
	            <div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-load-visualize-and-explore-a-complex-multivariate-multistep-time-series-forecasting-dataset/" rel="prev"><i class="fa fa-angle-left"></i> How to Load, Visualize, and Explore a Complex Multivariate Multistep Time Series Forecasting Dataset</a></div>
	            <div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" rel="next">How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
	            <div class="fix"></div>
	        </div>

		<div id="comments">		 	<h3 id="comments-title">4 Responses to <em>How to Develop Baseline Forecasts for Multi-Site Multivariate Air Pollution Time Series Forecasting</em></h3>
		 	<ol class="commentlist">
				
		<li id="comment-452078" class="comment even thread-even depth-1">

	      	<div id="li-comment-452078" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/da5d10672bbe40d7da9680d6eb0a1c2b?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/da5d10672bbe40d7da9680d6eb0a1c2b?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Mark</span>
	                <span class="date">October 19, 2018 at 8:13 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/#comment-452078" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Exactly how does this:<br />
     chunk_ids = unique(values[:, 1])</p>
<p>develop a list of unique identifiers?  </p>
<p>When I see &#8216;unique&#8217; I think set().  I am not following the above line of code.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452078' onclick='return addComment.moveForm( "comment-452078", "452078", "respond", "6313" )' aria-label='Reply to Mark'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452091" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-452091" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 19, 2018 at 10:58 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/#comment-452091" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Yes, a set, in this case a list of unique values in column 1.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452091' onclick='return addComment.moveForm( "comment-452091", "452091", "respond", "6313" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452129" class="comment even thread-odd thread-alt depth-1">

	      	<div id="li-comment-452129" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/ba69f8606c960347843dd1f7684581e8?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/ba69f8606c960347843dd1f7684581e8?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Åukasz</span>
	                <span class="date">October 19, 2018 at 7:39 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/#comment-452129" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi,<br />
Thanks for a great tutorial. Just a small remark &#8211; to me, it would be much easier/quicker to understand steps if use pandas dataframes.<br />
All the best!</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452129' onclick='return addComment.moveForm( "comment-452129", "452129", "respond", "6313" )' aria-label='Reply to Åukasz'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452160" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-452160" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 20, 2018 at 5:54 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/#comment-452160" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452160' onclick='return addComment.moveForm( "comment-452160", "452160", "respond", "6313" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			</ol>
		 	</div>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/how-to-develop-baseline-forecasts-for-multi-site-multivariate-air-pollution-time-series-forecasting/#respond" style="display:none;">Click here to cancel reply.</a></small></h3>			<form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea tabindex="4" id="comment" name="comment" cols="50" rows="10" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><input id="author" name="author" type="text" class="txt" tabindex="1" value="" size="30" aria-required='true' /><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input id="email" name="email" type="text" class="txt" tabindex="2" value="" size="30" aria-required='true' /><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input id="url" name="url" type="text" class="txt" tabindex="3" value="" size="30" /><label for="url">Website</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit Comment" /> <input type='hidden' name='comment_post_ID' value='6313' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="c8987404bf" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="60"/></p>			</form>
			</div><!-- #respond -->
	     
            </section><!-- /#main -->
                
            <aside id="sidebar">
<div id="woo_blogauthorinfo-2" class="widget widget_woo_blogauthorinfo"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&#038;d=mm&#038;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' /></span>
<p>Hi, I'm Jason Brownlee, Ph.D.
<br>
My goal is to make developers like <em>YOU</em> awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div id="text-51" class="widget widget_text">			<div class="textwidget"><p><center><br />
<strong>Deep Learning for Time Series</strong><br />
Forecast the future with MLPs, CNNs, and LSTMs.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br />
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" /></a><br />
</center></p>
</div>
		</div>
		<div id="woo_tabs-2" class="widget widget_woo_tabs"> 		<div id="tabs">

            <ul class="wooTabs">
                                <li class="popular"><a href="#tab-pop">Popular</a></li>                                                            </ul>

            <div class="clear"></div>

            <div class="boxes box inside">

	            
                                <ul id="tab-pop" class="list">
                    	<li>
		<a href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/" title="How to Develop a Deep Learning Photo Caption Generator from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/09/example-150x150.jpg" class="thumbnail wp-post-image" alt="Photo of a dog at the beach." title="How to Develop a Deep Learning Photo Caption Generator from Scratch" /></a>		<a title="How to Develop a Deep Learning Photo Caption Generator from Scratch" href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/">How to Develop a Deep Learning Photo Caption Generator from Scratch</a>
		<span class="meta">November 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Neural Machine Translation System in Keras" title="How to Develop a Neural Machine Translation System from Scratch" /></a>		<a title="How to Develop a Neural Machine Translation System from Scratch" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/">How to Develop a Neural Machine Translation System from Scratch</a>
		<span class="meta">January 10, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" /></a>		<a title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</a>
		<span class="meta">October 26, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" /></a>		<a title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a>
		<span class="meta">November 2, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" title="How to Use the Keras Functional API for Deep Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/multiple_inputs-150x150.png" class="thumbnail wp-post-image" alt="Neural Network Graph With Multiple Inputs" title="How to Use the Keras Functional API for Deep Learning" /></a>		<a title="How to Use the Keras Functional API for Deep Learning" href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">How to Use the Keras Functional API for Deep Learning</a>
		<span class="meta">October 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-a-Word-Level-Neural-Language-Model-and-Use-it-to-Generate-Text-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" /></a>		<a title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/">How to Develop a Word-Level Neural Language Model and Use it to Generate Text</a>
		<span class="meta">November 10, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" class="thumbnail wp-post-image" alt="Difference Between Classification and Regression in Machine Learning" title="Difference Between Classification and Regression in Machine Learning" /></a>		<a title="Difference Between Classification and Regression in Machine Learning" href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/">Difference Between Classification and Regression in Machine Learning</a>
		<span class="meta">December 11, 2017</span>
		<div class="fix"></div>
	</li>
	                </ul>
                                                                
            </div><!-- /.boxes -->

        </div><!-- /wooTabs -->

        </div>         <div id="custom_html-2" class="widget_text widget widget_custom_html"><h3>You might also like&#8230;</h3><div class="textwidget custom-html-widget"><ul>
	<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
  <li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
	<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
	<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
	<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->

		</div><!-- /#main-sidebar-container -->         

		
    </div><!-- /#content -->
	
	<footer id="footer" class="col-full">

		
		<div id="copyright" class="col-left">
			<p>&copy; 2018 Machine Learning Mastery. All Rights Reserved. </p>		</div>

		<div id="credit" class="col-right">
			<p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p></p>		</div>

	</footer>

	
	</div><!-- /#inner-wrapper -->

</div><!-- /#wrapper -->

<div class="fix"></div><!--/.fix-->

<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8'></script>
<script async="async" type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.8'></script>
</body>
</html>