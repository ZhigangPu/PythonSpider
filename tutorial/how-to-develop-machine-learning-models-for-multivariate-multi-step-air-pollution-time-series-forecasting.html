<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="pingback" href="https://machinelearningmastery.com/xmlrpc.php" />

<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>

<!-- This site is optimized with the Yoast SEO plugin v9.0.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting</title>
<link rel="canonical" href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/" />
<link rel="publisher" href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/"/>
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting" />
<meta property="og:description" content="Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites. The EMC Data Science Global Hackathon dataset, or the &#8216;Air Quality &hellip;" />
<meta property="og:url" content="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/" />
<meta property="og:site_name" content="Machine Learning Mastery" />
<meta property="article:publisher" content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" />
<meta property="article:author" content="https://www.facebook.com/jason.brownlee.39" />
<meta property="article:section" content="Deep Learning for Time Series" />
<meta property="article:published_time" content="2018-10-18T18:00:13+00:00" />
<meta property="article:modified_time" content="2018-08-30T00:34:46+00:00" />
<meta property="og:updated_time" content="2018-08-30T00:34:46+00:00" />
<meta property="og:image" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Machine-Learning-Models-for-Multivariate-Multi-Step-Air-Pollution-Time-Series-Forecasting.jpg" />
<meta property="og:image:secure_url" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Machine-Learning-Models-for-Multivariate-Multi-Step-Air-Pollution-Time-Series-Forecasting.jpg" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="480" />
<meta property="og:image:alt" content="How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting" />
<script type='application/ld+json'>{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Feed" href="https://feeds.feedburner.com/MachineLearningMastery" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Comments Feed" href="https://machinelearningmastery.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting Comments Feed" href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style type="text/css" media="all">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link rel='stylesheet' id='crayon-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wpautoterms_css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.4' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-style-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-rrssb-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='woo-testimonials-css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='theme-stylesheet-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21' type='text/css' media='all' />
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8'></script>
<link rel='https://api.w.org/' href='https://machinelearningmastery.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://machinelearningmastery.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://machinelearningmastery.com/?p=6333' />
<link rel="alternate" type="application/json+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting%2F&#038;format=xml" />
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

    <script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>

<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>

<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css" />

<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css" />

<!-- Theme version -->
<meta name="generator" content="Canvas 5.9.21" />
<meta name="generator" content="WooFramework 6.2.9" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" sizes="32x32" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" />
<meta name="msapplication-TileImage" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" />
</head>
<body class="post-template-default single single-post postid-6333 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">

	<div id="inner-wrapper">

	<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>

	<header id="header" class="col-full">

		<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png" alt="Machine Learning Mastery" /></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
	    <div class="header-widget">
	        <div id="text-53" class="widget widget_text">			<div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
		</div><div id="search-3" class="widget widget_search"><div class="search_main">
    <form method="get" class="searchform" action="https://machinelearningmastery.com/" >
        <input type="text" class="field s" name="s" value="Search..." onfocus="if (this.value == 'Search...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search...';}" />
		<input type="hidden" name="post_type" value="post" />
        <button type="submit" class="fa fa-search submit" name="submit" value="Search"></button>
    </form>
    <div class="fix"></div>
</div></div>	    </div>
	
	</header>
	<nav id="navigation" class="col-full" role="navigation">

	
	<section class="menus">

		<a href="https://machinelearningmastery.com" class="nav-home"><span>Home</span></a>

	<h3>Main Menu</h3><ul id="main-nav" class="nav fl"><li id="menu-item-6503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li id="menu-item-6501" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li id="menu-item-6506" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
	<li id="menu-item-6508" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
	<li id="menu-item-6511" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
	<li id="menu-item-6509" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
	<li id="menu-item-6515" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
	<li id="menu-item-6512" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
	<li id="menu-item-6507" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
	<li id="menu-item-6513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
	<li id="menu-item-6516" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
	<li id="menu-item-6517" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
	<li id="menu-item-6522" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
	<li id="menu-item-6518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
	<li id="menu-item-6510" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
	<li id="menu-item-6519" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
	<li id="menu-item-6520" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
	<li id="menu-item-6523" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
	<li id="menu-item-6514" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li id="menu-item-6502" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li id="menu-item-6500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li id="menu-item-6504" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li id="menu-item-6505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul>	<div class="side-nav">
		</div><!-- /#side-nav -->

	</section><!-- /.menus -->

	<a href="#top" class="nav-close"><span>Return to Content</span></a>

</nav>
       
    <!-- #content Starts -->
	    <div id="content" class="col-full">
    
    	<div id="main-sidebar-container">    

            <!-- #main Starts -->
                        <section id="main">                       
<article class="post-6333 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
	<header>
	<h1 class="title entry-title">How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting</h1>	</header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" title="Posts by Jason Brownlee" rel="author">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-19T05:00:13+1100">October 19, 2018</abbr>  <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span>  </div>
	<section class="entry">
<p>Real-world time series forecasting is challenging for a whole host of reasons not limited to problem features such as having multiple input variables, the requirement to predict multiple time steps, and the need to perform the same type of prediction for multiple physical sites.</p>
<p>The EMC Data Science Global Hackathon dataset, or the &#8216;Air Quality Prediction&#8217; dataset for short, describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>Machine learning algorithms can be applied to time series forecasting problems and offer benefits such as the ability to handle multiple input variables with noisy complex dependencies.</p>
<p>In this tutorial, you will discover how to develop machine learning models for multi-step time series forecasting of air pollution data.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to impute missing values and transform time series data so that it can be modeled by supervised learning algorithms.</li>
<li>How to develop and evaluate a suite of linear algorithms for multi-step time series forecasting.</li>
<li>How to develop and evaluate a suite of nonlinear algorithms for multi-step time series forecasting.</li>
</ul>
<p>Let’s get started.</p>
<div id="attachment_6337" style="width: 650px" class="wp-caption aligncenter"><img class="size-full wp-image-6337" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Machine-Learning-Models-for-Multivariate-Multi-Step-Air-Pollution-Time-Series-Forecasting.jpg" alt="How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting" width="640" height="480" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Machine-Learning-Models-for-Multivariate-Multi-Step-Air-Pollution-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-Machine-Learning-Models-for-Multivariate-Multi-Step-Air-Pollution-Time-Series-Forecasting-300x225.jpg 300w" sizes="(max-width: 640px) 100vw, 640px" /><p class="wp-caption-text">How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting<br />Photo by <a href="https://www.flickr.com/photos/akeg/376488289/">Eric Schmuttenmaer</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into nine parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Model Evaluation</li>
<li>Machine Learning Modeling</li>
<li>Machine Learning Data Preparation</li>
<li>Model Evaluation Test Harness</li>
<li>Evaluate Linear Algorithms</li>
<li>Evaluate Nonlinear Algorithms</li>
<li>Tune Lag Size</li>
</ol>
<h2>Problem Description</h2>
<p>The Air Quality Prediction dataset describes weather conditions at multiple sites and requires a prediction of air quality measurements over the subsequent three days.</p>
<p>Specifically, weather observations such as temperature, pressure, wind speed, and wind direction are provided hourly for eight days for multiple sites. The objective is to predict air quality measurements for the next 3 days at multiple sites. The forecast lead times are not contiguous; instead, specific lead times must be forecast over the 72 hour forecast period. They are:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14ae9ed753342303" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14ae9ed753342303-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14ae9ed753342303-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Further, the dataset is divided into disjoint but contiguous chunks of data, with eight days of data followed by three days that require a forecast.</p>
<p>Not all observations are available at all sites or chunks and not all output variables are available at all sites and chunks. There are large portions of missing data that must be addressed.</p>
<p>The dataset was used as the basis for a <a href="https://www.kaggle.com/c/dsg-hackathon">short duration machine learning competition</a> (or hackathon) on the Kaggle website in 2012.</p>
<p>Submissions for the competition were evaluated against the true observations that were withheld from participants and scored using Mean Absolute Error (MAE). Submissions required the value of -1,000,000 to be specified in those cases where a forecast was not possible due to missing data. In fact, a template of where to insert missing values was provided and required to be adopted for all submissions (what a pain).</p>
<p>A winning entrant achieved a MAE of 0.21058 on the withheld test set (<a href="https://www.kaggle.com/c/dsg-hackathon/leaderboard">private leaderboard</a>) using random forest on lagged observations. A writeup of this solution is available in the post:</p>
<ul>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a>, 2012.</li>
</ul>
<p>In this tutorial, we will explore how to develop naive forecasts for the problem that can be used as a baseline to determine whether a model has skill on the problem or not.</p>
<p><div class="woo-sc-hr"></div></p>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" target="_blank" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;">Download Your FREE Mini-Course</a><script data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" data-config="%7B%7D" type="text/javascript" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js"></script></p>
</center>
<p><div class="woo-sc-hr"></div></p>
<h2>Model Evaluation</h2>
<p>Before we can evaluate naive forecasting methods, we must develop a test harness.</p>
<p>This includes at least how the data will be prepared and how forecasts will be evaluated.</p>
<h3>Load Dataset</h3>
<p>The first step is to download the dataset and load it into memory.</p>
<p>The dataset can be downloaded for free from the Kaggle website. You may have to create an account and log in, in order to be able to download the dataset.</p>
<p>Download the entire dataset, e.g. &#8220;<em>Download All</em>&#8221; to your workstation and unzip the archive in your current working directory with the folder named &#8216;<em>AirQualityPrediction</em>&#8216;.</p>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction) Data</a></li>
</ul>
<p>Our focus will be the &#8216;<em>TrainingData.csv</em>&#8216; file that contains the training dataset, specifically data in chunks where each chunk is eight contiguous days of observations and target variables.</p>
<p>We can load the data file into memory using the Pandas <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv() function</a> and specify the header row on line 0.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14ae9f9762895036" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14ae9f9762895036-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14ae9f9762895036-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14ae9f9762895036-1"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14ae9f9762895036-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can group data by the &#8216;chunkID&#8217; variable (column index 1).</p>
<p>First, let&#8217;s get a list of the unique chunk identifiers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14ae9fc992481257" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
chunk_ids = unique(values[:, 1])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14ae9fc992481257-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14ae9fc992481257-1"><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can then collect all rows for each chunk identifier and store them in a dictionary for easy access.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14ae9fe199852791" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
chunks = dict()
# sort rows by chunk id
for chunk_id in chunk_ids:
	selection = values[:, chunk_ix] == chunk_id
	chunks[chunk_id] = values[selection, :]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14ae9fe199852791-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14ae9fe199852791-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14ae9fe199852791-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14ae9fe199852791-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14ae9fe199852791-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14ae9fe199852791-1"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14ae9fe199852791-2"><span class="crayon-p"># sort rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf14ae9fe199852791-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14ae9fe199852791-4"><span class="crayon-h">	</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf14ae9fe199852791-5"><span class="crayon-e">	</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Below defines a function named <em>to_chunks()</em> that takes a NumPy array of the loaded data and returns a dictionary of <em>chunk_id</em> to rows for the chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea01306364736" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea01306364736-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea01306364736-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea01306364736-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea01306364736-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea01306364736-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea01306364736-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea01306364736-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea01306364736-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea01306364736-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea01306364736-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea01306364736-1"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea01306364736-2"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea01306364736-3"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea01306364736-4"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf14aea01306364736-5"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea01306364736-6"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea01306364736-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea01306364736-8"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea01306364736-9"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea01306364736-10"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>The complete example that loads the dataset and splits it into chunks is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea03166259189" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load data and split into chunks
from numpy import unique
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
print('Total Chunks: %d' % len(chunks))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea03166259189-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea03166259189-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-1"><span class="crayon-p"># load data and split into chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-4">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-5"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-6"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-7"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-8"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-9"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-10"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-11"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-12"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-13"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-16"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-17"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-18"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-19"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea03166259189-20"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea03166259189-21"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total Chunks: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Running the example prints the number of chunks in the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea06139889581" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Total Chunks: 208</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea06139889581-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea06139889581-1">Total Chunks: 208</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Data Preparation</h3>
<p>Now that we know how to load the data and split it into chunks, we can separate into train and test datasets.</p>
<p>Each chunk covers an interval of eight days of hourly observations, although the number of actual observations within each chunk may vary widely.</p>
<p>We can split each chunk into the first five days of observations for training and the last three for test.</p>
<p>Each observation has a row called &#8216;<em>position_within_chunk</em>&#8216; that varies from 1 to 192 (8 days * 24 hours). We can therefore take all rows with a value in this column that is less than or equal to 120 (5 * 24) as training data and any values more than 120 as test data.</p>
<p>Further, any chunks that don&#8217;t have any observations in the train or test split can be dropped as not viable.</p>
<p>When working with the naive models, we are only interested in the target variables, and none of the input meteorological variables. Therefore, we can remove the input data and have the train and test data only comprised of the 39 target variables for each chunk, as well as the position within chunk and hour of observation.</p>
<p>The <em>split_train_test()</em> function below implements this behavior; given a dictionary of chunks, it will split each into a list of train and test chunk data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea09730699309" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea09730699309-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea09730699309-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-1"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-2"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-3"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-4"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-5"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-8"><span class="crayon-h">		</span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-9"><span class="crayon-h">		</span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-10"><span class="crayon-h">		</span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-12"><span class="crayon-h">			</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-13"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-14"><span class="crayon-h">		</span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-15"><span class="crayon-h">		</span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-16"><span class="crayon-h">		</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea09730699309-17"><span class="crayon-h">		</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea09730699309-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>We do not require the entire test dataset; instead, we only require the observations at specific lead times over the three day period, specifically the lead times:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea0c104525366" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea0c104525366-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea0c104525366-1">+1, +2, +3, +4, +5, +10, +17, +24, +48, +72</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Where, each lead time is relative to the end of the training period.</p>
<p>First, we can put these lead times into a function for easy reference:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea0e879884379" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea0e879884379-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea0e879884379-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea0e879884379-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea0e879884379-1"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea0e879884379-2"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea0e879884379-3"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we can reduce the test dataset down to just the data at the preferred lead times.</p>
<p>We can do that by looking at the &#8216;<em>position_within_chunk</em>&#8216; column and using the lead time as an offset from the end of the training dataset, e.g. 120 + 1, 120 +2, etc.</p>
<p>If we find a matching row in the test set, it is saved, otherwise a row of NaN observations is generated.</p>
<p>The function <em>to_forecasts()</em> below implements this and returns a NumPy array with one row for each forecast lead time for each chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea10417678397" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea10417678397-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea10417678397-25">25</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-1"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-2"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-3"><span class="crayon-h">	</span><span class="crayon-p"># get lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-4"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-5"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-6"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-7"><span class="crayon-h">	</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-8"><span class="crayon-h">	</span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-9"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-10"><span class="crayon-h">		</span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-11"><span class="crayon-h">		</span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-12"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-13"><span class="crayon-h">			</span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-14"><span class="crayon-h">			</span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-15"><span class="crayon-h">			</span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-16"><span class="crayon-h">			</span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-17"><span class="crayon-h">			</span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-18"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-19"><span class="crayon-h">				</span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-20"><span class="crayon-h">				</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-21"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-22"><span class="crayon-h">			</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-23"><span class="crayon-h">				</span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea10417678397-24"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea10417678397-25"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>We can tie all of this together and split the dataset into train and test sets and save the results to new files.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea13514336689" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split data into train and test sets
from numpy import unique
from numpy import nan
from numpy import array
from numpy import savetxt
from pandas import read_csv

# split the dataset by 'chunkID', return a dict of id to rows
def to_chunks(values, chunk_ix=1):
	chunks = dict()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks[chunk_id] = values[selection, :]
	return chunks

# split each chunk into train/test sets
def split_train_test(chunks, row_in_chunk_ix=2):
	train, test = list(), list()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	# enumerate chunks
	for k,rows in chunks.items():
		# split chunk rows by 'position_within_chunk'
		train_rows = rows[rows[:,row_in_chunk_ix] &lt;= cut_point, :]
		test_rows = rows[rows[:,row_in_chunk_ix] &gt; cut_point, :]
		if len(train_rows) == 0 or len(test_rows) == 0:
			print('&gt;dropping chunk=%d: train=%s, test=%s' % (k, train_rows.shape, test_rows.shape))
			continue
		# store with chunk id, position in chunk, hour and all targets
		indices = [1,2,5] + [x for x in range(56,train_rows.shape[1])]
		train.append(train_rows[:, indices])
		test.append(test_rows[:, indices])
	return train, test

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2 ,3, 4, 5, 10, 17, 24, 48, 72]

# convert the rows in a test chunk to forecasts
def to_forecasts(test_chunks, row_in_chunk_ix=1):
	# get lead times
	lead_times = get_lead_times()
	# first 5 days of hourly observations for train
	cut_point = 5 * 24
	forecasts = list()
	# enumerate each chunk
	for rows in test_chunks:
		chunk_id = rows[0, 0]
		# enumerate each lead time
		for tau in lead_times:
			# determine the row in chunk we want for the lead time
			offset = cut_point + tau
			# retrieve data for the lead time using row number in chunk
			row_for_tau = rows[rows[:,row_in_chunk_ix]==offset, :]
			# check if we have data
			if len(row_for_tau) == 0:
				# create a mock row [chunk, position, hour] + [nan...]
				row = [chunk_id, offset, nan] + [nan for _ in range(39)]
				forecasts.append(row)
			else:
				# store the forecast row
				forecasts.append(row_for_tau[0])
	return array(forecasts)

# load dataset
dataset = read_csv('AirQualityPrediction/TrainingData.csv', header=0)
# group data by chunks
values = dataset.values
chunks = to_chunks(values)
# split into train/test
train, test = split_train_test(chunks)
# flatten training chunks to rows
train_rows = array([row for rows in train for row in rows])
# print(train_rows.shape)
print('Train Rows: %s' % str(train_rows.shape))
# reduce train to forecast lead times only
test_rows = to_forecasts(test)
print('Test Rows: %s' % str(test_rows.shape))
# save datasets
savetxt('AirQualityPrediction/naive_train.csv', train_rows, delimiter=',')
savetxt('AirQualityPrediction/naive_test.csv', test_rows, delimiter=',')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf14aea13514336689-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea13514336689-84">84</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-1"><span class="crayon-p"># split data into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">savetxt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-8"><span class="crayon-p"># split the dataset by 'chunkID', return a dict of id to rows</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-9"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-10"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-11"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-12"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-13"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-14"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-15"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-16"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-18">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-19"><span class="crayon-p"># split each chunk into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-20"><span class="crayon-e">def </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-21"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-22"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-23"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-24"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-25"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-26"><span class="crayon-h">		</span><span class="crayon-p"># split chunk rows by 'position_within_chunk'</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-27"><span class="crayon-h">		</span><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-28"><span class="crayon-h">		</span><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-29"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-30"><span class="crayon-h">			</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'&gt;dropping chunk=%d: train=%s, test=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-31"><span class="crayon-h">			</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-32"><span class="crayon-h">		</span><span class="crayon-p"># store with chunk id, position in chunk, hour and all targets</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-33"><span class="crayon-h">		</span><span class="crayon-v">indices</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">56</span><span class="crayon-sy">,</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-34"><span class="crayon-h">		</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-35"><span class="crayon-h">		</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">indices</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-38"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-39"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-40"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-42"><span class="crayon-p"># convert the rows in a test chunk to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-43"><span class="crayon-e">def </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-44"><span class="crayon-h">	</span><span class="crayon-p"># get lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-45"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-46"><span class="crayon-h">	</span><span class="crayon-p"># first 5 days of hourly observations for train</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-47"><span class="crayon-h">	</span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-48"><span class="crayon-h">	</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-49"><span class="crayon-h">	</span><span class="crayon-p"># enumerate each chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-50"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-51"><span class="crayon-h">		</span><span class="crayon-v">chunk_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-52"><span class="crayon-h">		</span><span class="crayon-p"># enumerate each lead time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-53"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tau </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-54"><span class="crayon-h">			</span><span class="crayon-p"># determine the row in chunk we want for the lead time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-55"><span class="crayon-h">			</span><span class="crayon-v">offset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">cut_point</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tau</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-56"><span class="crayon-h">			</span><span class="crayon-p"># retrieve data for the lead time using row number in chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-57"><span class="crayon-h">			</span><span class="crayon-v">row_for_tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">row_in_chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-58"><span class="crayon-h">			</span><span class="crayon-p"># check if we have data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-59"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-60"><span class="crayon-h">				</span><span class="crayon-p"># create a mock row [chunk, position, hour] + [nan...]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-61"><span class="crayon-h">				</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">chunk_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-62"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-63"><span class="crayon-h">			</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-64"><span class="crayon-h">				</span><span class="crayon-p"># store the forecast row</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-65"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_for_tau</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-66"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-67">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-68"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-69"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/TrainingData.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-70"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-71"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-72"><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-73"><span class="crayon-p"># split into train/test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-74"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_train_test</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-75"><span class="crayon-p"># flatten training chunks to rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-76"><span class="crayon-v">train_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">row </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">train </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-77"><span class="crayon-p"># print(train_rows.shape)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-78"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">train_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-79"><span class="crayon-p"># reduce train to forecast lead times only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-80"><span class="crayon-v">test_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-81"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Rows: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">test_rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-82"><span class="crayon-p"># save datasets</span></div><div class="crayon-line" id="crayon-5bd2bf14aea13514336689-83"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea13514336689-84"><span class="crayon-e">savetxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>Running the example first comments that chunk 69 is removed from the dataset for having insufficient data.</p>
<p>We can then see that we have 42 columns in each of the train and test sets, one for the chunk id, position within chunk, hour of day, and the 39 training variables.</p>
<p>We can also see the dramatically smaller version of the test dataset with rows only at the forecast lead times.</p>
<p>The new train and test datasets are saved in the &#8216;<em>naive_train.csv</em>&#8216; and &#8216;<em>naive_test.csv</em>&#8216; files respectively.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea18098075490" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&gt;dropping chunk=69: train=(0, 95), test=(28, 95)
Train Rows: (23514, 42)
Test Rows: (2070, 42)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea18098075490-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea18098075490-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea18098075490-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea18098075490-1">&gt;dropping chunk=69: train=(0, 95), test=(28, 95)</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea18098075490-2">Train Rows: (23514, 42)</div><div class="crayon-line" id="crayon-5bd2bf14aea18098075490-3">Test Rows: (2070, 42)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Forecast Evaluation</h3>
<p>Once forecasts have been made, they need to be evaluated.</p>
<p>It is helpful to have a simpler format when evaluating forecasts. For example, we will use the three-dimensional structure of <em>[chunks][variables][time]</em>, where variable is the target variable number from 0 to 38 and time is the lead time index from 0 to 9.</p>
<p>Models are expected to make predictions in this format.</p>
<p>We can also restructure the test dataset to have this dataset for comparison. The <em>prepare_test_forecasts()</em> function below implements this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea1b427733832" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1b427733832-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1b427733832-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-1"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-2"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-3"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-4"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-6"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-7"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-8"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-9"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-10"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-11"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1b427733832-12"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1b427733832-13"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We will evaluate a model using the mean absolute error, or MAE. This is the metric that was used in the competition and is a sensible choice given the non-Gaussian distribution of the target variables.</p>
<p>If a lead time contains no data in the test set (e.g. <em>NaN</em>), then no error will be calculated for that forecast. If the lead time does have data in the test set but no data in the forecast, then the full magnitude of the observation will be taken as error. Finally, if the test set has an observation and a forecast was made, then the absolute difference will be recorded as the error.</p>
<p>The <em>calculate_error()</em> function implements these rules and returns the error for a given forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea1e972605300" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea1e972605300-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1e972605300-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1e972605300-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1e972605300-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1e972605300-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea1e972605300-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea1e972605300-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea1e972605300-1"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1e972605300-2"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1e972605300-3"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1e972605300-4"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1e972605300-5"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea1e972605300-6"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf14aea1e972605300-7"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Errors are summed across all chunks and all lead times, then averaged.</p>
<p>The overall MAE will be calculated, but we will also calculate a MAE for each forecast lead time. This can help with model selection generally as some models may perform differently at different lead times.</p>
<p>The evaluate_forecasts() function below implements this, calculating the MAE and per-lead time MAE for the provided predictions and expected values in <em>[chunk][variable][time]</em> format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea24150039846" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea24150039846-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea24150039846-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-1"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-3"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-4"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-5"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-8"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-9"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-10"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-11"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-12"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-13"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-14"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-15"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-16"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-17"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-18"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-19"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-20"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-21"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-22"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-23"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-24"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-25"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-26"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf14aea24150039846-27"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea24150039846-28"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0027 seconds] -->
<p>Once we have the evaluation of a model, we can present it.</p>
<p>The <em>summarize_error()</em> function below first prints a one-line summary of a model&#8217;s performance then creates a plot of MAE per forecast lead time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea27507407087" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# summarize scores
def summarize_error(name, total_mae, times_mae):
	# print summary
	lead_times = get_lead_times()
	formatted = ['+%d %.3f' % (lead_times[i], times_mae[i]) for i in range(len(lead_times))]
	s_scores = ', '.join(formatted)
	print('%s: [%.3f MAE] %s' % (name, total_mae, s_scores))
	# plot summary
	pyplot.plot([str(x) for x in lead_times], times_mae, marker='.')
	pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea27507407087-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea27507407087-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea27507407087-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea27507407087-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea27507407087-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea27507407087-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea27507407087-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea27507407087-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea27507407087-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea27507407087-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea27507407087-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea27507407087-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea27507407087-3"><span class="crayon-h">	</span><span class="crayon-p"># print summary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea27507407087-4"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea27507407087-5"><span class="crayon-h">	</span><span class="crayon-v">formatted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'+%d %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea27507407087-6"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">formatted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea27507407087-7"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f MAE] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea27507407087-8"><span class="crayon-h">	</span><span class="crayon-p"># plot summary</span></div><div class="crayon-line" id="crayon-5bd2bf14aea27507407087-9"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea27507407087-10"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>We are now ready to start exploring the performance of naive forecasting methods.</p>
<p>Machine Learning Modeling</p>
<p>The problem can be modeled with machine learning.</p>
<p>Most machine learning models do not directly support the notion of observations over time. Instead, the lag observations must be treated as input features in order to make predictions.</p>
<p>This is a benefit of machine learning algorithms for time series forecasting. Specifically, that they are able to support large numbers of input features. These could be lag observations for one or multiple input time series.</p>
<p>Other general benefits of machine learning algorithms for time series forecasting over classical methods include:</p>
<ul>
<li>Ability to support noisy features and noise in the relationships between variables.</li>
<li>Ability to handle irrelevant features.</li>
<li>Ability to support complex relationships between variables.</li>
</ul>
<p>A challenge with this dataset is the need to make multi-step forecasts. There are two main approaches that machine learning methods can be used to make multi-step forecasts; they are:</p>
<ul>
<li><strong>Direct</strong>. A separate model is developed to forecast each forecast lead time.</li>
<li><strong>Recursive</strong>. A single model is developed to make one-step forecasts, and the model is used recursively where prior forecasts are used as input to forecast the subsequent lead time.</li>
</ul>
<p>The recursive approach can make sense when forecasting a short contiguous block of lead times, whereas the direct approach may make more sense when forecasting discontiguous lead times. The direct approach may be more appropriate for the air pollution forecast problem given that we are interested in forecasting a mixture of 10 contiguous and discontiguous lead times over a three-day period.</p>
<p>The dataset has 39 target variables, and we develop one model per target variable, per forecast lead time. That means that we require (39 * 10) 390 machine learning models.</p>
<p>Key to the use of machine learning algorithms for time series forecasting is the choice of input data. We can think about three main sources of data that can be used as input and mapped to each forecast lead time for a target variable; they are:</p>
<ul>
<li><strong>Univariate data</strong>, e.g. lag observations from the target variable that is being forecasted.</li>
<li><strong>Multivariate data</strong>, e.g. lag observations from other variables (weather and targets).</li>
<li><strong>Metadata</strong>, e.g. data about the date or time being forecast.</li>
</ul>
<p>Data can be drawn from across all chunks, providing a rich dataset for learning a mapping from inputs to the target forecast lead time.</p>
<p>The 39 target variables are actually comprised of 12 variables across 14 sites.</p>
<p>Because of the way the data is provided, the default approach to modeling is to treat each variable-site as independent. It may be possible to collapse data by variable and use the same models for a variable across multiple sites.</p>
<p>Some variables have been purposely mislabeled (e.g different data used variables with the same identifier). Nevertheless, perhaps these mislabeled variables can be identified and excluded from multi-site models.</p>
<h2>Machine Learning Data Preparation</h2>
<p>Before we can explore machine learning models of this dataset, we must prepare the data in such a way that we can fit models.</p>
<p>This requires two data preparation steps:</p>
<ul>
<li>Handling missing data.</li>
<li>Preparing input-output patterns.</li>
</ul>
<p>For now, we will focus on the 39 target variables and ignore the meteorological and metadata.</p>
<h3>Handle Missing Data</h3>
<p>Chunks are comprised of five days or less of hourly observations for 39 target variables.</p>
<p>Many of the chunks do not have all five days of data, and none of the chunks have data for all 39 target variables.</p>
<p>In those cases where a chunk has no data for a target variable, a forecast is not required.</p>
<p>In those cases where a chunk does have some data for a target variable, but not all five days worth, there will be gaps in the series. These gaps may be a few hours to over a day of observations in length, sometimes even longer.</p>
<p>Three candidate strategies for dealing with these gaps are as follows:</p>
<ul>
<li>Ignore the gaps.</li>
<li>Use data without gaps.</li>
<li>Fill the gaps.</li>
</ul>
<p>We could ignore the gaps. A problem with this would be that that data would not be contiguous when splitting data into inputs and outputs. When training a model, the inputs will not be consistent, but could mean the last n hours of data, or data spread across the last <em>n</em> days. This inconsistency will make learning a mapping from inputs to outputs very noisy and perhaps more difficult for the model than it needs to be.</p>
<p>We could use only the data without gaps. This is a good option. A risk is that we may not have much or enough data with which to fit a model.</p>
<p>Finally, we could fill the gaps. This is called data imputation and there are many strategies that could be used to fill the gaps. Three methods that may perform well include:</p>
<ul>
<li>Persisting the last observed value forward (linear).</li>
<li>Use the median value for the hour of day within the chunk.</li>
<li>Use the median value for the hour of day across chunks.</li>
</ul>
<p>In this tutorial, we will use the latter approach and fill the gaps by using the median for the time of day across chunks. This method seems to result in more training samples and better model performance after a little testing.</p>
<p>For a given variable, there may be missing observations defined by missing rows. Specifically, each observation has a &#8216;<em>position_within_chunk</em>&#8216;. We expect each chunk in the training dataset to have 120 observations, with &#8216;<em>positions_within_chunk</em>&#8216; from 1 to 120 inclusively.</p>
<p>Therefore, we can create an array of 120 <em>NaN</em> values for each variable, mark all observations in the chunk using the &#8216;<em>positions_within_chunk</em>&#8216; values, and anything left will be marked <em>NaN</em>. We can then plot each variable and look for gaps.</p>
<p>The <em>variable_to_series()</em> function below will take the rows for a chunk and a given column index for the target variable and will return a series of 120 time steps for the variable with all available data marked with the value from the chunk.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea2e489564135" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea2e489564135-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea2e489564135-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea2e489564135-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea2e489564135-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea2e489564135-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea2e489564135-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-1"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea2e489564135-2"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-3"><span class="crayon-h">	</span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea2e489564135-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-5"><span class="crayon-h">	</span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea2e489564135-6"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-7"><span class="crayon-h">		</span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea2e489564135-8"><span class="crayon-h">		</span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-9"><span class="crayon-h">		</span><span class="crayon-p"># store data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea2e489564135-10"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea2e489564135-11"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We need to calculate a parallel series of the hour of day for each chunk that we can use for imputing hour specific data for each variable in the chunk.</p>
<p>Given a series of partially filled hours of day, the <em>interpolate_hours()</em> function below will fill in the missing hours of day. It does this by finding the first marked hour, then counting forward, filling in the hour of day, then performing the same operation backwards.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea32272463019" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea32272463019-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea32272463019-24">24</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-1"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-2"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-3"><span class="crayon-h">	</span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-4"><span class="crayon-h">	</span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-6"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-7"><span class="crayon-h">			</span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-8"><span class="crayon-h">			</span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-9"><span class="crayon-h">	</span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-10"><span class="crayon-h">	</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-11"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-12"><span class="crayon-h">		</span><span class="crayon-p"># increment hour</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-13"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-14"><span class="crayon-h">		</span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-15"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-16"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-17"><span class="crayon-h">	</span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-18"><span class="crayon-h">	</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-19"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-20"><span class="crayon-h">		</span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-21"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-22"><span class="crayon-h">		</span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line" id="crayon-5bd2bf14aea32272463019-23"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea32272463019-24"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>We can call the same <em>variable_to_series()</em> function (above) to create the series of hours with missing values (column index 2), then call <em>interpolate_hours()</em> to fill in the gaps.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea35008655746" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare sequence of hours for the chunk
hours = variable_to_series(rows, 2)
# interpolate hours
interpolate_hours(hours)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea35008655746-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea35008655746-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea35008655746-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea35008655746-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea35008655746-1"><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea35008655746-2"><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea35008655746-3"><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea35008655746-4"><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can then pass the hours to any impute function that may make use of it.</p>
<p>We can now try filling in missing values in a chunk with values within the same series with the same hour. Specifically, we will find all rows with the same hour on the series and calculate the median value.</p>
<p>The <em>impute_missing()</em> below takes all of the rows in a chunk, the prepared sequence of hours of the day for the chunk, and the series with missing values for a variable and the column index for a variable.</p>
<p>It first checks to see if the series is all missing data and returns immediately if this is the case as no impute can be performed. It then enumerates over the time steps of the series and when it detects a time step with no data, it collects all rows in the series with data for the same hour and calculates the median value.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea38048166801" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# impute missing data
def impute_missing(train_chunks, rows, hours, series, col_ix):
	# impute missing using the median value for hour in all series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# collect all rows across all chunks for the hour
			all_rows = list()
			for rows in train_chunks:
				[all_rows.append(row) for row in rows[rows[:,2]==hours[i]]]
			# calculate the central tendency for target
			all_rows = array(all_rows)
			# fill with median value
			value = nanmedian(all_rows[:, col_ix])
			if isnan(value):
				value = 0.0
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea38048166801-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea38048166801-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-1"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-2"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-3"><span class="crayon-h">	</span><span class="crayon-p"># impute missing using the median value for hour in all series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-4"><span class="crayon-h">	</span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-6"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-7"><span class="crayon-h">			</span><span class="crayon-p"># collect all rows across all chunks for the hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-8"><span class="crayon-h">			</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-9"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-10"><span class="crayon-h">				</span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-11"><span class="crayon-h">			</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-12"><span class="crayon-h">			</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-13"><span class="crayon-h">			</span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-14"><span class="crayon-h">			</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-15"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-16"><span class="crayon-h">				</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-17"><span class="crayon-h">			</span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-18"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea38048166801-19"><span class="crayon-h">			</span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea38048166801-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p></p>
<h3>Supervised Representation</h3>
<p>We need to transform the series for each target variable into rows with inputs and outputs so that we can fit supervised machine learning algorithms.</p>
<p>Specifically, we have a series, like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea3b763441048" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[1, 2, 3, 4, 5, 6, 7, 8, 9]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea3b763441048-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea3b763441048-1">[1, 2, 3, 4, 5, 6, 7, 8, 9]</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>When forecasting the lead time of +1 using 2 lag variables, we would split the series into input (<em>X</em>) and output (<em>y</em>) patterns as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea3d165713692" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
X,			y
1, 2,		3
2, 3,		4
3, 4,		5
4, 5,		6
5, 6,		7
6, 7,		8
7, 8,		9</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea3d165713692-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea3d165713692-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea3d165713692-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea3d165713692-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea3d165713692-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea3d165713692-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea3d165713692-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea3d165713692-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea3d165713692-1">X,			y</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea3d165713692-2">1, 2,		3</div><div class="crayon-line" id="crayon-5bd2bf14aea3d165713692-3">2, 3,		4</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea3d165713692-4">3, 4,		5</div><div class="crayon-line" id="crayon-5bd2bf14aea3d165713692-5">4, 5,		6</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea3d165713692-6">5, 6,		7</div><div class="crayon-line" id="crayon-5bd2bf14aea3d165713692-7">6, 7,		8</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea3d165713692-8">7, 8,		9</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This first requires that we choose a number of lag observations to use as input. There is no right answer; instead, it is a good idea to test different numbers and see what works.</p>
<p>We then must perform the splitting of the series into the supervised learning format for each of the 10 forecast lead times. For example, forecasting +24 with 2 lag observations might look like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea3f819790814" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
X,			y
1, 2,		24</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea3f819790814-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea3f819790814-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea3f819790814-1">X,			y</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea3f819790814-2">1, 2,		24</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This process is then repeated for each of the 39 target variables.</p>
<p>The patterns prepared for each lead time for each target variable can then be aggregated across chunks to provide a training dataset for a model.</p>
<p>We must also prepare a test dataset. That is, input data (<em>X</em>) for each target variable for each chunk so that we can use it as input to forecast the lead times in the test dataset. If we chose a lag of 2, then the test dataset would be comprised of the last two observations for each target variable for each chunk. Pretty straightforward.</p>
<p>We can start off by defining a function that will create input-output patterns for a given complete (imputed) series.</p>
<p>The <em>supervised_for_lead_time()</em> function below will take a series, a number of lag observations to use as input, and a forecast lead time to predict, then will return a list of input/out rows drawn from the series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea42053236391" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# created input/output patterns from a sequence
def supervised_for_lead_time(series, n_lag, lead_time):
	samples = list()
	# enumerate observations and create input/output patterns
	for i in range(n_lag, len(series)):
		end_ix = i + (lead_time - 1)
		# check if can create a pattern
		if end_ix &gt;= len(series):
			break
		# retrieve input and output
		start_ix = i - n_lag
		row = series[start_ix:i] + [series[end_ix]]
		samples.append(row)
	return samples</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea42053236391-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea42053236391-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-1"><span class="crayon-p"># created input/output patterns from a sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-2"><span class="crayon-e">def </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_time</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-3"><span class="crayon-h">	</span><span class="crayon-v">samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-4"><span class="crayon-h">	</span><span class="crayon-p"># enumerate observations and create input/output patterns</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-6"><span class="crayon-h">		</span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_time</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-7"><span class="crayon-h">		</span><span class="crayon-p"># check if can create a pattern</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-8"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-9"><span class="crayon-h">			</span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-10"><span class="crayon-h">		</span><span class="crayon-p"># retrieve input and output</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-11"><span class="crayon-h">		</span><span class="crayon-v">start_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">n_lag</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-12"><span class="crayon-e">		</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">start_ix</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">end_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea42053236391-13"><span class="crayon-h">		</span><span class="crayon-v">samples</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea42053236391-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">samples</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>It is important to understand this piece.</p>
<p>We can test this function and explore different numbers of lag variables and forecast lead times on a small test dataset.</p>
<p>Below is a complete example that generates a series of 20 integers and creates a series with two input lags and forecasts the +6 lead time.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea45826722828" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# test supervised to input/output patterns
from numpy import array

# created input/output patterns from a sequence
def supervised_for_lead_time(series, n_lag, lead_time):
	data = list()
	# enumerate observations and create input/output patterns
	for i in range(n_lag, len(series)):
		end_ix = i + (lead_time - 1)
		# check if can create a pattern
		if end_ix &gt;= len(series):
			break
		# retrieve input and output
		start_ix = i - n_lag
		row = series[start_ix:i] + [series[end_ix]]
		data.append(row)
	return array(data)

# define test dataset
data = [x for x in range(20)]
# convert to supervised format
result = supervised_for_lead_time(data, 2, 6)
# display result
print(result)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea45826722828-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea45826722828-24">24</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-1"><span class="crayon-p"># test supervised to input/output patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-4"><span class="crayon-p"># created input/output patterns from a sequence</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-5"><span class="crayon-e">def </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_time</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-6"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-7"><span class="crayon-h">	</span><span class="crayon-p"># enumerate observations and create input/output patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-8"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-9"><span class="crayon-h">		</span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_time</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-10"><span class="crayon-h">		</span><span class="crayon-p"># check if can create a pattern</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-11"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-12"><span class="crayon-h">			</span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-13"><span class="crayon-h">		</span><span class="crayon-p"># retrieve input and output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-14"><span class="crayon-h">		</span><span class="crayon-v">start_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">n_lag</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-15"><span class="crayon-e">		</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">start_ix</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">end_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-16"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-18">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-19"><span class="crayon-p"># define test dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-20"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-21"><span class="crayon-p"># convert to supervised format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-22"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea45826722828-23"><span class="crayon-p"># display result</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea45826722828-24"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>Running the example prints the resulting patterns showing lag observations and their associated forecast lead time.</p>
<p>Experiment with this example to get comfortable with this data transform as it is key to modeling time series using machine learning algorithms.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea48927842985" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[[ 0  1  7]
 [ 1  2  8]
 [ 2  3  9]
 [ 3  4 10]
 [ 4  5 11]
 [ 5  6 12]
 [ 6  7 13]
 [ 7  8 14]
 [ 8  9 15]
 [ 9 10 16]
 [10 11 17]
 [11 12 18]
 [12 13 19]]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea48927842985-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea48927842985-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-1">[[ 0&nbsp;&nbsp;1&nbsp;&nbsp;7]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-2"> [ 1&nbsp;&nbsp;2&nbsp;&nbsp;8]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-3"> [ 2&nbsp;&nbsp;3&nbsp;&nbsp;9]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-4"> [ 3&nbsp;&nbsp;4 10]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-5"> [ 4&nbsp;&nbsp;5 11]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-6"> [ 5&nbsp;&nbsp;6 12]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-7"> [ 6&nbsp;&nbsp;7 13]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-8"> [ 7&nbsp;&nbsp;8 14]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-9"> [ 8&nbsp;&nbsp;9 15]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-10"> [ 9 10 16]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-11"> [10 11 17]</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea48927842985-12"> [11 12 18]</div><div class="crayon-line" id="crayon-5bd2bf14aea48927842985-13"> [12 13 19]]</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can now call <em>supervised_for_lead_time()</em> for each forecast lead time for a given target variable series.</p>
<p>The <em>target_to_supervised()</em> function below implements this. First the target variable is converted into a series and imputed using the functions developed in the previous section. Then training samples are created for each target lead time. A test sample for the target variable is also created.</p>
<p>Both the training data for each forecast lead time and the test input data are then returned for this target variable.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea4b379248210" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# create supervised learning data for each lead time for this target
def target_to_supervised(chunks, rows, hours, col_ix, n_lag):
	train_lead_times = list()
	# get series
	series = variable_to_series(rows, col_ix)
	if not has_data(series):
		return None, [nan for _ in range(n_lag)]
	# impute
	imputed = impute_missing(chunks, rows, hours, series, col_ix)
	# prepare test sample for chunk-variable
	test_sample = array(imputed[-n_lag:])
	# enumerate lead times
	lead_times = get_lead_times()
	for lead_time in lead_times:
		# make input/output data from series
		train_samples = supervised_for_lead_time(imputed, n_lag, lead_time)
		train_lead_times.append(train_samples)
	return train_lead_times, test_sample</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4b379248210-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4b379248210-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-1"><span class="crayon-p"># create supervised learning data for each lead time for this target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-2"><span class="crayon-e">def </span><span class="crayon-e">target_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-3"><span class="crayon-h">	</span><span class="crayon-v">train_lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-4"><span class="crayon-h">	</span><span class="crayon-p"># get series</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-5"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-6"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-7"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-8"><span class="crayon-h">	</span><span class="crayon-p"># impute</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-9"><span class="crayon-h">	</span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-10"><span class="crayon-h">	</span><span class="crayon-p"># prepare test sample for chunk-variable</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-11"><span class="crayon-h">	</span><span class="crayon-v">test_sample</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-12"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-13"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-14"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-15"><span class="crayon-h">		</span><span class="crayon-p"># make input/output data from series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-16"><span class="crayon-h">		</span><span class="crayon-v">train_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_time</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4b379248210-17"><span class="crayon-h">		</span><span class="crayon-v">train_lead_times</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_samples</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4b379248210-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train_lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_sample</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>We have the pieces; we now need to define the function to drive the data preparation process.</p>
<p>This function builds up the train and test datasets.</p>
<p>The approach is to enumerate each target variable and gather the training data for each lead time from across all of the chunks. At the same time, we collect the samples required as input when making a prediction for the test dataset.</p>
<p>The result is a training dataset that has the dimensions <em>[var][lead time][sample]</em> where the final dimension are the rows of training samples for a forecast lead time for a target variable. The function also returns the test dataset with the dimensions <em>[chunk][var][sample]</em> where the final dimension is the input data for making a prediction for a target variable for a chunk.</p>
<p>The <em>data_prep()</em> function below implements this behavior and takes the data in chunk format and a specified number of lag observations to use as input.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea4e638502254" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare training [var][lead time][sample] and test [chunk][var][sample]
def data_prep(chunks, n_lag, n_vars=39):
	lead_times = get_lead_times()
	train_data = [[list() for _ in range(len(lead_times))] for _ in range(n_vars)]
	test_data = [[list() for _ in range(n_vars)] for _ in range(len(chunks))]
	# enumerate targets for chunk
	for var in range(n_vars):
		# convert target number into column number
		col_ix = 3 + var
		# enumerate chunks to forecast
		for c_id in range(len(chunks)):
			rows = chunks[c_id]
			# prepare sequence of hours for the chunk
			hours = variable_to_series(rows, 2)
			# interpolate hours
			interpolate_hours(hours)
			# check for no data
			if not has_data(rows[:, col_ix]):
				continue
			# convert series into training data for each lead time
			train, test_sample = target_to_supervised(chunks, rows, hours, col_ix, n_lag)
			# store test sample for this var-chunk
			test_data[c_id][var] = test_sample
			if train is not None:
				# store samples per lead time
				for lead_time in range(len(lead_times)):
					# add all rows to the existing list of rows
					train_data[var][lead_time].extend(train[lead_time])
		# convert all rows for each var-lead time to a numpy array
		for lead_time in range(len(lead_times)):
			train_data[var][lead_time] = array(train_data[var][lead_time])
	return array(train_data), array(test_data)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf14aea4e638502254-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea4e638502254-32">32</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-1"><span class="crayon-p"># prepare training [var][lead time][sample] and test [chunk][var][sample]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-2"><span class="crayon-e">def </span><span class="crayon-e">data_prep</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-3"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-4"><span class="crayon-h">	</span><span class="crayon-v">train_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-5"><span class="crayon-h">	</span><span class="crayon-v">test_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-6"><span class="crayon-h">	</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-8"><span class="crayon-h">		</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-9"><span class="crayon-h">		</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-t">var</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-10"><span class="crayon-h">		</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-11"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">c_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-12"><span class="crayon-h">			</span><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">c_id</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-13"><span class="crayon-h">			</span><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-14"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-15"><span class="crayon-h">			</span><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-16"><span class="crayon-h">			</span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-17"><span class="crayon-h">			</span><span class="crayon-p"># check for no data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-18"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-19"><span class="crayon-h">				</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-20"><span class="crayon-h">			</span><span class="crayon-p"># convert series into training data for each lead time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-21"><span class="crayon-h">			</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_sample</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">target_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-22"><span class="crayon-h">			</span><span class="crayon-p"># store test sample for this var-chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-23"><span class="crayon-h">			</span><span class="crayon-v">test_data</span><span class="crayon-sy">[</span><span class="crayon-v">c_id</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">test_sample</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-24"><span class="crayon-e">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">train </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-25"><span class="crayon-h">				</span><span class="crayon-p"># store samples per lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-26"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-27"><span class="crayon-h">					</span><span class="crayon-p"># add all rows to the existing list of rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-28"><span class="crayon-h">					</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">extend</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-29"><span class="crayon-h">		</span><span class="crayon-p"># convert all rows for each var-lead time to a numpy array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-30"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea4e638502254-31"><span class="crayon-h">			</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea4e638502254-32"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_data</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">test_data</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can tie everything together and prepare a train and test dataset with a supervised learning format for machine learning algorithms.</p>
<p>We will use the prior 12 hours of lag observations as input when predicting each forecast lead time.</p>
<p>The resulting train and test datasets are then saved as binary NumPy arrays.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea52162460889" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare data
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from numpy import nanmedian
from numpy import save

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# interpolate series of hours (in place) in 24 hour time
def interpolate_hours(hours):
	# find the first hour
	ix = -1
	for i in range(len(hours)):
		if not isnan(hours[i]):
			ix = i
			break
	# fill-forward
	hour = hours[ix]
	for i in range(ix+1, len(hours)):
		# increment hour
		hour += 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24
	# fill-backward
	hour = hours[ix]
	for i in range(ix-1, -1, -1):
		# decrement hour
		hour -= 1
		# check for a fill
		if isnan(hours[i]):
			hours[i] = hour % 24

# return true if the array has any non-nan values
def has_data(data):
	return count_nonzero(isnan(data)) &lt; len(data)

# impute missing data
def impute_missing(train_chunks, rows, hours, series, col_ix):
	# impute missing using the median value for hour in all series
	imputed = list()
	for i in range(len(series)):
		if isnan(series[i]):
			# collect all rows across all chunks for the hour
			all_rows = list()
			for rows in train_chunks:
				[all_rows.append(row) for row in rows[rows[:,2]==hours[i]]]
			# calculate the central tendency for target
			all_rows = array(all_rows)
			# fill with median value
			value = nanmedian(all_rows[:, col_ix])
			if isnan(value):
				value = 0.0
			imputed.append(value)
		else:
			imputed.append(series[i])
	return imputed

# layout a variable with breaks in the data for missing positions
def variable_to_series(chunk_train, col_ix, n_steps=5*24):
	# lay out whole series
	data = [nan for _ in range(n_steps)]
	# mark all available data
	for i in range(len(chunk_train)):
		# get position in chunk
		position = int(chunk_train[i, 1] - 1)
		# store data
		data[position] = chunk_train[i, col_ix]
	return data

# created input/output patterns from a sequence
def supervised_for_lead_time(series, n_lag, lead_time):
	samples = list()
	# enumerate observations and create input/output patterns
	for i in range(n_lag, len(series)):
		end_ix = i + (lead_time - 1)
		# check if can create a pattern
		if end_ix &gt;= len(series):
			break
		# retrieve input and output
		start_ix = i - n_lag
		row = series[start_ix:i] + [series[end_ix]]
		samples.append(row)
	return samples

# create supervised learning data for each lead time for this target
def target_to_supervised(chunks, rows, hours, col_ix, n_lag):
	train_lead_times = list()
	# get series
	series = variable_to_series(rows, col_ix)
	if not has_data(series):
		return None, [nan for _ in range(n_lag)]
	# impute
	imputed = impute_missing(chunks, rows, hours, series, col_ix)
	# prepare test sample for chunk-variable
	test_sample = array(imputed[-n_lag:])
	# enumerate lead times
	lead_times = get_lead_times()
	for lead_time in lead_times:
		# make input/output data from series
		train_samples = supervised_for_lead_time(imputed, n_lag, lead_time)
		train_lead_times.append(train_samples)
	return train_lead_times, test_sample

# prepare training [var][lead time][sample] and test [chunk][var][sample]
def data_prep(chunks, n_lag, n_vars=39):
	lead_times = get_lead_times()
	train_data = [[list() for _ in range(len(lead_times))] for _ in range(n_vars)]
	test_data = [[list() for _ in range(n_vars)] for _ in range(len(chunks))]
	# enumerate targets for chunk
	for var in range(n_vars):
		# convert target number into column number
		col_ix = 3 + var
		# enumerate chunks to forecast
		for c_id in range(len(chunks)):
			rows = chunks[c_id]
			# prepare sequence of hours for the chunk
			hours = variable_to_series(rows, 2)
			# interpolate hours
			interpolate_hours(hours)
			# check for no data
			if not has_data(rows[:, col_ix]):
				continue
			# convert series into training data for each lead time
			train, test_sample = target_to_supervised(chunks, rows, hours, col_ix, n_lag)
			# store test sample for this var-chunk
			test_data[c_id][var] = test_sample
			if train is not None:
				# store samples per lead time
				for lead_time in range(len(lead_times)):
					# add all rows to the existing list of rows
					train_data[var][lead_time].extend(train[lead_time])
		# convert all rows for each var-lead time to a numpy array
		for lead_time in range(len(lead_times)):
			train_data[var][lead_time] = array(train_data[var][lead_time])
	return array(train_data), array(test_data)

# load dataset
train = loadtxt('AirQualityPrediction/naive_train.csv', delimiter=',')
test = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
# group data by chunks
train_chunks = to_chunks(train)
test_chunks = to_chunks(test)
# convert training data into supervised learning data
n_lag = 12
train_data, test_data = data_prep(train_chunks, n_lag)
print(train_data.shape, test_data.shape)
# save train and test sets to file
save('AirQualityPrediction/supervised_train.npy', train_data)
save('AirQualityPrediction/supervised_test.npy', test_data)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-146">146</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-148">148</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-150">150</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-152">152</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-154">154</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-156">156</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-158">158</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-160">160</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-162">162</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-164">164</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea52162460889-166">166</div><div class="crayon-num" data-line="crayon-5bd2bf14aea52162460889-167">167</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-1"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nanmedian</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-9"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-10">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-11"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-12"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-13"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-14"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-15"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-16"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-17"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-18"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-19"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-22"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-23"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-26"><span class="crayon-p"># interpolate series of hours (in place) in 24 hour time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-27"><span class="crayon-e">def </span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-28"><span class="crayon-h">	</span><span class="crayon-p"># find the first hour</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-29"><span class="crayon-h">	</span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-30"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-31"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-32"><span class="crayon-h">			</span><span class="crayon-v">ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-33"><span class="crayon-h">			</span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-34"><span class="crayon-h">	</span><span class="crayon-p"># fill-forward</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-35"><span class="crayon-h">	</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-36"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-37"><span class="crayon-h">		</span><span class="crayon-p"># increment hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-38"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-39"><span class="crayon-h">		</span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-40"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-41"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-42"><span class="crayon-h">	</span><span class="crayon-p"># fill-backward</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-43"><span class="crayon-h">	</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-44"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">ix</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-45"><span class="crayon-h">		</span><span class="crayon-p"># decrement hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-46"><span class="crayon-h">		</span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-47"><span class="crayon-h">		</span><span class="crayon-p"># check for a fill</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-48"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-49"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hour</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-50">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-51"><span class="crayon-p"># return true if the array has any non-nan values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-52"><span class="crayon-e">def </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-53"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-54">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-55"><span class="crayon-p"># impute missing data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-56"><span class="crayon-e">def </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-57"><span class="crayon-h">	</span><span class="crayon-p"># impute missing using the median value for hour in all series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-58"><span class="crayon-h">	</span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-59"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-60"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-61"><span class="crayon-h">			</span><span class="crayon-p"># collect all rows across all chunks for the hour</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-62"><span class="crayon-h">			</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-63"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-64"><span class="crayon-h">				</span><span class="crayon-sy">[</span><span class="crayon-v">all_rows</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-o">==</span><span class="crayon-v">hours</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-65"><span class="crayon-h">			</span><span class="crayon-p"># calculate the central tendency for target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-66"><span class="crayon-h">			</span><span class="crayon-v">all_rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-67"><span class="crayon-h">			</span><span class="crayon-p"># fill with median value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-68"><span class="crayon-h">			</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">nanmedian</span><span class="crayon-sy">(</span><span class="crayon-v">all_rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-69"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-70"><span class="crayon-h">				</span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-71"><span class="crayon-h">			</span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-72"><span class="crayon-h">		</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-73"><span class="crayon-h">			</span><span class="crayon-v">imputed</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-74"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">imputed</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-75">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-76"><span class="crayon-p"># layout a variable with breaks in the data for missing positions</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-77"><span class="crayon-e">def </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-o">*</span><span class="crayon-cn">24</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-78"><span class="crayon-h">	</span><span class="crayon-p"># lay out whole series</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-79"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-80"><span class="crayon-h">	</span><span class="crayon-p"># mark all available data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-81"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-82"><span class="crayon-h">		</span><span class="crayon-p"># get position in chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-83"><span class="crayon-h">		</span><span class="crayon-v">position</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-84"><span class="crayon-h">		</span><span class="crayon-p"># store data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-85"><span class="crayon-h">		</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">position</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunk_train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-86"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-87">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-88"><span class="crayon-p"># created input/output patterns from a sequence</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-89"><span class="crayon-e">def </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_time</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-90"><span class="crayon-h">	</span><span class="crayon-v">samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-91"><span class="crayon-h">	</span><span class="crayon-p"># enumerate observations and create input/output patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-92"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-93"><span class="crayon-h">		</span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lead_time</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-94"><span class="crayon-h">		</span><span class="crayon-p"># check if can create a pattern</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-95"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">end_ix</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-96"><span class="crayon-h">			</span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-97"><span class="crayon-h">		</span><span class="crayon-p"># retrieve input and output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-98"><span class="crayon-h">		</span><span class="crayon-v">start_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">n_lag</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-99"><span class="crayon-e">		</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">start_ix</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">[</span><span class="crayon-v">end_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-100"><span class="crayon-h">		</span><span class="crayon-v">samples</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-101"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">samples</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-102">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-103"><span class="crayon-p"># create supervised learning data for each lead time for this target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-104"><span class="crayon-e">def </span><span class="crayon-e">target_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-105"><span class="crayon-h">	</span><span class="crayon-v">train_lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-106"><span class="crayon-h">	</span><span class="crayon-p"># get series</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-107"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-108"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-109"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-110"><span class="crayon-h">	</span><span class="crayon-p"># impute</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-111"><span class="crayon-h">	</span><span class="crayon-v">imputed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">impute_missing</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-112"><span class="crayon-h">	</span><span class="crayon-p"># prepare test sample for chunk-variable</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-113"><span class="crayon-h">	</span><span class="crayon-v">test_sample</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-114"><span class="crayon-h">	</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-115"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-116"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lead_times</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-117"><span class="crayon-h">		</span><span class="crayon-p"># make input/output data from series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-118"><span class="crayon-h">		</span><span class="crayon-v">train_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">supervised_for_lead_time</span><span class="crayon-sy">(</span><span class="crayon-v">imputed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lead_time</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-119"><span class="crayon-h">		</span><span class="crayon-v">train_lead_times</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">train_samples</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-120"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train_lead_times</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_sample</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-121">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-122"><span class="crayon-p"># prepare training [var][lead time][sample] and test [chunk][var][sample]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-123"><span class="crayon-e">def </span><span class="crayon-e">data_prep</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-o">=</span><span class="crayon-cn">39</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-124"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-125"><span class="crayon-h">	</span><span class="crayon-v">train_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-126"><span class="crayon-h">	</span><span class="crayon-v">test_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-127"><span class="crayon-h">	</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-128"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-129"><span class="crayon-h">		</span><span class="crayon-p"># convert target number into column number</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-130"><span class="crayon-h">		</span><span class="crayon-v">col_ix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-t">var</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-131"><span class="crayon-h">		</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-132"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">c_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-133"><span class="crayon-h">			</span><span class="crayon-v">rows</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span><span class="crayon-sy">[</span><span class="crayon-v">c_id</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-134"><span class="crayon-h">			</span><span class="crayon-p"># prepare sequence of hours for the chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-135"><span class="crayon-h">			</span><span class="crayon-v">hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">variable_to_series</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-136"><span class="crayon-h">			</span><span class="crayon-p"># interpolate hours</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-137"><span class="crayon-h">			</span><span class="crayon-e">interpolate_hours</span><span class="crayon-sy">(</span><span class="crayon-v">hours</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-138"><span class="crayon-h">			</span><span class="crayon-p"># check for no data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-139"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-140"><span class="crayon-h">				</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-141"><span class="crayon-h">			</span><span class="crayon-p"># convert series into training data for each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-142"><span class="crayon-h">			</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_sample</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">target_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col_ix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-143"><span class="crayon-h">			</span><span class="crayon-p"># store test sample for this var-chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-144"><span class="crayon-h">			</span><span class="crayon-v">test_data</span><span class="crayon-sy">[</span><span class="crayon-v">c_id</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">test_sample</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-145"><span class="crayon-e">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">train </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-146"><span class="crayon-h">				</span><span class="crayon-p"># store samples per lead time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-147"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-148"><span class="crayon-h">					</span><span class="crayon-p"># add all rows to the existing list of rows</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-149"><span class="crayon-h">					</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">extend</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-150"><span class="crayon-h">		</span><span class="crayon-p"># convert all rows for each var-lead time to a numpy array</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-151"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">lead_time </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-152"><span class="crayon-h">			</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_data</span><span class="crayon-sy">[</span><span class="crayon-t">var</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">lead_time</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-153"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_data</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">test_data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-154">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-155"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-156"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_train.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-157"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-158"><span class="crayon-p"># group data by chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-159"><span class="crayon-v">train_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-160"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-161"><span class="crayon-p"># convert training data into supervised learning data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-162"><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-163"><span class="crayon-v">train_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">data_prep</span><span class="crayon-sy">(</span><span class="crayon-v">train_chunks</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-164"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-165"><span class="crayon-p"># save train and test sets to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea52162460889-166"><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_train.npy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea52162460889-167"><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_test.npy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_data</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0115 seconds] -->
<p>Running the example may take a minute.</p>
<p>The result are two binary files containing the train and test datasets that we can load in the following sections for training and evaluating machine learning algorithms on the problem.</p>
<h2>Model Evaluation Test Harness</h2>
<p>Before we can start evaluating algorithms, we need some more elements of the test harness.</p>
<p>First, we need to be able to fit a scikit-learn model on training data. The <em>fit_model()</em> function below will make a clone of the model configuration and fit it on the provided training data. We will need to fit many (360) versions of each configured model, so this function will be called a lot.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea5a957197698" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fit a single model
def fit_model(model, X, y):
	# clone the model configuration
	local_model = clone(model)
	# fit the model
	local_model.fit(X, y)
	return local_model</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea5a957197698-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5a957197698-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5a957197698-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5a957197698-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5a957197698-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5a957197698-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5a957197698-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea5a957197698-1"><span class="crayon-p"># fit a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5a957197698-2"><span class="crayon-e">def </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5a957197698-3"><span class="crayon-h">	</span><span class="crayon-p"># clone the model configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5a957197698-4"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">clone</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5a957197698-5"><span class="crayon-h">	</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5a957197698-6"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5a957197698-7"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">local_model</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we need to fit a model for each variable and forecast lead time combination.</p>
<p>We can do this by enumerating the training dataset first by the variables and then by the lead times. We can then fit a model and store it in a list of lists with the same structure, specifically: <em>[var][time][model]</em>.</p>
<p>The <em>fit_models()</em> function below implements this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea5d114433606" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fit one model for each variable and each forecast lead time [var][time][model]
def fit_models(model, train):
	# prepare structure for saving models
	models = [[list() for _ in range(train.shape[1])] for _ in range(train.shape[0])]
	# enumerate vars
	for i in range(train.shape[0]):
		# enumerate lead times
		for j in range(train.shape[1]):
			# get data
			data = train[i, j]
			X, y = data[:, :-1], data[:, -1]
			# fit model
			local_model = fit_model(model, X, y)
			models[i][j].append(local_model)
	return models</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea5d114433606-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea5d114433606-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-1"><span class="crayon-p"># fit one model for each variable and each forecast lead time [var][time][model]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-2"><span class="crayon-e">def </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare structure for saving models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-4"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-5"><span class="crayon-h">	</span><span class="crayon-p"># enumerate vars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-6"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-7"><span class="crayon-h">		</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-8"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-9"><span class="crayon-h">			</span><span class="crayon-p"># get data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-10"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-11"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-12"><span class="crayon-h">			</span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-13"><span class="crayon-h">			</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea5d114433606-14"><span class="crayon-h">			</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">local_model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea5d114433606-15"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Fitting models is the slow part and could benefit from being parallelized, such as with the Joblib library. This is left as an extension.</p>
<p>Once the models are fit, they can be used to make predictions for the test dataset.</p>
<p>The prepared test dataset is organized first by chunk, and then by target variable. Making predictions is fast and involves first checking that a prediction can be made (we have input data) and if so, using the appropriate models for the target variable. Each of the 10 forecast lead times for the variable will then be predicted with each of the direct models for those lead times.</p>
<p>The <em>make_predictions()</em> function below implements this, taking the list of lists of models and the loaded test dataset as arguments and returning an array of forecasts with the structure <em>[chunks][var][time]</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea60983250259" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# return forecasts as [chunks][var][time]
def make_predictions(models, test):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks
	for i in range(test.shape[0]):
		# enumerate variables
		chunk_predictions = list()
		for j in range(test.shape[1]):
			# get the input pattern for this chunk and target
			pattern = test[i,j]
			# assume a nan forecast
			forecasts = array([nan for _ in range(len(lead_times))])
			# check we can make a forecast
			if has_data(pattern):
				pattern = pattern.reshape((1, len(pattern)))
				# forecast each lead time
				forecasts = list()
				for k in range(len(lead_times)):
					yhat = models[j][k][0].predict(pattern)
					forecasts.append(yhat[0])
				forecasts = array(forecasts)
			# save forecasts fore each lead time for this variable
			chunk_predictions.append(forecasts)
		# save forecasts for this chunk
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea60983250259-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea60983250259-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-1"><span class="crayon-p"># return forecasts as [chunks][var][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-2"><span class="crayon-e">def </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-3"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-4"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-5"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-6"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-7"><span class="crayon-h">		</span><span class="crayon-p"># enumerate variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-8"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-9"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-10"><span class="crayon-h">			</span><span class="crayon-p"># get the input pattern for this chunk and target</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-11"><span class="crayon-h">			</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-12"><span class="crayon-h">			</span><span class="crayon-p"># assume a nan forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-13"><span class="crayon-h">			</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-14"><span class="crayon-h">			</span><span class="crayon-p"># check we can make a forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-15"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-16"><span class="crayon-h">				</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-17"><span class="crayon-h">				</span><span class="crayon-p"># forecast each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-18"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-19"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-20"><span class="crayon-h">					</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-21"><span class="crayon-h">					</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-22"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-23"><span class="crayon-h">			</span><span class="crayon-p"># save forecasts fore each lead time for this variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-24"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-25"><span class="crayon-h">		</span><span class="crayon-p"># save forecasts for this chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-26"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea60983250259-27"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea60983250259-28"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>We need a list of models to evaluate.</p>
<p>We can define a generic <em>get_models()</em> function that is responsible for defining a dictionary of model-names mapped to configured scikit-learn model objects.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea64810493898" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare a list of ml models
def get_models(models=dict()):
	# ...
	return models</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea64810493898-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea64810493898-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea64810493898-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea64810493898-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea64810493898-1"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea64810493898-2"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea64810493898-3"><span class="crayon-h">	</span><span class="crayon-p"># ...</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea64810493898-4"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Finally, we need a function to drive the model evaluation process.</p>
<p>Given the dictionary of models, enumerate the models, first fitting the matrix of models on the training data, making predictions of the test dataset, evaluating the predictions, and summarizing the results.</p>
<p>The <em>evaluate_models()</em> function below implements this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea66270331556" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate a suite of models
def evaluate_models(models, train, test, actual):
	for name, model in models.items():
		# fit models
		fits = fit_models(model, train)
		# make predictions
		predictions = make_predictions(fits, test)
		# evaluate forecast
		total_mae, _ = evaluate_forecasts(predictions, actual)
		# summarize forecast
		summarize_error(name, total_mae)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea66270331556-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea66270331556-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea66270331556-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea66270331556-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea66270331556-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea66270331556-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-1"><span class="crayon-p"># evaluate a suite of models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea66270331556-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-3"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea66270331556-4"><span class="crayon-h">		</span><span class="crayon-p"># fit models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-5"><span class="crayon-h">		</span><span class="crayon-v">fits</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea66270331556-6"><span class="crayon-h">		</span><span class="crayon-p"># make predictions</span></div><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-7"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">fits</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea66270331556-8"><span class="crayon-h">		</span><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-9"><span class="crayon-h">		</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea66270331556-10"><span class="crayon-h">		</span><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea66270331556-11"><span class="crayon-h">		</span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We now have everything we need to evaluate machine learning models.</p>
<h2>Evaluate Linear Algorithms</h2>
<p>In this section, we will spot check a suite of linear machine learning algorithms.</p>
<p>Linear algorithms are those that assume that the output is a linear function of the input variables. This is much like the assumptions of classical time series forecasting models like ARIMA.</p>
<p>Spot checking means evaluating a suite of models in order to get a rough idea of what works. We are interested in any models that outperform a simple autoregression model AR(2) that achieves a MAE error of about 0.487.</p>
<p>We will test eight linear machine learning algorithms with their default configuration; specifically:</p>
<ul>
<li>Linear Regression</li>
<li>Lasso Linear Regression</li>
<li>Ridge Regression</li>
<li>Elastic Net Regression</li>
<li>Huber Regression</li>
<li>Lasso Lars Linear Regression</li>
<li>Passive Aggressive Regression</li>
<li>Stochastic Gradient Descent Regression</li>
</ul>
<p>We can define these models in the <em>get_models()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea69032619907" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea69032619907-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea69032619907-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-1"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-2"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-3"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-4"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-5"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-6"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-7"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-8"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-9"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-10"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-11"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea69032619907-12"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea69032619907-13"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea6c725788373" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate linear algorithms
from numpy import load
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from sklearn.base import clone
from sklearn.linear_model import LinearRegression
from sklearn.linear_model import Lasso
from sklearn.linear_model import Ridge
from sklearn.linear_model import ElasticNet
from sklearn.linear_model import HuberRegressor
from sklearn.linear_model import LassoLars
from sklearn.linear_model import PassiveAggressiveRegressor
from sklearn.linear_model import SGDRegressor

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return true if the array has any non-nan values
def has_data(data):
	return count_nonzero(isnan(data)) &lt; len(data)

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# fit a single model
def fit_model(model, X, y):
	# clone the model configuration
	local_model = clone(model)
	# fit the model
	local_model.fit(X, y)
	return local_model

# fit one model for each variable and each forecast lead time [var][time][model]
def fit_models(model, train):
	# prepare structure for saving models
	models = [[list() for _ in range(train.shape[1])] for _ in range(train.shape[0])]
	# enumerate vars
	for i in range(train.shape[0]):
		# enumerate lead times
		for j in range(train.shape[1]):
			# get data
			data = train[i, j]
			X, y = data[:, :-1], data[:, -1]
			# fit model
			local_model = fit_model(model, X, y)
			models[i][j].append(local_model)
	return models

# return forecasts as [chunks][var][time]
def make_predictions(models, test):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks
	for i in range(test.shape[0]):
		# enumerate variables
		chunk_predictions = list()
		for j in range(test.shape[1]):
			# get the input pattern for this chunk and target
			pattern = test[i,j]
			# assume a nan forecast
			forecasts = array([nan for _ in range(len(lead_times))])
			# check we can make a forecast
			if has_data(pattern):
				pattern = pattern.reshape((1, len(pattern)))
				# forecast each lead time
				forecasts = list()
				for k in range(len(lead_times)):
					yhat = models[j][k][0].predict(pattern)
					forecasts.append(yhat[0])
				forecasts = array(forecasts)
			# save forecasts for each lead time for this variable
			chunk_predictions.append(forecasts)
		# save forecasts for this chunk
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae):
	print('%s: %.3f MAE' % (name, total_mae))

# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models

# evaluate a suite of models
def evaluate_models(models, train, test, actual):
	for name, model in models.items():
		# fit models
		fits = fit_models(model, train)
		# make predictions
		predictions = make_predictions(fits, test)
		# evaluate forecast
		total_mae, _ = evaluate_forecasts(predictions, actual)
		# summarize forecast
		summarize_error(name, total_mae)

# load supervised datasets
train = load('AirQualityPrediction/supervised_train.npy')
test = load('AirQualityPrediction/supervised_test.npy')
print(train.shape, test.shape)
# load test chunks for validation
testset = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
test_chunks = to_chunks(testset)
actual = prepare_test_forecasts(test_chunks)
# prepare list of models
models = get_models()
# evaluate models
evaluate_models(models, train, test, actual)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-146">146</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-148">148</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-150">150</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-152">152</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-154">154</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-156">156</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-158">158</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-160">160</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-162">162</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-164">164</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-166">166</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-168">168</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-170">170</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-172">172</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-174">174</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-176">176</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-178">178</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-180">180</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea6c725788373-182">182</div><div class="crayon-num" data-line="crayon-5bd2bf14aea6c725788373-183">183</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-1"><span class="crayon-p"># evaluate linear algorithms</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">base </span><span class="crayon-e">import </span><span class="crayon-r">clone</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LinearRegression</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-11"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lasso</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-12"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Ridge</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-13"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">ElasticNet</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-14"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">HuberRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-15"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LassoLars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-16"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">PassiveAggressiveRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-17"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-v">SGDRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-18">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-19"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-20"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-21"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-22"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-23"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-24"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-25"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-26"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-27"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-28"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-30"><span class="crayon-p"># return true if the array has any non-nan values</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-31"><span class="crayon-e">def </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-32"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-34"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-35"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-36"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-38"><span class="crayon-p"># fit a single model</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-39"><span class="crayon-e">def </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-40"><span class="crayon-h">	</span><span class="crayon-p"># clone the model configuration</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-41"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">clone</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-42"><span class="crayon-h">	</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-43"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-44"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">local_model</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-46"><span class="crayon-p"># fit one model for each variable and each forecast lead time [var][time][model]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-47"><span class="crayon-e">def </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-48"><span class="crayon-h">	</span><span class="crayon-p"># prepare structure for saving models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-49"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-50"><span class="crayon-h">	</span><span class="crayon-p"># enumerate vars</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-51"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-52"><span class="crayon-h">		</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-53"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-54"><span class="crayon-h">			</span><span class="crayon-p"># get data</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-55"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-56"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-57"><span class="crayon-h">			</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-58"><span class="crayon-h">			</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-59"><span class="crayon-h">			</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">local_model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-60"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-61">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-62"><span class="crayon-p"># return forecasts as [chunks][var][time]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-63"><span class="crayon-e">def </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-64"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-65"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-66"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-67"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-68"><span class="crayon-h">		</span><span class="crayon-p"># enumerate variables</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-69"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-70"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-71"><span class="crayon-h">			</span><span class="crayon-p"># get the input pattern for this chunk and target</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-72"><span class="crayon-h">			</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-73"><span class="crayon-h">			</span><span class="crayon-p"># assume a nan forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-74"><span class="crayon-h">			</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-75"><span class="crayon-h">			</span><span class="crayon-p"># check we can make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-76"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-77"><span class="crayon-h">				</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-78"><span class="crayon-h">				</span><span class="crayon-p"># forecast each lead time</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-79"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-80"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-81"><span class="crayon-h">					</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-82"><span class="crayon-h">					</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-83"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-84"><span class="crayon-h">			</span><span class="crayon-p"># save forecasts for each lead time for this variable</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-85"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-86"><span class="crayon-h">		</span><span class="crayon-p"># save forecasts for this chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-87"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-88"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-89"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-90">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-91"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-92"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-93"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-94"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-95"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-96"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-97"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-98"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-99"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-100"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-101"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-102"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-103"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-104">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-105"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-106"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-107"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-108"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-109"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-110"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-111"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-112">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-113"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-114"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-115"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-116"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-117"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-118"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-119"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-120"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-121"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-122"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-123"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-124"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-125"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-126"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-127"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-128"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-129"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-130"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-131"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-132"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-133"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-134"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-135"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-136"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-137"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-138"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-139"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-140"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-141">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-142"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-143"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-144"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f MAE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-145">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-146"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-147"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-148"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-149"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-150"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-151"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-152"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-153"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-154"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-155"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-156"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-157"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-158"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-159">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-160"><span class="crayon-p"># evaluate a suite of models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-161"><span class="crayon-e">def </span><span class="crayon-e">evaluate_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-162"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-163"><span class="crayon-h">		</span><span class="crayon-p"># fit models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-164"><span class="crayon-h">		</span><span class="crayon-v">fits</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-165"><span class="crayon-h">		</span><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-166"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">fits</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-167"><span class="crayon-h">		</span><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-168"><span class="crayon-h">		</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-169"><span class="crayon-h">		</span><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-170"><span class="crayon-h">		</span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-171">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-172"><span class="crayon-p"># load supervised datasets</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-173"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_train.npy'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-174"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_test.npy'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-175"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-176"><span class="crayon-p"># load test chunks for validation</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-177"><span class="crayon-v">testset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-178"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">testset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-179"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-180"><span class="crayon-p"># prepare list of models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-181"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea6c725788373-182"><span class="crayon-p"># evaluate models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea6c725788373-183"><span class="crayon-e">evaluate_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0118 seconds] -->
<p>Running the example prints the MAE for each of the evaluated algorithms.</p>
<p>We can see that many of the algorithms show skill compared to a simple AR model, achieving a MAE below 0.487.</p>
<p>Huber regression seems to perform the best (with default configuration), achieving a MAE of 0.434.</p>
<p>This is interesting as <a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.HuberRegressor.html">Huber regression</a>, or <a href="https://en.wikipedia.org/wiki/Robust_regression">robust regression</a> with Huber loss, is a method that is designed to be robust to outliers in the training dataset. It may suggest that the other methods may perform better with a little more data preparation, such as standardization and/or outlier removal.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea74640135983" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
lr: 0.454 MAE
lasso: 0.624 MAE
ridge: 0.454 MAE
en: 0.595 MAE
huber: 0.434 MAE
llars: 0.631 MAE
pa: 0.833 MAE
sgd: 0.457 MAE</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea74640135983-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea74640135983-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea74640135983-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea74640135983-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea74640135983-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea74640135983-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea74640135983-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea74640135983-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea74640135983-1">lr: 0.454 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea74640135983-2">lasso: 0.624 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea74640135983-3">ridge: 0.454 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea74640135983-4">en: 0.595 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea74640135983-5">huber: 0.434 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea74640135983-6">llars: 0.631 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea74640135983-7">pa: 0.833 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea74640135983-8">sgd: 0.457 MAE</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Nonlinear Algorithms</h2>
<p>We can use the same framework to evaluate the performance of a suite of nonlinear and ensemble machine learning algorithms.</p>
<p>Specifically:</p>
<p><strong>Nonlinear Algorithms</strong></p>
<ul>
<li>k-Nearest Neighbors</li>
<li>Classification and Regression Trees</li>
<li>Extra Tree</li>
<li>Support Vector Regression</li>
</ul>
<p><strong>Ensemble Algorithms</strong></p>
<ul>
<li>Adaboost</li>
<li>Bagged Decision Trees</li>
<li>Random Forest</li>
<li>Extra Trees</li>
<li>Gradient Boosting Machines</li>
</ul>
<p>The <em>get_models()</em> function below defines these nine models.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea78601537685" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare a list of ml models
def get_models(models=dict()):
	# non-linear models
	models['knn'] = KNeighborsRegressor(n_neighbors=7)
	models['cart'] = DecisionTreeRegressor()
	models['extra'] = ExtraTreeRegressor()
	models['svmr'] = SVR()
	# # ensemble models
	n_trees = 100
	models['ada'] = AdaBoostRegressor(n_estimators=n_trees)
	models['bag'] = BaggingRegressor(n_estimators=n_trees)
	models['rf'] = RandomForestRegressor(n_estimators=n_trees)
	models['et'] = ExtraTreesRegressor(n_estimators=n_trees)
	models['gbm'] = GradientBoostingRegressor(n_estimators=n_trees)
	print('Defined %d models' % len(models))
	return models</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea78601537685-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea78601537685-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-1"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-2"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-3"><span class="crayon-h">	</span><span class="crayon-p"># non-linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-4"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'knn'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">KNeighborsRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_neighbors</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-5"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'cart'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DecisionTreeRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-6"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'extra'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExtraTreeRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-7"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'svmr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SVR</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-8"><span class="crayon-h">	</span><span class="crayon-p"># # ensemble models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-9"><span class="crayon-h">	</span><span class="crayon-v">n_trees</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-10"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ada'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AdaBoostRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-11"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'bag'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BaggingRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-12"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'rf'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RandomForestRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-13"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'et'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExtraTreesRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-14"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'gbm'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">GradientBoostingRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea78601537685-15"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea78601537685-16"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea7a967210261" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# spot check nonlinear algorithms
from numpy import load
from numpy import loadtxt
from numpy import nan
from numpy import isnan
from numpy import count_nonzero
from numpy import unique
from numpy import array
from sklearn.base import clone
from sklearn.neighbors import KNeighborsRegressor
from sklearn.tree import DecisionTreeRegressor
from sklearn.tree import ExtraTreeRegressor
from sklearn.svm import SVR
from sklearn.ensemble import AdaBoostRegressor
from sklearn.ensemble import BaggingRegressor
from sklearn.ensemble import RandomForestRegressor
from sklearn.ensemble import ExtraTreesRegressor
from sklearn.ensemble import GradientBoostingRegressor

# split the dataset by 'chunkID', return a list of chunks
def to_chunks(values, chunk_ix=0):
	chunks = list()
	# get the unique chunk ids
	chunk_ids = unique(values[:, chunk_ix])
	# group rows by chunk id
	for chunk_id in chunk_ids:
		selection = values[:, chunk_ix] == chunk_id
		chunks.append(values[selection, :])
	return chunks

# return true if the array has any non-nan values
def has_data(data):
	return count_nonzero(isnan(data)) &lt; len(data)

# return a list of relative forecast lead times
def get_lead_times():
	return [1, 2, 3, 4, 5, 10, 17, 24, 48, 72]

# fit a single model
def fit_model(model, X, y):
	# clone the model configuration
	local_model = clone(model)
	# fit the model
	local_model.fit(X, y)
	return local_model

# fit one model for each variable and each forecast lead time [var][time][model]
def fit_models(model, train):
	# prepare structure for saving models
	models = [[list() for _ in range(train.shape[1])] for _ in range(train.shape[0])]
	# enumerate vars
	for i in range(train.shape[0]):
		# enumerate lead times
		for j in range(train.shape[1]):
			# get data
			data = train[i, j]
			X, y = data[:, :-1], data[:, -1]
			# fit model
			local_model = fit_model(model, X, y)
			models[i][j].append(local_model)
	return models

# return forecasts as [chunks][var][time]
def make_predictions(models, test):
	lead_times = get_lead_times()
	predictions = list()
	# enumerate chunks
	for i in range(test.shape[0]):
		# enumerate variables
		chunk_predictions = list()
		for j in range(test.shape[1]):
			# get the input pattern for this chunk and target
			pattern = test[i,j]
			# assume a nan forecast
			forecasts = array([nan for _ in range(len(lead_times))])
			# check we can make a forecast
			if has_data(pattern):
				pattern = pattern.reshape((1, len(pattern)))
				# forecast each lead time
				forecasts = list()
				for k in range(len(lead_times)):
					yhat = models[j][k][0].predict(pattern)
					forecasts.append(yhat[0])
				forecasts = array(forecasts)
			# save forecasts for each lead time for this variable
			chunk_predictions.append(forecasts)
		# save forecasts for this chunk
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# convert the test dataset in chunks to [chunk][variable][time] format
def prepare_test_forecasts(test_chunks):
	predictions = list()
	# enumerate chunks to forecast
	for rows in test_chunks:
		# enumerate targets for chunk
		chunk_predictions = list()
		for j in range(3, rows.shape[1]):
			yhat = rows[:, j]
			chunk_predictions.append(yhat)
		chunk_predictions = array(chunk_predictions)
		predictions.append(chunk_predictions)
	return array(predictions)

# calculate the error between an actual and predicted value
def calculate_error(actual, predicted):
	# give the full actual value if predicted is nan
	if isnan(predicted):
		return abs(actual)
	# calculate abs difference
	return abs(actual - predicted)

# evaluate a forecast in the format [chunk][variable][time]
def evaluate_forecasts(predictions, testset):
	lead_times = get_lead_times()
	total_mae, times_mae = 0.0, [0.0 for _ in range(len(lead_times))]
	total_c, times_c = 0, [0 for _ in range(len(lead_times))]
	# enumerate test chunks
	for i in range(len(test_chunks)):
		# convert to forecasts
		actual = testset[i]
		predicted = predictions[i]
		# enumerate target variables
		for j in range(predicted.shape[0]):
			# enumerate lead times
			for k in range(len(lead_times)):
				# skip if actual in nan
				if isnan(actual[j, k]):
					continue
				# calculate error
				error = calculate_error(actual[j, k], predicted[j, k])
				# update statistics
				total_mae += error
				times_mae[k] += error
				total_c += 1
				times_c[k] += 1
	# normalize summed absolute errors
	total_mae /= total_c
	times_mae = [times_mae[i]/times_c[i] for i in range(len(times_mae))]
	return total_mae, times_mae

# summarize scores
def summarize_error(name, total_mae):
	print('%s: %.3f MAE' % (name, total_mae))

# prepare a list of ml models
def get_models(models=dict()):
	# non-linear models
	models['knn'] = KNeighborsRegressor(n_neighbors=7)
	models['cart'] = DecisionTreeRegressor()
	models['extra'] = ExtraTreeRegressor()
	models['svmr'] = SVR()
	# # ensemble models
	n_trees = 100
	models['ada'] = AdaBoostRegressor(n_estimators=n_trees)
	models['bag'] = BaggingRegressor(n_estimators=n_trees)
	models['rf'] = RandomForestRegressor(n_estimators=n_trees)
	models['et'] = ExtraTreesRegressor(n_estimators=n_trees)
	models['gbm'] = GradientBoostingRegressor(n_estimators=n_trees)
	print('Defined %d models' % len(models))
	return models

# evaluate a suite of models
def evaluate_models(models, train, test, actual):
	for name, model in models.items():
		# fit models
		fits = fit_models(model, train)
		# make predictions
		predictions = make_predictions(fits, test)
		# evaluate forecast
		total_mae, _ = evaluate_forecasts(predictions, actual)
		# summarize forecast
		summarize_error(name, total_mae)

# load supervised datasets
train = load('AirQualityPrediction/supervised_train.npy')
test = load('AirQualityPrediction/supervised_test.npy')
print(train.shape, test.shape)
# load test chunks for validation
testset = loadtxt('AirQualityPrediction/naive_test.csv', delimiter=',')
test_chunks = to_chunks(testset)
actual = prepare_test_forecasts(test_chunks)
# prepare list of models
models = get_models()
# evaluate models
evaluate_models(models, train, test, actual)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-146">146</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-148">148</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-150">150</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-152">152</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-154">154</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-156">156</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-158">158</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-160">160</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-162">162</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-164">164</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-166">166</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-168">168</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-170">170</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-172">172</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-174">174</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-176">176</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-178">178</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-180">180</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-182">182</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-184">184</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea7a967210261-186">186</div><div class="crayon-num" data-line="crayon-5bd2bf14aea7a967210261-187">187</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-1"><span class="crayon-p"># spot check nonlinear algorithms</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">loadtxt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-6"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">count_nonzero</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">unique</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-8"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">base </span><span class="crayon-e">import </span><span class="crayon-r">clone</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">neighbors </span><span class="crayon-e">import </span><span class="crayon-e">KNeighborsRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-11"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">tree </span><span class="crayon-e">import </span><span class="crayon-e">DecisionTreeRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-12"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">tree </span><span class="crayon-e">import </span><span class="crayon-e">ExtraTreeRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-13"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">svm </span><span class="crayon-e">import </span><span class="crayon-e">SVR</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-14"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-e">import </span><span class="crayon-e">AdaBoostRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-15"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-e">import </span><span class="crayon-e">BaggingRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-16"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-e">import </span><span class="crayon-e">RandomForestRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-17"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-e">import </span><span class="crayon-e">ExtraTreesRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-18"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-e">import </span><span class="crayon-v">GradientBoostingRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-20"><span class="crayon-p"># split the dataset by 'chunkID', return a list of chunks</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-21"><span class="crayon-e">def </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-22"><span class="crayon-h">	</span><span class="crayon-v">chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-23"><span class="crayon-h">	</span><span class="crayon-p"># get the unique chunk ids</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-24"><span class="crayon-h">	</span><span class="crayon-v">chunk_ids</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">unique</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-25"><span class="crayon-h">	</span><span class="crayon-p"># group rows by chunk id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-26"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ids</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-27"><span class="crayon-h">		</span><span class="crayon-v">selection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chunk_ix</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">chunk_id</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-28"><span class="crayon-e">		</span><span class="crayon-v">chunks</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">selection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-29"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-30">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-31"><span class="crayon-p"># return true if the array has any non-nan values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-32"><span class="crayon-e">def </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-33"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">count_nonzero</span><span class="crayon-sy">(</span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-34">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-35"><span class="crayon-p"># return a list of relative forecast lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-36"><span class="crayon-e">def </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-37"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">24</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-38">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-39"><span class="crayon-p"># fit a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-40"><span class="crayon-e">def </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-41"><span class="crayon-h">	</span><span class="crayon-p"># clone the model configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-42"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">clone</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-43"><span class="crayon-h">	</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-44"><span class="crayon-h">	</span><span class="crayon-v">local_model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-45"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">local_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-46">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-47"><span class="crayon-p"># fit one model for each variable and each forecast lead time [var][time][model]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-48"><span class="crayon-e">def </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-49"><span class="crayon-h">	</span><span class="crayon-p"># prepare structure for saving models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-50"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-51"><span class="crayon-h">	</span><span class="crayon-p"># enumerate vars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-52"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-53"><span class="crayon-h">		</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-54"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-55"><span class="crayon-h">			</span><span class="crayon-p"># get data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-56"><span class="crayon-h">			</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-57"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-58"><span class="crayon-h">			</span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-59"><span class="crayon-h">			</span><span class="crayon-v">local_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-60"><span class="crayon-h">			</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">local_model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-61"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-62">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-63"><span class="crayon-p"># return forecasts as [chunks][var][time]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-64"><span class="crayon-e">def </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-65"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-66"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-67"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-68"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-69"><span class="crayon-h">		</span><span class="crayon-p"># enumerate variables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-70"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-71"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-72"><span class="crayon-h">			</span><span class="crayon-p"># get the input pattern for this chunk and target</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-73"><span class="crayon-h">			</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-74"><span class="crayon-h">			</span><span class="crayon-p"># assume a nan forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-75"><span class="crayon-h">			</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">nan </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-76"><span class="crayon-h">			</span><span class="crayon-p"># check we can make a forecast</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-77"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">has_data</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-78"><span class="crayon-h">				</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-79"><span class="crayon-h">				</span><span class="crayon-p"># forecast each lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-80"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-81"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-82"><span class="crayon-h">					</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-83"><span class="crayon-h">					</span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-84"><span class="crayon-h">				</span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-85"><span class="crayon-h">			</span><span class="crayon-p"># save forecasts for each lead time for this variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-86"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-87"><span class="crayon-h">		</span><span class="crayon-p"># save forecasts for this chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-88"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-89"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-90"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-91">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-92"><span class="crayon-p"># convert the test dataset in chunks to [chunk][variable][time] format</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-93"><span class="crayon-e">def </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-94"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-95"><span class="crayon-h">	</span><span class="crayon-p"># enumerate chunks to forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-96"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">rows </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test_chunks</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-97"><span class="crayon-h">		</span><span class="crayon-p"># enumerate targets for chunk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-98"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-99"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-100"><span class="crayon-h">			</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rows</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-101"><span class="crayon-h">			</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-102"><span class="crayon-h">		</span><span class="crayon-v">chunk_predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-103"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">chunk_predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-104"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-105">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-106"><span class="crayon-p"># calculate the error between an actual and predicted value</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-107"><span class="crayon-e">def </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-108"><span class="crayon-h">	</span><span class="crayon-p"># give the full actual value if predicted is nan</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-109"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-110"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-111"><span class="crayon-h">	</span><span class="crayon-p"># calculate abs difference</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-112"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">abs</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-113">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-114"><span class="crayon-p"># evaluate a forecast in the format [chunk][variable][time]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-115"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-116"><span class="crayon-h">	</span><span class="crayon-v">lead_times</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_lead_times</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-117"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-118"><span class="crayon-h">	</span><span class="crayon-v">total_c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-119"><span class="crayon-h">	</span><span class="crayon-p"># enumerate test chunks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-120"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-121"><span class="crayon-h">		</span><span class="crayon-p"># convert to forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-122"><span class="crayon-h">		</span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-123"><span class="crayon-h">		</span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-124"><span class="crayon-h">		</span><span class="crayon-p"># enumerate target variables</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-125"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-126"><span class="crayon-h">			</span><span class="crayon-p"># enumerate lead times</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-127"><span class="crayon-h">			</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">lead_times</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-128"><span class="crayon-h">				</span><span class="crayon-p"># skip if actual in nan</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-129"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-130"><span class="crayon-h">					</span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-131"><span class="crayon-h">				</span><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-132"><span class="crayon-h">				</span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calculate_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-133"><span class="crayon-h">				</span><span class="crayon-p"># update statistics</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-134"><span class="crayon-h">				</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-135"><span class="crayon-e">				</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-136"><span class="crayon-e">				</span><span class="crayon-v">total_c</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-137"><span class="crayon-h">				</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">k</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-138"><span class="crayon-h">	</span><span class="crayon-p"># normalize summed absolute errors</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-139"><span class="crayon-h">	</span><span class="crayon-v">total_mae</span><span class="crayon-h"> </span><span class="crayon-o">/=</span><span class="crayon-h"> </span><span class="crayon-e">total_c</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-140"><span class="crayon-e">	</span><span class="crayon-v">times_mae</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">times_mae</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">/</span><span class="crayon-v">times_c</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">times_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-141"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">times_mae</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-142">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-143"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-144"><span class="crayon-e">def </span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-145"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: %.3f MAE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-146">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-147"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-148"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-149"><span class="crayon-h">	</span><span class="crayon-p"># non-linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-150"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'knn'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">KNeighborsRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_neighbors</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-151"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'cart'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DecisionTreeRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-152"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'extra'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExtraTreeRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-153"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'svmr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SVR</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-154"><span class="crayon-h">	</span><span class="crayon-p"># # ensemble models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-155"><span class="crayon-h">	</span><span class="crayon-v">n_trees</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-156"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ada'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">AdaBoostRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-157"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'bag'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BaggingRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-158"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'rf'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RandomForestRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-159"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'et'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ExtraTreesRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-160"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'gbm'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">GradientBoostingRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">n_estimators</span><span class="crayon-o">=</span><span class="crayon-v">n_trees</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-161"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-162"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-163">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-164"><span class="crayon-p"># evaluate a suite of models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-165"><span class="crayon-e">def </span><span class="crayon-e">evaluate_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-166"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-167"><span class="crayon-h">		</span><span class="crayon-p"># fit models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-168"><span class="crayon-h">		</span><span class="crayon-v">fits</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_models</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-169"><span class="crayon-h">		</span><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-170"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_predictions</span><span class="crayon-sy">(</span><span class="crayon-v">fits</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-171"><span class="crayon-h">		</span><span class="crayon-p"># evaluate forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-172"><span class="crayon-h">		</span><span class="crayon-v">total_mae</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-173"><span class="crayon-h">		</span><span class="crayon-p"># summarize forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-174"><span class="crayon-h">		</span><span class="crayon-e">summarize_error</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">total_mae</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-175">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-176"><span class="crayon-p"># load supervised datasets</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-177"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_train.npy'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-178"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/supervised_test.npy'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-179"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-180"><span class="crayon-p"># load test chunks for validation</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-181"><span class="crayon-v">testset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loadtxt</span><span class="crayon-sy">(</span><span class="crayon-s">'AirQualityPrediction/naive_test.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">delimiter</span><span class="crayon-o">=</span><span class="crayon-s">','</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-182"><span class="crayon-v">test_chunks</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_chunks</span><span class="crayon-sy">(</span><span class="crayon-v">testset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-183"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_test_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test_chunks</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-184"><span class="crayon-p"># prepare list of models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-185"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea7a967210261-186"><span class="crayon-p"># evaluate models</span></div><div class="crayon-line" id="crayon-5bd2bf14aea7a967210261-187"><span class="crayon-e">evaluate_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0125 seconds] -->
<p>Running the example, we can see that many algorithms performed well compared to the baseline of an autoregression algorithm, although none performed as well as Huber regression in the previous section.</p>
<p>Both support vector regression and perhaps gradient boosting machines may be worth further investigation of achieving MAEs of 0.437 and 0.450 respectively.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea82267895666" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
knn: 0.484 MAE
cart: 0.631 MAE
extra: 0.630 MAE
svmr: 0.437 MAE
ada: 0.717 MAE
bag: 0.471 MAE
rf: 0.470 MAE
et: 0.469 MAE
gbm: 0.450 MAE</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea82267895666-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea82267895666-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea82267895666-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea82267895666-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea82267895666-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea82267895666-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea82267895666-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea82267895666-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf14aea82267895666-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea82267895666-1">knn: 0.484 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea82267895666-2">cart: 0.631 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea82267895666-3">extra: 0.630 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea82267895666-4">svmr: 0.437 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea82267895666-5">ada: 0.717 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea82267895666-6">bag: 0.471 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea82267895666-7">rf: 0.470 MAE</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea82267895666-8">et: 0.469 MAE</div><div class="crayon-line" id="crayon-5bd2bf14aea82267895666-9">gbm: 0.450 MAE</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Tune Lag Size</h2>
<p>In the previous spot check experiments, the number of lag observations was arbitrarily fixed at 12.</p>
<p>We can vary the number of lag observations and evaluate the effect on MAE. Some algorithms may require more or fewer prior observations, but general trends may hold across algorithms.</p>
<p>Prepare the supervised learning dataset with a range of different numbers of lag observations and fit and evaluate the HuberRegressor on each.</p>
<p>I experimented with the following number of lag observations:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea91799233801" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
[1, 3, 6, 12, 24, 36, 48]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea91799233801-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea91799233801-1">[1, 3, 6, 12, 24, 36, 48]</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The results were as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf14aea93712807831" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
1:	0.451
3:	0.445
6:	0.441
12:	0.434
24:	0.423
36:	0.422
48:	0.439</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf14aea93712807831-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea93712807831-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf14aea93712807831-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea93712807831-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf14aea93712807831-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf14aea93712807831-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf14aea93712807831-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf14aea93712807831-1">1:	0.451</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea93712807831-2">3:	0.445</div><div class="crayon-line" id="crayon-5bd2bf14aea93712807831-3">6:	0.441</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea93712807831-4">12:	0.434</div><div class="crayon-line" id="crayon-5bd2bf14aea93712807831-5">24:	0.423</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf14aea93712807831-6">36:	0.422</div><div class="crayon-line" id="crayon-5bd2bf14aea93712807831-7">48:	0.439</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A plot of these results is provided below.</p>
<div id="attachment_6336" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6336" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Number-of-Lag-Observations-vs-MAE-for-Huber-Regression.png" alt="Line Plot of Number of Lag Observations vs MAE for Huber Regression" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Number-of-Lag-Observations-vs-MAE-for-Huber-Regression.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Number-of-Lag-Observations-vs-MAE-for-Huber-Regression-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Number-of-Lag-Observations-vs-MAE-for-Huber-Regression-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Number-of-Lag-Observations-vs-MAE-for-Huber-Regression-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">Line Plot of Number of Lag Observations vs MAE for Huber Regression</p></div>
<p>We can see a general trend of decreasing overall MAE with the increase in the number of lag observations, at least to a point after which error begins to rise again.</p>
<p>The results suggest, at least for the HuberRegressor algorithm, that 36 lag observations may be a good configuration achieving a MAE of 0.422.</p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Preparation</strong>. Explore whether simple data preparation such as standardization or statistical outlier removal can improve model performance.</li>
<li><strong>Engineered Features</strong>. Explore whether engineered features such as median value for forecasted hour of day can improve model performance</li>
<li><strong>Meteorological Variables</strong>. Explore whether adding lag meteorological variables to the models can improve performance.</li>
<li><strong>Cross-Site Models</strong>. Explore whether combining target variables of the same type and re-using the models across sites results in a performance improvement.</li>
<li><strong>Algorithm Tuning</strong>. Explore whether tuning the hyperparameters of some of the better performing algorithms can result in performance improvements.</li>
</ul>
<p>If you explore any of these extensions, I&#8217;d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/data">EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="http://blog.kaggle.com/2012/05/01/chucking-everything-into-a-random-forest-ben-hamner-on-winning-the-air-quality-prediction-hackathon/">Chucking everything into a Random Forest: Ben Hamner on Winning The Air Quality Prediction Hackathon</a></li>
<li><a href="https://github.com/benhamner/Air-Quality-Prediction-Hackathon-Winning-Model">Winning Code for the EMC Data Science Global Hackathon (Air Quality Prediction)</a></li>
<li><a href="https://www.kaggle.com/c/dsg-hackathon/discussion/1821">General approaches to partitioning the models?</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop machine learning models for multi-step time series forecasting of air pollution data.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to impute missing values and transform time series data so that it can be modeled by supervised learning algorithms.</li>
<li>How to develop and evaluate a suite of linear algorithms for multi-step time series forecasting.</li>
<li>How to develop and evaluate a suite of nonlinear algorithms for multi-step time series forecasting.</li>
</ul>
<p>Do you have any questions?<br />
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52">			<div class="textwidget"><p><center><br />
<div class="woo-sc-hr"></div></p>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img style="border: 0;" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" alt="Deep Learning for Time Series Forecasting" align="left" /></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>&#8230;with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br />
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br />
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more&#8230;</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br />
<div class="woo-sc-hr"></div><br />
</center></p>
</div>
		</div></div>	</section><!-- /.entry -->
	<div class="fix"></div>
<aside id="post-author">
	<div class="profile-image"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' /></div>
	<div class="profile-content">
		<h4>About Jason Brownlee</h4>
		Jason Brownlee, Ph.D. is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
			<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">&rarr;</span>			</a>
		</div><!--#profile-link-->
			</div>
	<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
	        <div class="post-entries">
	            <div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-develop-autoregressive-forecasting-models-for-multi-step-air-pollution-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop Autoregressive Forecasting Models for Multi-Step Air Pollution Time Series Forecasting</a></div>
	            <div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-grid-search-triple-exponential-smoothing-for-time-series-forecasting-in-python/" rel="next">How to Grid Search Triple Exponential Smoothing for Time Series Forecasting in Python <i class="fa fa-angle-right"></i></a></div>
	            <div class="fix"></div>
	        </div>

		<div id="comments">		 	<h3 id="comments-title">8 Responses to <em>How to Develop Machine Learning Models for Multivariate Multi-Step Air Pollution Time Series Forecasting</em></h3>
		 	<ol class="commentlist">
				
		<li id="comment-452082" class="comment even thread-even depth-1">

	      	<div id="li-comment-452082" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/81c8679bd689900b47b728da84d3b3a0?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/81c8679bd689900b47b728da84d3b3a0?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='https://tudosobrerobos.com.br/' rel='external nofollow' class='url'>Alisson</a></span>
	                <span class="date">October 19, 2018 at 9:00 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452082" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Wow, that&#8217;s a complete tutorial! Tnks</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452082' onclick='return addComment.moveForm( "comment-452082", "452082", "respond", "6333" )' aria-label='Reply to Alisson'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452092" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-452092" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 19, 2018 at 10:58 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452092" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks!</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452092' onclick='return addComment.moveForm( "comment-452092", "452092", "respond", "6333" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452132" class="comment even thread-odd thread-alt depth-1">

	      	<div id="li-comment-452132" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/52c19e88d5e749779fed9ab6bafffdff?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/52c19e88d5e749779fed9ab6bafffdff?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">vas</span>
	                <span class="date">October 19, 2018 at 8:30 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452132" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>i d like to apply something similar to the lottery viewed as time series with multiple time steps</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452132' onclick='return addComment.moveForm( "comment-452132", "452132", "respond", "6333" )' aria-label='Reply to vas'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452161" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-452161" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 20, 2018 at 5:54 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452161" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You cannot predict the lottery:<br />
<a href="https://machinelearningmastery.com/faq/single-faq/can-i-use-machine-learning-to-predict-the-lottery" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/can-i-use-machine-learning-to-predict-the-lottery</a></p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452161' onclick='return addComment.moveForm( "comment-452161", "452161", "respond", "6333" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452272" class="comment even thread-even depth-1">

	      	<div id="li-comment-452272" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/c7aa2beafedbc32acee384a70988d1e2?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/c7aa2beafedbc32acee384a70988d1e2?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://www.analytico.ai' rel='external nofollow' class='url'>Allan Weber</a></span>
	                <span class="date">October 21, 2018 at 7:16 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452272" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Great tutorial, Jason!  I&#8217;ve learned some useful tricks, again. I&#8217;d be interested to know how long it takes for you to design, develop and test the code like this. This may useful for calculating some comparison metric for predicting the future level of data scientist in the specific lead times &#8211; another interesting time series forecasting problem 😉</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452272' onclick='return addComment.moveForm( "comment-452272", "452272", "respond", "6333" )' aria-label='Reply to Allan Weber'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452314" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-452314" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 22, 2018 at 6:18 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452314" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>It really depends on the experience of the developer. I wrote the code and words for this tutorial in less than one day, but I do have decades of experience.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452314' onclick='return addComment.moveForm( "comment-452314", "452314", "respond", "6333" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452370" class="comment even depth-3">

	      	<div id="li-comment-452370" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/c7aa2beafedbc32acee384a70988d1e2?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/c7aa2beafedbc32acee384a70988d1e2?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://www.analytico.ai' rel='external nofollow' class='url'>Allan Weber</a></span>
	                <span class="date">October 22, 2018 at 10:28 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452370" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>That&#8217;s impressive! This is clearly the &#8220;ML guru&#8221; level.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452370' onclick='return addComment.moveForm( "comment-452370", "452370", "respond", "6333" )' aria-label='Reply to Allan Weber'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452400" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4">

	      	<div id="li-comment-452400" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 23, 2018 at 6:24 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#comment-452400" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-452400' onclick='return addComment.moveForm( "comment-452400", "452400", "respond", "6333" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			</ol>
		 	</div>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/how-to-develop-machine-learning-models-for-multivariate-multi-step-air-pollution-time-series-forecasting/#respond" style="display:none;">Click here to cancel reply.</a></small></h3>			<form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea tabindex="4" id="comment" name="comment" cols="50" rows="10" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><input id="author" name="author" type="text" class="txt" tabindex="1" value="" size="30" aria-required='true' /><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input id="email" name="email" type="text" class="txt" tabindex="2" value="" size="30" aria-required='true' /><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input id="url" name="url" type="text" class="txt" tabindex="3" value="" size="30" /><label for="url">Website</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit Comment" /> <input type='hidden' name='comment_post_ID' value='6333' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="d00182fe43" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="110"/></p>			</form>
			</div><!-- #respond -->
	     
            </section><!-- /#main -->
                
            <aside id="sidebar">
<div id="woo_blogauthorinfo-2" class="widget widget_woo_blogauthorinfo"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&#038;d=mm&#038;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' /></span>
<p>Hi, I'm Jason Brownlee, Ph.D.
<br>
My goal is to make developers like <em>YOU</em> awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div id="text-51" class="widget widget_text">			<div class="textwidget"><p><center><br />
<strong>Deep Learning for Time Series</strong><br />
Forecast the future with MLPs, CNNs, and LSTMs.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br />
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" /></a><br />
</center></p>
</div>
		</div>
		<div id="woo_tabs-2" class="widget widget_woo_tabs"> 		<div id="tabs">

            <ul class="wooTabs">
                                <li class="popular"><a href="#tab-pop">Popular</a></li>                                                            </ul>

            <div class="clear"></div>

            <div class="boxes box inside">

	            
                                <ul id="tab-pop" class="list">
                    	<li>
		<a href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/" title="How to Develop a Deep Learning Photo Caption Generator from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/09/example-150x150.jpg" class="thumbnail wp-post-image" alt="Photo of a dog at the beach." title="How to Develop a Deep Learning Photo Caption Generator from Scratch" /></a>		<a title="How to Develop a Deep Learning Photo Caption Generator from Scratch" href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/">How to Develop a Deep Learning Photo Caption Generator from Scratch</a>
		<span class="meta">November 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Neural Machine Translation System in Keras" title="How to Develop a Neural Machine Translation System from Scratch" /></a>		<a title="How to Develop a Neural Machine Translation System from Scratch" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/">How to Develop a Neural Machine Translation System from Scratch</a>
		<span class="meta">January 10, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" /></a>		<a title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</a>
		<span class="meta">October 26, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" /></a>		<a title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a>
		<span class="meta">November 2, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" title="How to Use the Keras Functional API for Deep Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/multiple_inputs-150x150.png" class="thumbnail wp-post-image" alt="Neural Network Graph With Multiple Inputs" title="How to Use the Keras Functional API for Deep Learning" /></a>		<a title="How to Use the Keras Functional API for Deep Learning" href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">How to Use the Keras Functional API for Deep Learning</a>
		<span class="meta">October 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-a-Word-Level-Neural-Language-Model-and-Use-it-to-Generate-Text-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" /></a>		<a title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/">How to Develop a Word-Level Neural Language Model and Use it to Generate Text</a>
		<span class="meta">November 10, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" class="thumbnail wp-post-image" alt="Difference Between Classification and Regression in Machine Learning" title="Difference Between Classification and Regression in Machine Learning" /></a>		<a title="Difference Between Classification and Regression in Machine Learning" href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/">Difference Between Classification and Regression in Machine Learning</a>
		<span class="meta">December 11, 2017</span>
		<div class="fix"></div>
	</li>
	                </ul>
                                                                
            </div><!-- /.boxes -->

        </div><!-- /wooTabs -->

        </div>         <div id="custom_html-2" class="widget_text widget widget_custom_html"><h3>You might also like&#8230;</h3><div class="textwidget custom-html-widget"><ul>
	<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
  <li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
	<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
	<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
	<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->

		</div><!-- /#main-sidebar-container -->         

		
    </div><!-- /#content -->
	
	<footer id="footer" class="col-full">

		
		<div id="copyright" class="col-left">
			<p>&copy; 2018 Machine Learning Mastery. All Rights Reserved. </p>		</div>

		<div id="credit" class="col-right">
			<p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p></p>		</div>

	</footer>

	
	</div><!-- /#inner-wrapper -->

</div><!-- /#wrapper -->

<div class="fix"></div><!--/.fix-->

<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8'></script>
<script async="async" type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.8'></script>
</body>
</html>