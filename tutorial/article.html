<!DOCTYPE html><html><head><meta charSet="UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"/><title>Android相机开发那些坑 - 云+社区 - 腾讯云</title><meta name="keywords" content="Android,API"/><meta name="description" content=""/><meta name="format-detection" content="telephone=no"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/global-20189101522.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/q-and-a/css/ask-dialog-201810251828.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/v2/build/main-201810241711.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/column/css/column-201810191645.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/markdown-201810241044.css?max_age=31536000"/><link rel="stylesheet" href="//imgcache.qq.com/qcloud/draft-master/dist/draft-master-v1.3.32.css?max_age=31536000"/><style media="screen">@supports (padding:max(0px)){.set-safe-area .com-main{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-simple-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-main-sec{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-m-footer{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-mobile-body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}@supports (padding:max(0px)){.set-safe-area .support-wrap,.set-safe-area div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}.set-safe-area .com-responsive-no-ft div.body{bottom:max(12px,constant(safe-area-inset-bottom));bottom:max(12px,env(safe-area-inset-bottom))}}</style></head><body><div id="react-root"><div class=""><div class="J-header c-nav-wrap c-nav com-2-nav"><div class="c-nav-mod c-nav-mod-pc c-nav-white"><div id="qcTopNavFstLevel" class="J-headerTop c-nav-top" data-nosearch="1" data-nolang="1"><a href="javascript:;" id="qcLeftNavSwitcher" class="c-nav-all-trigger" role="button"><i class="c-nav-all-trigger-icon"></i><span class="c-nav-all-trigger-text" role="button">菜单</span></a><i class="c-nav-top-divider"></i><a href="/" class="c-nav-bg-logo" hotrep="community.header.cloud_portal"><i>腾讯云</i></a><div class="c-nav-top-operation"><div class="c-nav-top-ctrl"><div class="c-nav-top-links"><a href="/product/ba" class="link-item" hotrep="community.header.ba">备案</a><a href="https://console.cloud.tencent.com" class="link-item" role="button" hotrep="community.header.console">控制台</a></div></div></div></div><div class="J-headerBottom c-nav-bottom responsive"><a href="/developer" class="c-nav-project-logo" hotrep="community.header.logo.community"><i class="c-nav-project-bg-logo">云+社区</i></a><div class="c-nav-bm-categories"><ul class="c-nav-list"><li class="presentation curr"><a href="/developer/column" role="button" hotrep="community.header.nav.column">专栏</a></li><li class="presentation"><a href="/developer/ask" role="button" hotrep="community.header.nav.ask">问答</a></li><li class="presentation"><a href="/developer/salon" role="button" hotrep="community.header.nav.salon">沙龙</a></li><li class="presentation"><a href="/developer/news" role="button" hotrep="community.header.nav.news">快讯</a></li><li class="presentation"><a href="/developer/teams" role="button" hotrep="community.header.nav.teams">团队主页</a></li><li class="presentation"><a href="/developer/devdocs" role="button" hotrep="community.header.nav.devdocs">开发者手册</a></li><li class="presentation"><a href="/developer/edu" target="_blank" role="button" hotrep="community.header.nav.edu">云学院</a></li></ul></div><div class="J-headerBottomRight c-nav-bm-right"><a href="javascript:;" class="c-nav-bm-search-btn" role="button" hotrep="community.header.opensearch.search_icon"><i class="nav-search-icon"></i> 搜索</a><div class="c-nav-bm-search" role="button" hotrep="community.header.opensearch.search_bar"><input placeholder="找文章 / 找答案 / 找技术大牛" readonly="" style="cursor:pointer"/><i class="nav-search-icon"></i></div><div class="c-nav-bm-btns"><a href="javascript:;" class="c-nav-bm-btn c-btn" hotrep="community.header.bm_btns.write_article">写文章</a><a href="javascript:;" class="c-btn c-nav-bm-btn-hole" hotrep="community.header.bm_btns.ask">提问</a></div><div class="c-nav-bm-text-btns"><a href="javascript:;" class="c-nav-bm-text-btn" hotrep="community.header.login">登录</a><i class="c-nav-divider-dot"></i><a href="/register" target="_blank" class="c-nav-bm-text-btn" hotrep="community.header.register">注册</a></div></div><div class="com-2-nav-search-wrap"><div class="com-search-bar"><label class="com-search"><input type="text" class="search-input" value="" placeholder="找文章 / 找答案 / 找技术大牛" autoComplete="off"/><button type="submit" class="search-btn" hotrep="community.header.search.search_btn">搜索</button><button class="close-btn" hotrep="community.header.search.close_btn">关闭</button></label></div></div></div></div></div><div class="com-header com-2-header com-2-header-common"><div class="header-main"><a href="javascript:;" class="header-menu-trigger" hotrep="community.header.menu_trigger">展开</a><h1 class="header-main-title"></h1></div><nav class="header-extra"><a href="/developer/search" class="header-extra-icon search-entry" hotrep="community.header.search_btn"></a><a href="javascript:;" hotrep="community.header.login">登录</a></nav></div><div class="com-m-side-mask hidden"></div><section class="com-m-side com-2-m-side hidden"><header class="com-m-side-hd"><div class="header-logo-wrap"><a href="/developer" class="header-logo" hotrep="community.header.drawer.home"><i class="logo-icon logo-community"></i><h1 class="header-title">云+社区</h1></a></div><div class="com-m-side-hd-extra"><a href="javascript:;" class="com-m-side-link only-icon"><div class="icon-back"></div></a></div></header><div class="com-m-side-bd"><ul class="com-m-side-nav"><li class="com-m-side-nav-item"><a href="/developer" class="com-m-side-nav-link"><i class="icon-home"></i>首页</a></li><li class="com-m-side-nav-item"><a href="/developer/column" class="com-m-side-nav-link"><i class="icon-column"></i>专栏</a></li><li class="com-m-side-nav-item"><a href="/developer/ask" class="com-m-side-nav-link"><i class="icon-ask"></i>问答</a></li><li class="com-m-side-nav-item"><a href="/developer/salon" class="com-m-side-nav-link"><i class="icon-salon"></i>沙龙</a></li><li class="com-m-side-nav-item"><a href="/developer/news" class="com-m-side-nav-link"><i class="icon-news"></i>快讯</a></li><li class="com-m-side-nav-item"><a href="/developer/teams" class="com-m-side-nav-link"><i class="icon-nonstop"></i>团队主页</a></li><li class="com-m-side-nav-item"><a href="/developer/devdocs" class="com-m-side-nav-link"><i class="icon-devdoc"></i>开发者手册</a></li><li class="com-m-side-nav-item"><a href="/developer/edu" class="com-m-side-nav-link"><i class="icon-college"></i>云学院</a></li></ul><div class="com-m-side-idx-link-wrap"><a href="/" class="com-m-side-idx-link">返回腾讯云官网</a></div></div></section><div class="J-body col-body pg-article"><h1 class="col-article-title">Android相机开发那些坑</h1><div class="col-article-author"><a href="/developer/user/1068677" class="col-avatar author-avatar" style="background-image:url(https://mc.qcloudimg.com/static/img/4599f3d566f45b87a38807481730a591/image.png)"></a><a href="/developer/user/1068677" class="author-name">QQ空间开发团队</a><span>发表于</span><span class="column-wrap"><a href="/developer/column/1026" class="column-name">QQ空间开发团队的专栏</a></span><div class="extra-part"><span class="com-opt-link dark" title="浏览次数"><i class="com-i-view"></i><span class="text">22.9K</span></span></div></div><section class="col-article"><div class="col-markdown-nav absolute" style="display:none"><h2 class="nav-title">在这篇文章中：</h2><ul class="col-markdown-nav-list"><li><a href="javascript:;" title="一.Android中开发相机应用的两种方式" data-key="2.1">一.Android中开发相机应用的两种方式</a></li><li><a href="javascript:;" title="二.相机API中关键类解析" data-key="2.2">二.相机API中关键类解析</a></li><li><a href="javascript:;" title="三.自定义相机的开发过程" data-key="2.3">三.自定义相机的开发过程</a></li><li><a href="javascript:;" title="四. 开发过程遇到的一些坑" data-key="2.4">四. 开发过程遇到的一些坑</a><ul><li><a href="javascript:;" title="1. Activity设为竖屏时，SurfaceView预览图像颠倒90度。" data-key="3.1">1. Activity设为竖屏时，SurfaceView预览图像颠倒90度。</a></li><li><a href="javascript:;" title="2. SurfaceView预览图像、拍摄照片拉伸变形" data-key="3.2">2. SurfaceView预览图像、拍摄照片拉伸变形</a></li><li><a href="javascript:;" title="5. 锁屏下相机资源的释放问题" data-key="3.3">5. 锁屏下相机资源的释放问题</a></li></ul></li></ul></div><div class="c-markdown J-articleContent"><p>最近我负责开发了一个跟Android相机有关的需求，新功能允许用户使用手机摄像头，快速拍摄特定尺寸（1：1或3：4）的照片，并支持在拍摄出的照片上做贴纸相关的操作。由于之前没有接触过Android相机开发，所以在整个开发过程中踩了不少坑，费了不少时间和精力。这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。</p><h2>一.Android中开发相机应用的两种方式</h2><p> Android系统提供了两种使用手机相机资源实现拍摄功能的方法，一种是直接通过Intent调用系统相机组件，这种方法快速方便，适用于直接获得照片的场景，如上传相册，微博、朋友圈发照片等。另一种是使用相机API来定制自定义相机，这种方法适用于需要定制相机界面或者开发特殊相机功能的场景，如需要对照片做裁剪、滤镜处理，添加贴纸，表情，地点标签等。这篇文章主要是从如何使用相机API来定制自定义相机这个方向展开的。</p><h2>二.相机API中关键类解析</h2><p>通过相机API实现拍摄功能涉及以下几个关键类和接口：</p><p></p><p>Camera：最主要的类，用于管理和操作camera资源。它提供了完整的相机底层接口，支持相机资源切换，设置预览/拍摄尺寸，设定光圈、曝光、聚焦等相关参数，获取预览/拍摄帧数据等功能，主要方法有以下这些：</p><ul class="ul-level-0" style="margin:10px 0 10px 20px"><li>open()：获取camera实例。</li><li>setPreviewDisplay(SurfaceHolder)：绑定绘制预览图像的surface。surface是指向屏幕窗口原始图像缓冲区（raw buffer）的一个句柄，通过它可以获得这块屏幕上对应的canvas，进而完成在屏幕上绘制View的工作。通过surfaceHolder可以将Camera和surface连接起来，当camera和surface连接后，camera获得的预览帧数据就可以通过surface显示在屏幕上了。</li><li>setPrameters设置相机参数，包括前后摄像头，闪光灯模式、聚焦模式、预览和拍照尺寸等。</li><li>startPreview():开始预览，将camera底层硬件传来的预览帧数据显示在绑定的surface上。</li><li>stopPreview():停止预览，关闭camra底层的帧数据传递以及surface上的绘制。</li><li>release():释放Camera实例</li><li>takePicture(Camera.ShutterCallback shutter, Camera.PictureCallback raw, Camera.PictureCallback jpeg):这个是实现相机拍照的主要方法，包含了三个回调参数。shutter是快门按下时的回调，raw是获取拍照原始数据的回调，jpeg是获取经过压缩成jpg格式的图像数据的回调。</li></ul><p></p><p>SurfaceView：用于绘制相机预览图像的类，提供给用户实时的预览图像。普通的view以及派生类都是共享同一个surface的，所有的绘制都必须在UI线程中进行。而surfaceview是一种比较特殊的view，它并不与其他普通view共享surface，而是在内部持有了一个独立的surface,surfaceview负责管理这个surface的格式、尺寸以及显示位置。由于UI线程还要同时处理其他交互逻辑，因此对view的更新速度和帧率无法保证，而surfaceview由于持有一个独立的surface，因而可以在独立的线程中进行绘制，因此可以提供更高的帧率。自定义相机的预览图像由于对更新速度和帧率要求比较高，所以比较适合用surfaceview来显示。</p><p></p><p>SurfaceHolder：surfaceholder是控制surface的一个抽象接口，它能够控制surface的尺寸和格式，修改surface的像素，监视surface的变化等等，surfaceholder的典型应用就是用于surfaceview中。surfaceview通过getHolder()方法获得surfaceholder 实例，通过后者管理监听surface 的状态。</p><p></p><p>SurfaceHolder.Callback接口：负责监听surface状态变化的接口，有三个方法：</p><ul class="ul-level-0" style="margin:10px 0 10px 20px"><li>surfaceCreated(SurfaceHolder holder)：在surface创建后立即被调用。在开发自定义相机时，可以通过重载这个函数调用camera.open()、camera.setPreviewDisplay()，来实现获取相机资源、连接camera和surface等操作。</li><li>surfaceChanged(SurfaceHolder holder, int format, int width, int height):在surface发生format或size变化时调用。在开发自定义相机时，可以通过重载这个函数调用camera.startPreview来开启相机预览，使得camera预览帧数据可以传递给surface，从而实时显示相机预览图像。</li><li>surfaceDestroyed(SurfaceHolder holder)：在surface销毁之前被调用。在开发自定义相机时，可以通过重载这个函数调用camera.stopPreview()，camera.release()来实现停止相机预览及释放相机资源等操作。</li></ul><h2>三.自定义相机的开发过程</h2><p>定制一个自定义相机应用，通常需要完成以下步骤，其流程图如图1所示：</p><ul class="ul-level-0" style="margin:10px 0 10px 20px"><li>检测并访问相机资源 检查手机是否存在相机资源，如果存在，请求访问相机资源。</li><li>创建预览类 创建继承自SurfaceView并实现SurfaceHolder接口的拍摄预览类。此类能够显示相机的实时预览图像。</li><li>建立预览布局 有了拍摄预览类，即可创建一个布局文件，将预览画面与设计好的用户界面控件融合在一起。</li><li>设置拍照监听器 给用户界面控件绑定监听器，使其能响应用户操作（如按下按钮）, 开始拍照过程。</li><li>拍照并保存文件 将拍摄获得的图像转换成位图文件，最终输出保存成各种常用格式的图片。</li><li>释放相机资源 相机是一个共享资源，必须对其生命周期进行细心的管理。当相机使用完毕后，应用程序必须正确地将其释放，以免其它程序访问使用时，发生冲突。</li></ul><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/db9298e2740ed817502181286fbd89fa/image.jpg"></span></div></figure><p>图1 定制自定义相机的过程</p><p>对应到代码编写上可以分成三个步骤：</p><p>第一步：在AndroidManifest.xml中添加Camera相关功能使用的权限，具体声明有以下这些：</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/aacf41d6346ca2771ab4a2c3ae17f7b9/image.jpg"></span></div></figure><p>第二步：编写相机操作功能类CameraOperationHelper。采用单例模式来统一管理相机资源，封装相机API的直接调用，并提供用于跟自定义相机Activity做UI交互的回调接口，其功能函数如下，主要有创建\释放相机，连接\开始\关闭预览界面，拍照，自动对焦，切换前后摄像头，切换闪光灯模式等，具体实现可以参考官方API文档。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/80c8d953d5c3f193a7e31d005067f6c5/image.jpg"></span></div></figure><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/1ae7fbae7e3e934b76c8c82a7785ed3a/image.jpg"></span></div></figure><p>第三步：编写自定义相机Activity，主要是定制相机界面，实现UI交互逻辑，如按钮点击事件处理，icon资源切换，镜头尺寸切换动画等。这里需要声明一个SurfaceView对象来实时显示相机预览画面。通过SurfaceHolder及其Callback接口来一同管理屏幕surface和相机资源的连接，相机预览图像的显示/关闭。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/95515e25e52f0f3fe135336da480cce5/image.jpg"></span></div></figure><h2>四. 开发过程遇到的一些坑</h2><p>下面再讲讲我在开发自定义相机时踩过的一些坑：</p><p></p><h3>1. Activity设为竖屏时，SurfaceView预览图像颠倒90度。</h3><p></p><p>说明这个问题之前，先介绍下Android手机上几个方向的概念：</p><p>屏幕方向：在Android系统中，屏幕的左上角是坐标系统的原点（0,0）坐标。原点向右延伸是X轴正方向，原点向下延伸是Y轴正方向。</p><p>相机传感器方向：手机相机的图像数据都是来自于摄像头硬件的图像传感器，这个传感器在被固定到手机上后有一个默认的取景方向，如下图2所示，坐标原点位于手机横放时的左上角，即与横屏应用的屏幕X方向一致。换句话说，与竖屏应用的屏幕X方向呈90度角。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/f8401055e82edcc139e50fb3ca5685b6/image.jpg"></span></div></figure><p>图2 相机传感器方向示意图 </p><p>相机的预览方向：由于手机屏幕可以360度旋转，为了保证用户无论怎么旋转手机都能看到“正确”的预览画面（这个“正确”是指显示在UI预览界面的画面与人眼看到的眼前的画面是一致的），Android系统底层根据当前手机屏幕的方向对图像传感器采集到的数据进行了旋转处理，然后才送给显示系统，因此可以保证预览画面始终“正确”。在相机API中可以通过setDisplayOrientation()设置相机预览方向。在默认情况下，这个值为0，与图像传感器一致。因此对于横屏应用来说，由于屏幕方向和预览方向一致，预览图像不会颠倒90度。但是对于竖屏应用，屏幕方向和预览方向垂直，所以会出现颠倒90度现象。为了得到正确的预览画面，必须通过API将相机的预览方向旋转90，保持与屏幕方向一致，如图3所示。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/4227cea040746fa0d7164881ab0fda17/image.jpg"></span></div></figure><p>图3 相机预览方向示意图</p><p>（红色箭头为预览方向，蓝色方向为屏幕方向）</p><p>相机的拍照方向：当点击拍照按钮，拍摄的照片是由图像传感器采集到的数据直接存储到SDCard上产生的，因此，相机的拍照方向与传感器方向是一致的。</p><p></p><h3>2. SurfaceView预览图像、拍摄照片拉伸变形</h3><p></p><p>说明这个问题之前，同样先说一下几个跟相机有关的尺寸。</p><p>SurfaceView尺寸：即自定义相机应用中用于显示相机预览图像的View的尺寸，当它铺满全屏时就是屏幕的大小。这里surfaceview显示的预览图像暂且称作手机预览图像。</p><p></p><p>Previewsize：相机硬件提供的预览帧数据尺寸。预览帧数据传递给SurfaceView，实现预览图像的显示。这里预览帧数据对应的预览图像暂且称作相机预览图像。</p><p>Picturesize：相机硬件提供的拍摄帧数据尺寸。拍摄帧数据可以生成位图文件，最终保存成.jpg或者.png等格式的图片。这里拍摄帧数据对应的图像称作相机拍摄图像。图4说明了以上几种图像及照片之间的关系。手机预览图像是直接提供给用户看的图像，它由相机预览图像生成，拍摄照片的数据则来自于相机拍摄图像。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/3e5fa5b3bd0af0cc4fba619a504b082e/image.jpg"></span></div></figure><p>图4 几种图像之间的关系</p><p>下面说下我在开发过程中遇到的三种拉伸变形现象： </p><p>1、手机预览画面中物体被拉伸变形。</p><p>2、拍摄照片中物体被拉伸变形。</p><p>3、点击拍照瞬间，手机预览画面会停顿下，此时的图像是拉伸变形的，然后预览画面恢复后图像又正常了。</p><p></p><p>现象1的原因是SurfaceView和Previewsize的长宽比率不一致。因为手机预览视图的图像是由相机预览图像根据SurfaceView大小缩放得来的，当长宽比不一致时必然会导致图像变形。后两个现象的原因则是Previewsize和Picturesize的长宽比率不一致所致，查了相关的资料，发现其具体原因跟某些手机相机硬件的底层实现有关。总之为了避免以上几种变形现象的发生，在开发时最好将SurfaceView、PreviewSize、PictureSize三个尺寸保证长宽比例一致。具体实现可以先通过camera.getSupportedPreviewSizes()和camera.getSupportedPictureSizes()获得相机硬件支持的所有预览和拍摄尺寸，然后在里面筛选出和SurfaceView的长宽比一致并且大小合适的尺寸，通过camera.setPrameters来更新设置。注意：市场上手机相机硬件支持的尺寸一般都是主流的4:3或者16:9，所以SurfaceView尺寸不能太奇葩，最好也设置成这样的长宽比。</p><h4>3. 各种crash</h4><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/bd87f58a1290f24b0b5ac18cbede5906/image.jpg"></span></div></figure><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/c59dff1f5aec1a723e5169ff3ed76a3d/image.jpg"></span></div></figure><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/060344cf5d49d32f17169877771c9513/image.jpg"></span></div></figure><p>前两个Crash的原因是：相机硬件在聚焦和拍照前必须要保证已经连接到surface，并且开启相机预览，surface有收到预览数据。如果在还没有执行camera. setPreviewDisplay或者未调用camera. startPreview之前,就调用camera.autofocus或camera.takepicture，就会出现这个运行时异常。对应到自定义相机的代码中，要注意在拍照按钮事件响应中执行camera.autofocus或camera.takepicture前，一定要检验camera有没有设置预览Surfaceview并开启了相机预览。这里有个方法可以判断预览状态：Camera.setPreviewCallback是预览帧数据的回调函数，它会在SurfaceView收到相机的预览帧数据时被调用，因此在里面可以设置是否允许对焦和拍照的标志位。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/3d7882fa7ee63e43760bc10f355f78e4/image.jpg"></span></div></figure><p>还有一点要注意，camera.takePicture()在执行过程中会执行camera.stopPreview来获取拍摄帧数据，表现为预览画面卡住，而如果此时用户点击了按钮的话，也就是调用camera.takepicture，也会出现上面的crash，因此在开发时，可能还需要屏蔽拍照按钮的连续点击。</p><p>第三个crash则涉及图像的裁剪，由于要支持1：1或者4：3尺寸镜头，所以会需要对预览视图进行裁剪，由于是竖屏应用，所以裁剪区域的坐标系跟相机传感器方向是成90度角的，表现在裁剪里就是，屏幕上的x方向，对应在拍摄图像上是高度方向，而屏幕上的y方向，对应到拍摄图像上则是宽度方向。因此在计算时要一定注意坐标系的转换以及越界保护。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/ee0fa247d7fcc219a981668cefb469a0/image.jpg"></span></div></figure><h4>4. 前置摄像头的镜像效果</h4><p>Android相机硬件有个特殊设定，就是对于前置摄像头，在展示预览视图时采用类似镜面的效果，显示的是摄像头成像的镜像。而拍摄出的照片则仍采用摄像头成像。看到这里，大家可能会有些怀疑，不妨现在就试试自己Android手机上的前置摄像头，对比下预览图像和拍摄出照片的区别。这是由于底层相机在传递前置摄像头预览数据时做了水平翻转变换，即将x方向镜像翻转180度。这个变化对之前竖屏预览的方向也会造成影响，本来对于后置摄像头旋转90度即可使预览视图正确，而对前置摄像头，如果也旋转90度的话，看到的预览图像则是上下颠倒的（因为x方向翻转了180度），因此必须再旋转180度，才能显示正确，如图5所示，大家可以结合之前相机预览方向的示意图一起理解。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/d620315481198f74c5feadd891bb7091/image.jpg"></span></div></figure><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/391e41c0d84cc2fe45915d4f1706a9c5/image.jpg"></span></div></figure><p>图5 前置摄像头的预览方向示意图 </p><p>此外，由于拍摄图像并没有做水平翻转，所以对于前置摄像头拍出来的照片，用户会发现跟预览时所见的是左右翻转的。这个在一定程度上会影响用户体验。为了解决这个问题，可以对前置摄像头拍摄的图像在生成位图文件时增加一个水平翻转矩阵变换。</p><p></p><h3>5. 锁屏下相机资源的释放问题</h3><p>为了节省手机电量，不浪费相机资源，在开发的自定义相机里，如果预览图像已不需要显示，如按Home键盘切换后台或者锁屏后，此时就应该关闭预览并把相机资源释放掉。参考官方API文档，当surfaceView变成可见时，会创建surface并触发surfaceHolder.callback接口中surfaceCreated回调函数。而surfaceview变成不可见时，则会销毁surface，并触发surfacedestroyed回调函数。我们可以在对应的回调函数里，处理相机的相关操作，如连接surface、开启/关闭预览。 至于相机资源释放，则可以放在Acticity的onpause里执行。相应的，要重新恢复预览图像时，可以把相机资源申请和初始化放在Acticity的onResume里执行，然后通过创建surfaceview，将camera和surface相连并开启预览。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/04012488bd89dd74561821407c0a421b/image.jpg"></span></div></figure><p>但是在开发过程中发现，对于按HOME键切后台场景，程序可以正常运行。对于锁屏场景，则在重新申请相机资源时会发生crash，说相机资源访问失败。那么原因是什么呢？我在代码里增加了调试log， 检查了代码的执行顺序，结果如下： </p><p>在自定义相机页面按HOME键时的执行流程：</p><ul class="ul-level-0" style="margin:10px 0 10px 20px"><li>程序运行-&gt;按HOME键 </li><li>Activity调用的顺序是onPause-&gt;onStop </li><li>SurfaceView调用了surfaceDestroyed方法 </li><li>然后再切回程序 </li><li>Activity调用的顺序是onRestart-&gt;onStart-&gt;onResume </li><li>SurfaceView调用了surfaceCreated-&gt;surfaceChanged方法 </li><li>而对于锁屏，其执行流程则是：</li><li>Activity只调用onPause方法 </li><li>解锁后Activity调用onResume方法 </li><li>SurfaceView中surfaceholder.callback的所有方法都没有执行 </li></ul><p></p><p>问题找到了，由于锁屏时，callback的回调方法没有执行，导致相机和预览的连接还没有断开，相机资源就被释放了，所以导致在重新申请相机资源时，系统报crash。根据上面的文档，推测是锁屏下系统并没有改变surfaceview的可见性，于是我尝试在onPause和onResume时通过手动设置surfaceview的visibile属性，结果发现可以正常触发回调函数了。由于在切后台或者锁屏时，用户本来就应该看不到surfaceview，因此这种手动更改surfaceview的可见性的方法，并不会对用户的体验造成影响。</p><figure><div class="image-block"><span class="lazy-image-holder" dataurl="//mc.qcloudimg.com/static/img/4365d87765356cbabb6e5d794bc24f88/image.jpg"></span></div></figure><blockquote><p>文章来自公众号：QQ空间终端开发团队(qzonemobiledev)</p></blockquote></div><div class="col-article-source"><p>原创声明，本文系作者授权云+社区-专栏发表，未经许可，不得转载。</p><p>如有侵权，请联系 <!-- -->yunjia_community@tencent.com<!-- --> 删除。</p></div><div class="col-article-time"><span>编辑于 <time dateTime="2017-10-31 17:18:34" title="2017-10-31 17:18:34"> 2017-10-31<span class="com-v-box">2017-10-31 17:18:34</span></time></span></div><div class="col-article-tags"><nav class="col-tags"><a href="/developer/tag/10216?entry=article" class="col-tag">Android</a><a href="/developer/tag/10292?entry=article" class="col-tag">API</a></nav><div class="extra-part"><div class="com-operations"><a href="javascript:;" class="com-opt-link link-warn"><i class="com-i-warn"></i>举报</a></div></div></div><div class="com-widget-operations" style="visibility:hidden"><div class="main-cnt"><a href="javascript:;" class="com-opt-link link-like"><i class="com-i-like"></i><span class="text">5</span></a></div><div class="extra-cnt"><span class="com-opt-text share-text">分享</span><ul class="com-share-options"><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon wechat"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img"></div><p class="qr-txt">分享文章到朋友圈</p></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon qq"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到 QQ</span></div></div></div></li><li><div class="c-bubble-trigger"><a href="javascript:;" class="opt-item"><i class="opt-icon weibo"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>分享文章到微博</span></div></div></div></li><li><div class="c-bubble-trigger"><a class="opt-item" href="javascript:;"><i class="opt-icon copy"></i></a><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><span>复制文章链接到剪贴板</span></div></div></div></li></ul><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-left "><div class="c-bubble-inner"><div class="qr-img"><img src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="qr-txt">扫码关注云+社区</p></div></div></div></div></div></section><div class="com-media col-column-media shortcut"><header class="col-column-media-hd"><a href="/developer/column/1026" class="com-avatar" style="background-image:url(https://imgcache.qq.com/qcloud/developer/images/release/column-icons/18.png)"></a><h3 class="com-media-title"><a href="/developer/column/1026">QQ空间开发团队的专栏</a></h3><div class="col-column-media-datas"><span class="col-column-media-data">23<!-- --> 篇文章</span><span class="com-split dot"></span><span class="col-column-media-data">66<!-- --> 人订阅</span></div></header><div class="col-column-media-bd"><ul class="col-2-disorder-list"><li><a href="/developer/article/1004408">TPatch动态补丁系统(iOS)</a></li><li><a href="/developer/article/1004407">ReactNative For Android 项目实战总结</a></li><li><a href="/developer/article/1004405">iOS 高性能图片架构与设计</a></li><li><a href="/developer/article/1004417">安卓 App 热补丁动态修复技术介绍</a></li><li><a href="/developer/article/1004418">Android GC 那点事</a></li></ul></div></div><section class="col-group group-comments"><div class="com-comment-single-edit"><header class="edit-hd"><h3 class="edit-title"><i class="edit-icon"></i>我来说两句</h3><div class="edit-count"><span class="edit-count-num">7</span> 条评论</div></header><div class="edit-body"><div class="edit-textarea"></div><div class="edit-tip"><a href="javascript:;">登录</a> 后参与评论</div></div></div><section class="com-comment-popup v2"><div class="popup-bd"><div><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1259650" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(https://ask.qcloudimg.com/avatar/1259650/wfusbbj7ve.jpg?imageView2/2/w/72)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1259650" class="name">黄桂期</a>：</span>等下次有机会接触到这方面的开发时可以看看 很不错</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-02-08 23:11:47" title="2018-02-08 23:11:47"> 2018-02-08<span class="com-v-box">2018-02-08 23:11:47</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1221673" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1221673" class="name">苏雨丶</a>：</span>谢谢楼主分享，少踩不少坑。</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-04-27 18:33:24" title="2018-04-27 18:33:24"> 2018-04-27<span class="com-v-box">2018-04-27 18:33:24</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1221916" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1221916" class="name">依然丶</a>：</span>学习了</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-05-14 15:26:26" title="2018-05-14 15:26:26"> 2018-05-14<span class="com-v-box">2018-05-14 15:26:26</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1221879" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(//imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/q-and-a/css/img/avatar-default.png)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1221879" class="name">上官兰雨</a>：</span>看过有关新旧api的文章，这也算一个坑吗</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-06-06 15:50:18" title="2018-06-06 15:50:18"> 2018-06-06<span class="com-v-box">2018-06-06 15:50:18</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1512554" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(https://ask.qcloudimg.com/avatar/1512554/mb0c2nvcg4.png?imageView2/2/w/72)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1512554" class="name">东耳kai</a>：</span>这开发是各种应用的滤镜什么的吗</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-06-06 16:02:05" title="2018-06-06 16:02:05"> 2018-06-06<span class="com-v-box">2018-06-06 16:02:05</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/1221833" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(https://ask.qcloudimg.com/avatar/1221833/o8y7gc5scw.png?imageView2/2/w/72)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/1221833" class="name">上官元恒</a>：</span>crush是什么故障</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-06-06 16:02:12" title="2018-06-06 16:02:12"> 2018-06-06<span class="com-v-box">2018-06-06 16:02:12</span></time></span></div></div></div></section><section class="com-comment-panel"><div class="com-media com-comment-panel-author"><a href="/developer/user/2304635" rel="nofollow" class="com-media-object"><span class="com-media-img" style="background-image:url(https://ask.qcloudimg.com/avatar/2304635/d6lg47gt39.png?imageView2/2/w/72)"></span></a></div><div class="com-comment-panel-bd"><div class="com-comment-panel-markdown"><p><span class="com-comment-panel-names"><a href="/developer/user/2304635" class="name">用户2304635</a>：</span>学习了</p></div><div class="com-operations com-comment-panel-operations"><a href="javascript:;" class="com-opt-link link-comment"><i class="com-i-dialog"></i>回复</a><a href="javascript:;" class="com-opt-link link-report link-hidden"><i class="com-i-report"></i>举报</a><div class="extra-part"><span class="com-opt-link">评论于 <time dateTime="2018-08-30 10:16:41" title="2018-08-30 10:16:41"> 2018-08-30<span class="com-v-box">2018-08-30 10:16:41</span></time></span></div></div></div></section></div></div><div class="popup-ft"></div></section></section><ul class="col-slibing-articles"><li><a href="/developer/article/1004415" hotrep="community.column.article-detail.prev">上一篇：高性能服务器架构思路( 五 ) : 分布式缓存</a></li><li><a href="/developer/article/1004417" hotrep="community.column.article-detail.next">下一篇：安卓 App 热补丁动态修复技术介绍</a></li></ul><section class="col-group"><header class="col-group-hd"><h2 class="col-group-title">相关文章</h2></header><div class="col-group-bd"><div class="col-article-list"><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/5133" class="column-name" target="_blank" hotrep="">安富莱嵌入式技术分享</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1327125" target="_blank" hotrep="">【二代示波器教程】第11章 示波器设计—功能模块划分</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1327125" target="_blank" hotrep="">二代示波器的界面上做了五个按钮，分别用于不同功能的配置，本章节就为大家讲解这五个按钮实现的功能。</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">77</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1327125" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-2977066/0qqq9o21ie.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/5133" class="column-name" target="_blank" hotrep="">安富莱嵌入式技术分享</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1327122" target="_blank" hotrep="">【安富莱二代示波器教程】第7章 示波器设计—波形滑动浏览</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1327122" target="_blank" hotrep="">类似手机的滑动功能用在示波器上还是比较实用的，可以用来调节波形位置和滑动浏览波形的存储记录。</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">53</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1327122" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-2977066/5ogqg7mfig.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1088" class="column-name" target="_blank" hotrep="">腾讯移动品质中心TMQ的专栏</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1039997" target="_blank" hotrep="">VR中的动画就是这么玩哒</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1039997" target="_blank" hotrep="">导读 
大家是不是觉得VR中的动画特别神奇，其实它是基于Unity中的动画系统Mecanim实现的，Unity在5.0之后，Mecanim动画控制越来越强大好用...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">213</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">6</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1039997" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-751946/m4pfc5v7ro.png?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/3721" class="column-name" target="_blank" hotrep="">hightopo</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1157759" target="_blank" hotrep="">基于 HTML5 WebGL 的 3D 服务器与客户端的通信</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1157759" target="_blank" hotrep=""></a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">96</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">2</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1740" class="column-name" target="_blank" hotrep="">xingoo, 一个梦想做发明家的程序员</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1023306" target="_blank" hotrep="">【插件开发】—— 13 GEF双击模型事件</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1023306" target="_blank" hotrep="">  
 前文回顾：
 1 插件学习篇
 2 简单的建立插件工程以及模型文件分析
 3 利用扩展点，开发透视图
 4 SWT编程须知
 5 SWT简单控件的使用与...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">190</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">8</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/2531" class="column-name" target="_blank" hotrep="">大数据钻研</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1101924" target="_blank" hotrep="">手把手教你打造一个纯CSS图标库</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1101924" target="_blank" hotrep="">来，干了这碗安利
写这篇文章的目的其实就是为了安利一下我的图标库：iconoo，所以，开门见山，star吧少年少妇们！（这样的我是不是应该要加个github互粉...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">290</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">4</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1101924" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1667431/96zd5tc932.jpeg?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1998" class="column-name" target="_blank" hotrep="">何俊林</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1031857" target="_blank" hotrep="">【独家】一种手机上实现屏幕录制成gif的方案</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1031857" target="_blank" hotrep="">前言：一直以来，很多做apk演示效果时，通过图片的方式，总是没有看起来那样炫丽和灵动。如果能在手机上，直接通过录制屏幕，而变成gif。那可是省去了好多时间。进而...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">186</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">7</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1031857" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1262904/6z4qxkabx7.jpeg?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1677" class="column-name" target="_blank" hotrep="">IMWeb前端团队</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1009608" target="_blank" hotrep="">移动端动画方案</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1009608" target="_blank" hotrep="">前言
花样直播项目客服端的动画基本已都使用web来做，总结分享一下
方案列表
css3动画
canvas 动画
播图片
gif图片
各个方案的优缺点
css3动...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">182</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">9</span></a></div></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/72445" class="column-name" target="_blank" hotrep="">WindCoder</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1344200" target="_blank" hotrep="">一个创建产品动画说明视频的新手指南</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1344200" target="_blank" hotrep="">英文原文：A Step-by-step Guide to Creating Animated Product Explainer Videos</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">54</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">1</span></a></div></div><div class="com-article-panel-object"><a href="/developer/article/1344200" target="_blank" class="com-media-img" hotrep="" style="background-image:url(https://ask.qcloudimg.com/http-save/yehe-1378593/enl544yz3f.jpeg?imageView2/2/w/320)"></a></div></section><section class="com-article-panel"><div class="com-article-panel-body"><div class="com-article-panel-author"><span>来自专栏</span><span class="column-wrap"><a href="/developer/column/1728" class="column-name" target="_blank" hotrep="">我和未来有约会</a></span></div><h3 class="com-article-panel-title"><a href="/developer/article/1047582" target="_blank" hotrep="">一个最基本的布局控件-panel</a></h3><p class="com-article-panel-desc"><a href="/developer/article/1047582" target="_blank" hotrep="">Silverlight做了两个布局的控件了。
 Silverlight控件 - Carrousel
 Silverlight控件 - ScatterView
所...</a></p><div class="com-operations com-article-panel-operations"><span class="com-opt-link"><i class="com-i-view"></i><span class="text">274</span></span><a href="javascript:;" hotrep="" class="com-opt-link"><i class="com-i-like"></i><span class="text">5</span></a></div></div></section></div></div></section></div><div class="J-footer com-2-footer large-width" style="position:fixed;width:100%;bottom:0;visibility:hidden"><div class="com-2-footer-inner"><div class="com-2-footer-main"><div class="com-2-footer-main-ctn"><div class="com-2-footer-main-inner"><div class="com-2-footer-website"><ul class="com-2-footer-website-group"><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">社区</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/column">专栏文章</a></li><li class="com-2-footer-website-item"><a href="/developer/ask">互动问答</a></li><li class="com-2-footer-website-item"><a href="/developer/salon">技术沙龙</a></li><li class="com-2-footer-website-item"><a href="/developer/news">技术快讯</a></li><li class="com-2-footer-website-item"><a href="/developer/teams">团队主页</a></li><li class="com-2-footer-website-item"><a href="/developer/devdocs">开发者手册</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">活动</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/evangelist">布道师</a></li><li class="com-2-footer-website-item"><a href="/developer/translation">翻译社</a></li><li class="com-2-footer-website-item"><a href="/developer/original-sharing">原创分享计划</a></li><li class="com-2-footer-website-item"><a href="/developer/support-plan">自媒体分享计划</a></li><li class="com-2-footer-website-item"><a href="/act/event/community-recruit.html" target="_blank">社区体验用户招募</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">资源</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/edu" target="_blank">云学院</a></li><li class="com-2-footer-website-item"><a href="/developer/specials">技术周刊</a></li><li class="com-2-footer-website-item"><a href="/developer/tags">社区标签</a></li><li class="com-2-footer-website-item"><a href="/developer/labs" target="_blank">开发者实验室</a></li></ul></div></li><li class="com-2-footer-website-column"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">关于</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006434">社区规范</a></li><li class="com-2-footer-website-item"><a href="https://cloud.tencent.com/developer/article/1006435">免责声明</a></li><li class="com-2-footer-website-item"><a href="mailto:yunjia_community@tencent.com">联系我们</a></li></ul></div></li><li class="com-2-footer-website-column com-v-box"><div class="com-2-footer-website-box"><h3 class="com-2-footer-website-title">归档</h3><ul class="com-2-footer-website-list"><li class="com-2-footer-website-item"><a href="/developer/ask/archives.html">问题归档</a></li><li class="com-2-footer-website-item"><a href="/developer/column/archives.html">专栏文章归档</a></li><li class="com-2-footer-website-item"><a href="/developer/news/archives.html">快讯文章归档</a></li><li class="com-2-footer-website-item"><a href="/developer/information/all.html">关键词归档</a></li><li class="com-2-footer-website-item"><a href="/developer/devdocs/archives.html">开发者手册归档</a></li></ul></div></li></ul></div><div class="com-2-footer-copyright"><div class="com-2-footer-logo"><i class="com-2-footer-logo-icon"></i></div><div class="com-2-footer-qr"><div class="com-2-footer-qr-object"><img class="com-2-footer-qr-image" src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="com-2-footer-qr-info"><span class="com-2-footer-qr-text">扫码关注云+社区</span></p></div><p class="com-2-footer-copyright-text"><span>Copyright © 2013-2018</span><span>Tencent Cloud. All Rights Reserved.</span><span>腾讯云 版权所有 <a href="http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action" target="_blank" hotrep="community.footer.link.miitbeian">京ICP备11018762号</a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802020287" hotrep="community.footer.link.beian" target="_blank">京公网安备 11010802020287</a></span></p></div></div></div></div></div></div></div><div class="com-widget-global"><div style="position:relative;z-index:8088"><div class="c-bubble-trigger com-widget-qr"><button class="scan-btn" hotrep="community.edge-widget.follow-oa">扫描二维码</button><div class="c-bubble c-bubble-right "><div class="c-bubble-inner"><div class="qr-img"><img src="//imgcache.qq.com/open_proj/proj_qcloud_v2/community/portal/css/img/wechat-qr.jpg" alt=""/></div><p class="qr-txt">扫码关注云+社区</p></div></div></div></div></div><div id="dialog-root"></div></div><script>window.isServerContext = false; window.isClientContext = true;</script><script>window.$serverTime = 1540721302729; window.$clientTime = Date.now();</script><script>window.$ua = {"ua":"Scrapy/1.5.1 (+https://scrapy.org)","browser":{},"engine":{},"os":{},"device":{},"cpu":{}};</script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/base.ed4340f5fe.js?max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/draft-master/dist/draft-master-v1.3.32.js?max_age=31536000"></script><script src="https://cloud.tencent.com/qccomponent/login/api.js"></script><script src="//imgcache.qq.com/qcloud/main/scripts/release/common/deps/wechatJsSdk.js?version=1_0_1&amp;max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/common.6011af46db.js?max_age=31536000"></script><script src="//imgcache.qq.com/qcloud/developer/scripts/release/column/article-detail.1da575ed0b.js?max_age=31536000"></script><script>
window.$render({"articleDetail":{"id":1004416,"title":"Android相机开发那些坑","content":"entityMap|0|type|IMAGE|mutability|IMMUTABLE|data|imageUrl|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fdb9298e2740ed817502181286fbd89fa\u002Fimage.jpg|imageAlt|[image.jpg]|1|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Faacf41d6346ca2771ab4a2c3ae17f7b9\u002Fimage.jpg|2|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F80c8d953d5c3f193a7e31d005067f6c5\u002Fimage.jpg|3|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F1ae7fbae7e3e934b76c8c82a7785ed3a\u002Fimage.jpg|4|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F95515e25e52f0f3fe135336da480cce5\u002Fimage.jpg|5|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Ff8401055e82edcc139e50fb3ca5685b6\u002Fimage.jpg|6|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4227cea040746fa0d7164881ab0fda17\u002Fimage.jpg|7|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F3e5fa5b3bd0af0cc4fba619a504b082e\u002Fimage.jpg|8|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fbd87f58a1290f24b0b5ac18cbede5906\u002Fimage.jpg|9|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fc59dff1f5aec1a723e5169ff3ed76a3d\u002Fimage.jpg|10|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F060344cf5d49d32f17169877771c9513\u002Fimage.jpg|11|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F3d7882fa7ee63e43760bc10f355f78e4\u002Fimage.jpg|12|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fee0fa247d7fcc219a981668cefb469a0\u002Fimage.jpg|13|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fd620315481198f74c5feadd891bb7091\u002Fimage.jpg|14|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F391e41c0d84cc2fe45915d4f1706a9c5\u002Fimage.jpg|15|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F04012488bd89dd74561821407c0a421b\u002Fimage.jpg|16|\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4365d87765356cbabb6e5d794bc24f88\u002Fimage.jpg|blocks|key|69gtb|text|最近我负责开发了一个跟Android相机有关的需求，新功能允许用户使用手机摄像头，快速拍摄特定尺寸（1：1或3：4）的照片，并支持在拍摄出的照片上做贴纸相关的操作。由于之前没有接触过Android相机开发，所以在整个开发过程中踩了不少坑，费了不少时间和精力。这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。|unstyled|depth|inlineStyleRanges|entityRanges|163f5|一.Android中开发相机应用的两种方式|header-two|fhi7d|+Android系统提供了两种使用手机相机资源实现拍摄功能的方法，一种是直接通过Intent调用系统相机组件，这种方法快速方便，适用于直接获得照片的场景，如上传相册，微博、朋友圈发照片等。另一种是使用相机API来定制自定义相机，这种方法适用于需要定制相机界面或者开发特殊相机功能的场景，如需要对照片做裁剪、滤镜处理，添加贴纸，表情，地点标签等。这篇文章主要是从如何使用相机API来定制自定义相机这个方向展开的。|1al0q|二.相机API中关键类解析|f2a0u|通过相机API实现拍摄功能涉及以下几个关键类和接口：|djp63|fmjjv|Camera：最主要的类，用于管理和操作camera资源。它提供了完整的相机底层接口，支持相机资源切换，设置预览\u002F拍摄尺寸，设定光圈、曝光、聚焦等相关参数，获取预览\u002F拍摄帧数据等功能，主要方法有以下这些：|f1fgk|open()：获取camera实例。|unordered-list-item|4b7a|setPreviewDisplay(SurfaceHolder)：绑定绘制预览图像的surface。surface是指向屏幕窗口原始图像缓冲区（raw+buffer）的一个句柄，通过它可以获得这块屏幕上对应的canvas，进而完成在屏幕上绘制View的工作。通过surfaceHolder可以将Camera和surface连接起来，当camera和surface连接后，camera获得的预览帧数据就可以通过surface显示在屏幕上了。|84c89|setPrameters设置相机参数，包括前后摄像头，闪光灯模式、聚焦模式、预览和拍照尺寸等。|2ft4m|startPreview():开始预览，将camera底层硬件传来的预览帧数据显示在绑定的surface上。|dbtpl|stopPreview():停止预览，关闭camra底层的帧数据传递以及surface上的绘制。|9mdi|release():释放Camera实例|cacbq|takePicture(Camera.ShutterCallback+shutter,+Camera.PictureCallback+raw,+Camera.PictureCallback+jpeg):这个是实现相机拍照的主要方法，包含了三个回调参数。shutter是快门按下时的回调，raw是获取拍照原始数据的回调，jpeg是获取经过压缩成jpg格式的图像数据的回调。|7r6fj|37ooh|SurfaceView：用于绘制相机预览图像的类，提供给用户实时的预览图像。普通的view以及派生类都是共享同一个surface的，所有的绘制都必须在UI线程中进行。而surfaceview是一种比较特殊的view，它并不与其他普通view共享surface，而是在内部持有了一个独立的surface,surfaceview负责管理这个surface的格式、尺寸以及显示位置。由于UI线程还要同时处理其他交互逻辑，因此对view的更新速度和帧率无法保证，而surfaceview由于持有一个独立的surface，因而可以在独立的线程中进行绘制，因此可以提供更高的帧率。自定义相机的预览图像由于对更新速度和帧率要求比较高，所以比较适合用surfaceview来显示。|ab2bt|2k30f|SurfaceHolder：surfaceholder是控制surface的一个抽象接口，它能够控制surface的尺寸和格式，修改surface的像素，监视surface的变化等等，surfaceholder的典型应用就是用于surfaceview中。surfaceview通过getHolder()方法获得surfaceholder+实例，通过后者管理监听surface+的状态。|fgtmf|208q5|SurfaceHolder.Callback接口：负责监听surface状态变化的接口，有三个方法：|24fko|surfaceCreated(SurfaceHolder+holder)：在surface创建后立即被调用。在开发自定义相机时，可以通过重载这个函数调用camera.open()、camera.setPreviewDisplay()，来实现获取相机资源、连接camera和surface等操作。|28cak|surfaceChanged(SurfaceHolder+holder,+int+format,+int+width,+int+height):在surface发生format或size变化时调用。在开发自定义相机时，可以通过重载这个函数调用camera.startPreview来开启相机预览，使得camera预览帧数据可以传递给surface，从而实时显示相机预览图像。|d8c81|surfaceDestroyed(SurfaceHolder+holder)：在surface销毁之前被调用。在开发自定义相机时，可以通过重载这个函数调用camera.stopPreview()，camera.release()来实现停止相机预览及释放相机资源等操作。|emp5f|三.自定义相机的开发过程|e689|定制一个自定义相机应用，通常需要完成以下步骤，其流程图如图1所示：|bhori|检测并访问相机资源+检查手机是否存在相机资源，如果存在，请求访问相机资源。|e2ov4|创建预览类+创建继承自SurfaceView并实现SurfaceHolder接口的拍摄预览类。此类能够显示相机的实时预览图像。|7vljl|建立预览布局+有了拍摄预览类，即可创建一个布局文件，将预览画面与设计好的用户界面控件融合在一起。|m61|设置拍照监听器+给用户界面控件绑定监听器，使其能响应用户操作（如按下按钮）,+开始拍照过程。|dsu6p|拍照并保存文件+将拍摄获得的图像转换成位图文件，最终输出保存成各种常用格式的图片。|833sv|释放相机资源+相机是一个共享资源，必须对其生命周期进行细心的管理。当相机使用完毕后，应用程序必须正确地将其释放，以免其它程序访问使用时，发生冲突。|8i6dm|atomic|offset|length|8k60q|图1+定制自定义相机的过程|1sv2p|对应到代码编写上可以分成三个步骤：|b600r|第一步：在AndroidManifest.xml中添加Camera相关功能使用的权限，具体声明有以下这些：|19bl2|9qud2|第二步：编写相机操作功能类CameraOperationHelper。采用单例模式来统一管理相机资源，封装相机API的直接调用，并提供用于跟自定义相机Activity做UI交互的回调接口，其功能函数如下，主要有创建\\释放相机，连接\\开始\\关闭预览界面，拍照，自动对焦，切换前后摄像头，切换闪光灯模式等，具体实现可以参考官方API文档。|1odg9|3jotb|34tq|第三步：编写自定义相机Activity，主要是定制相机界面，实现UI交互逻辑，如按钮点击事件处理，icon资源切换，镜头尺寸切换动画等。这里需要声明一个SurfaceView对象来实时显示相机预览画面。通过SurfaceHolder及其Callback接口来一同管理屏幕surface和相机资源的连接，相机预览图像的显示\u002F关闭。|cfmfs|cu37l|四.+开发过程遇到的一些坑|eejv4|下面再讲讲我在开发自定义相机时踩过的一些坑：|djak9|fqehg|1.+Activity设为竖屏时，SurfaceView预览图像颠倒90度。|header-three|9f80s|99mbo|说明这个问题之前，先介绍下Android手机上几个方向的概念：|1bhfe|屏幕方向：在Android系统中，屏幕的左上角是坐标系统的原点（0,0）坐标。原点向右延伸是X轴正方向，原点向下延伸是Y轴正方向。|6goi8|相机传感器方向：手机相机的图像数据都是来自于摄像头硬件的图像传感器，这个传感器在被固定到手机上后有一个默认的取景方向，如下图2所示，坐标原点位于手机横放时的左上角，即与横屏应用的屏幕X方向一致。换句话说，与竖屏应用的屏幕X方向呈90度角。|dj2g9|7hfm0|5to20|图2+相机传感器方向示意图+|6bn3l|相机的预览方向：由于手机屏幕可以360度旋转，为了保证用户无论怎么旋转手机都能看到“正确”的预览画面（这个“正确”是指显示在UI预览界面的画面与人眼看到的眼前的画面是一致的），Android系统底层根据当前手机屏幕的方向对图像传感器采集到的数据进行了旋转处理，然后才送给显示系统，因此可以保证预览画面始终“正确”。在相机API中可以通过setDisplayOrientation()设置相机预览方向。在默认情况下，这个值为0，与图像传感器一致。因此对于横屏应用来说，由于屏幕方向和预览方向一致，预览图像不会颠倒90度。但是对于竖屏应用，屏幕方向和预览方向垂直，所以会出现颠倒90度现象。为了得到正确的预览画面，必须通过API将相机的预览方向旋转90，保持与屏幕方向一致，如图3所示。|44s7f|bnaum|uo29|图3+相机预览方向示意图|feprq|（红色箭头为预览方向，蓝色方向为屏幕方向）|1988t|相机的拍照方向：当点击拍照按钮，拍摄的照片是由图像传感器采集到的数据直接存储到SDCard上产生的，因此，相机的拍照方向与传感器方向是一致的。|4sc5a|99gfa|2.+SurfaceView预览图像、拍摄照片拉伸变形|4eo5j|8ag06|说明这个问题之前，同样先说一下几个跟相机有关的尺寸。|a29fj|SurfaceView尺寸：即自定义相机应用中用于显示相机预览图像的View的尺寸，当它铺满全屏时就是屏幕的大小。这里surfaceview显示的预览图像暂且称作手机预览图像。|5d879|c634v|Previewsize：相机硬件提供的预览帧数据尺寸。预览帧数据传递给SurfaceView，实现预览图像的显示。这里预览帧数据对应的预览图像暂且称作相机预览图像。|bpi7s|Picturesize：相机硬件提供的拍摄帧数据尺寸。拍摄帧数据可以生成位图文件，最终保存成.jpg或者.png等格式的图片。这里拍摄帧数据对应的图像称作相机拍摄图像。图4说明了以上几种图像及照片之间的关系。手机预览图像是直接提供给用户看的图像，它由相机预览图像生成，拍摄照片的数据则来自于相机拍摄图像。|6rkiv|8kqds|图4+几种图像之间的关系|ebmbk|下面说下我在开发过程中遇到的三种拉伸变形现象：+|9djr4|1、手机预览画面中物体被拉伸变形。|2jckf|2、拍摄照片中物体被拉伸变形。|e9igm|3、点击拍照瞬间，手机预览画面会停顿下，此时的图像是拉伸变形的，然后预览画面恢复后图像又正常了。|31h38|9auga|现象1的原因是SurfaceView和Previewsize的长宽比率不一致。因为手机预览视图的图像是由相机预览图像根据SurfaceView大小缩放得来的，当长宽比不一致时必然会导致图像变形。后两个现象的原因则是Previewsize和Picturesize的长宽比率不一致所致，查了相关的资料，发现其具体原因跟某些手机相机硬件的底层实现有关。总之为了避免以上几种变形现象的发生，在开发时最好将SurfaceView、PreviewSize、PictureSize三个尺寸保证长宽比例一致。具体实现可以先通过camera.getSupportedPreviewSizes()和camera.getSupportedPictureSizes()获得相机硬件支持的所有预览和拍摄尺寸，然后在里面筛选出和SurfaceView的长宽比一致并且大小合适的尺寸，通过camera.setPrameters来更新设置。注意：市场上手机相机硬件支持的尺寸一般都是主流的4:3或者16:9，所以SurfaceView尺寸不能太奇葩，最好也设置成这样的长宽比。|doe5a|3.+各种crash|header-four|9ankb|5o9ui|tis4|38s9o|ajcfo|前两个Crash的原因是：相机硬件在聚焦和拍照前必须要保证已经连接到surface，并且开启相机预览，surface有收到预览数据。如果在还没有执行camera.+setPreviewDisplay或者未调用camera.+startPreview之前,就调用camera.autofocus或camera.takepicture，就会出现这个运行时异常。对应到自定义相机的代码中，要注意在拍照按钮事件响应中执行camera.autofocus或camera.takepicture前，一定要检验camera有没有设置预览Surfaceview并开启了相机预览。这里有个方法可以判断预览状态：Camera.setPreviewCallback是预览帧数据的回调函数，它会在SurfaceView收到相机的预览帧数据时被调用，因此在里面可以设置是否允许对焦和拍照的标志位。|bcuqe|5tbpp|还有一点要注意，camera.takePicture()在执行过程中会执行camera.stopPreview来获取拍摄帧数据，表现为预览画面卡住，而如果此时用户点击了按钮的话，也就是调用camera.takepicture，也会出现上面的crash，因此在开发时，可能还需要屏蔽拍照按钮的连续点击。|fue3h|第三个crash则涉及图像的裁剪，由于要支持1：1或者4：3尺寸镜头，所以会需要对预览视图进行裁剪，由于是竖屏应用，所以裁剪区域的坐标系跟相机传感器方向是成90度角的，表现在裁剪里就是，屏幕上的x方向，对应在拍摄图像上是高度方向，而屏幕上的y方向，对应到拍摄图像上则是宽度方向。因此在计算时要一定注意坐标系的转换以及越界保护。|194cb|5vn81|4.+前置摄像头的镜像效果|c8d3e|Android相机硬件有个特殊设定，就是对于前置摄像头，在展示预览视图时采用类似镜面的效果，显示的是摄像头成像的镜像。而拍摄出的照片则仍采用摄像头成像。看到这里，大家可能会有些怀疑，不妨现在就试试自己Android手机上的前置摄像头，对比下预览图像和拍摄出照片的区别。这是由于底层相机在传递前置摄像头预览数据时做了水平翻转变换，即将x方向镜像翻转180度。这个变化对之前竖屏预览的方向也会造成影响，本来对于后置摄像头旋转90度即可使预览视图正确，而对前置摄像头，如果也旋转90度的话，看到的预览图像则是上下颠倒的（因为x方向翻转了180度），因此必须再旋转180度，才能显示正确，如图5所示，大家可以结合之前相机预览方向的示意图一起理解。|9ckq0|6gqj8|1r1oq|图5+前置摄像头的预览方向示意图+|2jonc|此外，由于拍摄图像并没有做水平翻转，所以对于前置摄像头拍出来的照片，用户会发现跟预览时所见的是左右翻转的。这个在一定程度上会影响用户体验。为了解决这个问题，可以对前置摄像头拍摄的图像在生成位图文件时增加一个水平翻转矩阵变换。|e8j9u|2og8f|5.+锁屏下相机资源的释放问题|d8f0m|为了节省手机电量，不浪费相机资源，在开发的自定义相机里，如果预览图像已不需要显示，如按Home键盘切换后台或者锁屏后，此时就应该关闭预览并把相机资源释放掉。参考官方API文档，当surfaceView变成可见时，会创建surface并触发surfaceHolder.callback接口中surfaceCreated回调函数。而surfaceview变成不可见时，则会销毁surface，并触发surfacedestroyed回调函数。我们可以在对应的回调函数里，处理相机的相关操作，如连接surface、开启\u002F关闭预览。+至于相机资源释放，则可以放在Acticity的onpause里执行。相应的，要重新恢复预览图像时，可以把相机资源申请和初始化放在Acticity的onResume里执行，然后通过创建surfaceview，将camera和surface相连并开启预览。|2seb4|ekunk|但是在开发过程中发现，对于按HOME键切后台场景，程序可以正常运行。对于锁屏场景，则在重新申请相机资源时会发生crash，说相机资源访问失败。那么原因是什么呢？我在代码里增加了调试log，+检查了代码的执行顺序，结果如下：+|29oga|在自定义相机页面按HOME键时的执行流程：|1t6n3|程序运行-\u003E按HOME键+|9856h|Activity调用的顺序是onPause-\u003EonStop+|1e5jl|SurfaceView调用了surfaceDestroyed方法+|3qapf|然后再切回程序+|4emoa|Activity调用的顺序是onRestart-\u003EonStart-\u003EonResume+|7fvp8|SurfaceView调用了surfaceCreated-\u003EsurfaceChanged方法+|fo3m0|而对于锁屏，其执行流程则是：|6vml6|Activity只调用onPause方法+|a7tev|解锁后Activity调用onResume方法+|c5elq|SurfaceView中surfaceholder.callback的所有方法都没有执行+|2k9kn|5redr|问题找到了，由于锁屏时，callback的回调方法没有执行，导致相机和预览的连接还没有断开，相机资源就被释放了，所以导致在重新申请相机资源时，系统报crash。根据上面的文档，推测是锁屏下系统并没有改变surfaceview的可见性，于是我尝试在onPause和onResume时通过手动设置surfaceview的visibile属性，结果发现可以正常触发回调函数了。由于在切后台或者锁屏时，用户本来就应该看不到surfaceview，因此这种手动更改surfaceview的可见性的方法，并不会对用户的体验造成影响。|b8hit|agp7i|9ej7o|文章来自公众号：QQ空间终端开发团队(qzonemobiledev)|blockquote^0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|B|0|0|0|0|0|0|B|1|0|0|0|B|2|0|0|B|3|0|0|0|B|4|0|0|0|0|0|0|0|0|0|0|B|5|0|0|0|0|0|B|6|0|0|0|0|0|0|0|0|0|0|0|0|0|0|B|7|0|0|0|0|0|0|0|0|0|0|B|8|0|0|B|9|0|0|B|A|0|0|0|0|B|B|0|0|0|0|B|C|0|0|0|0|B|D|0|0|B|E|0|0|0|0|0|0|0|B|F|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|B|G|0|0^^$0|$1|$2|3|4|5|6|$7|8|9|A]]|B|$2|3|4|5|6|$7|C|9|A]]|D|$2|3|4|5|6|$7|E|9|A]]|F|$2|3|4|5|6|$7|G|9|A]]|H|$2|3|4|5|6|$7|I|9|A]]|J|$2|3|4|5|6|$7|K|9|A]]|L|$2|3|4|5|6|$7|M|9|A]]|N|$2|3|4|5|6|$7|O|9|A]]|P|$2|3|4|5|6|$7|Q|9|A]]|R|$2|3|4|5|6|$7|S|9|A]]|T|$2|3|4|5|6|$7|U|9|A]]|V|$2|3|4|5|6|$7|W|9|A]]|X|$2|3|4|5|6|$7|Y|9|A]]|Z|$2|3|4|5|6|$7|10|9|A]]|11|$2|3|4|5|6|$7|12|9|A]]|13|$2|3|4|5|6|$7|14|9|A]]|15|$2|3|4|5|6|$7|16|9|A]]]|17|@$18|19|1A|1B|2|1C|1D|6V|1E|@]|1F|@]|6|$]]|$18|1G|1A|1H|2|1I|1D|6W|1E|@]|1F|@]|6|$]]|$18|1J|1A|1K|2|1C|1D|6X|1E|@]|1F|@]|6|$]]|$18|1L|1A|1M|2|1I|1D|6Y|1E|@]|1F|@]|6|$]]|$18|1N|1A|1O|2|1C|1D|6Z|1E|@]|1F|@]|6|$]]|$18|1P|1A|-4|2|1C|1D|70|1E|@]|1F|@]|6|$]]|$18|1Q|1A|1R|2|1C|1D|71|1E|@]|1F|@]|6|$]]|$18|1S|1A|1T|2|1U|1D|72|1E|@]|1F|@]|6|$]]|$18|1V|1A|1W|2|1U|1D|73|1E|@]|1F|@]|6|$]]|$18|1X|1A|1Y|2|1U|1D|74|1E|@]|1F|@]|6|$]]|$18|1Z|1A|20|2|1U|1D|75|1E|@]|1F|@]|6|$]]|$18|21|1A|22|2|1U|1D|76|1E|@]|1F|@]|6|$]]|$18|23|1A|24|2|1U|1D|77|1E|@]|1F|@]|6|$]]|$18|25|1A|26|2|1U|1D|78|1E|@]|1F|@]|6|$]]|$18|27|1A|-4|2|1C|1D|79|1E|@]|1F|@]|6|$]]|$18|28|1A|29|2|1C|1D|7A|1E|@]|1F|@]|6|$]]|$18|2A|1A|-4|2|1C|1D|7B|1E|@]|1F|@]|6|$]]|$18|2B|1A|2C|2|1C|1D|7C|1E|@]|1F|@]|6|$]]|$18|2D|1A|-4|2|1C|1D|7D|1E|@]|1F|@]|6|$]]|$18|2E|1A|2F|2|1C|1D|7E|1E|@]|1F|@]|6|$]]|$18|2G|1A|2H|2|1U|1D|7F|1E|@]|1F|@]|6|$]]|$18|2I|1A|2J|2|1U|1D|7G|1E|@]|1F|@]|6|$]]|$18|2K|1A|2L|2|1U|1D|7H|1E|@]|1F|@]|6|$]]|$18|2M|1A|2N|2|1I|1D|7I|1E|@]|1F|@]|6|$]]|$18|2O|1A|2P|2|1C|1D|7J|1E|@]|1F|@]|6|$]]|$18|2Q|1A|2R|2|1U|1D|7K|1E|@]|1F|@]|6|$]]|$18|2S|1A|2T|2|1U|1D|7L|1E|@]|1F|@]|6|$]]|$18|2U|1A|2V|2|1U|1D|7M|1E|@]|1F|@]|6|$]]|$18|2W|1A|2X|2|1U|1D|7N|1E|@]|1F|@]|6|$]]|$18|2Y|1A|2Z|2|1U|1D|7O|1E|@]|1F|@]|6|$]]|$18|30|1A|31|2|1U|1D|7P|1E|@]|1F|@]|6|$]]|$18|32|1A|A|2|33|1D|7Q|1E|@]|1F|@$34|7R|35|7S|18|7T]]|6|$]]|$18|36|1A|37|2|1C|1D|7U|1E|@]|1F|@]|6|$]]|$18|38|1A|39|2|1C|1D|7V|1E|@]|1F|@]|6|$]]|$18|3A|1A|3B|2|1C|1D|7W|1E|@]|1F|@]|6|$]]|$18|3C|1A|A|2|33|1D|7X|1E|@]|1F|@$34|7Y|35|7Z|18|80]]|6|$]]|$18|3D|1A|3E|2|1C|1D|81|1E|@]|1F|@]|6|$]]|$18|3F|1A|A|2|33|1D|82|1E|@]|1F|@$34|83|35|84|18|85]]|6|$]]|$18|3G|1A|A|2|33|1D|86|1E|@]|1F|@$34|87|35|88|18|89]]|6|$]]|$18|3H|1A|3I|2|1C|1D|8A|1E|@]|1F|@]|6|$]]|$18|3J|1A|A|2|33|1D|8B|1E|@]|1F|@$34|8C|35|8D|18|8E]]|6|$]]|$18|3K|1A|3L|2|1I|1D|8F|1E|@]|1F|@]|6|$]]|$18|3M|1A|3N|2|1C|1D|8G|1E|@]|1F|@]|6|$]]|$18|3O|1A|-4|2|1C|1D|8H|1E|@]|1F|@]|6|$]]|$18|3P|1A|3Q|2|3R|1D|8I|1E|@]|1F|@]|6|$]]|$18|3S|1A|-4|2|1C|1D|8J|1E|@]|1F|@]|6|$]]|$18|3T|1A|3U|2|1C|1D|8K|1E|@]|1F|@]|6|$]]|$18|3V|1A|3W|2|1C|1D|8L|1E|@]|1F|@]|6|$]]|$18|3X|1A|3Y|2|1C|1D|8M|1E|@]|1F|@]|6|$]]|$18|3Z|1A|A|2|33|1D|8N|1E|@]|1F|@$34|8O|35|8P|18|8Q]]|6|$]]|$18|40|1A|-4|2|1C|1D|8R|1E|@]|1F|@]|6|$]]|$18|41|1A|42|2|1C|1D|8S|1E|@]|1F|@]|6|$]]|$18|43|1A|44|2|1C|1D|8T|1E|@]|1F|@]|6|$]]|$18|45|1A|A|2|33|1D|8U|1E|@]|1F|@$34|8V|35|8W|18|8X]]|6|$]]|$18|46|1A|-4|2|1C|1D|8Y|1E|@]|1F|@]|6|$]]|$18|47|1A|48|2|1C|1D|8Z|1E|@]|1F|@]|6|$]]|$18|49|1A|4A|2|1C|1D|90|1E|@]|1F|@]|6|$]]|$18|4B|1A|4C|2|1C|1D|91|1E|@]|1F|@]|6|$]]|$18|4D|1A|-4|2|1C|1D|92|1E|@]|1F|@]|6|$]]|$18|4E|1A|4F|2|3R|1D|93|1E|@]|1F|@]|6|$]]|$18|4G|1A|-4|2|1C|1D|94|1E|@]|1F|@]|6|$]]|$18|4H|1A|4I|2|1C|1D|95|1E|@]|1F|@]|6|$]]|$18|4J|1A|4K|2|1C|1D|96|1E|@]|1F|@]|6|$]]|$18|4L|1A|-4|2|1C|1D|97|1E|@]|1F|@]|6|$]]|$18|4M|1A|4N|2|1C|1D|98|1E|@]|1F|@]|6|$]]|$18|4O|1A|4P|2|1C|1D|99|1E|@]|1F|@]|6|$]]|$18|4Q|1A|A|2|33|1D|9A|1E|@]|1F|@$34|9B|35|9C|18|9D]]|6|$]]|$18|4R|1A|4S|2|1C|1D|9E|1E|@]|1F|@]|6|$]]|$18|4T|1A|4U|2|1C|1D|9F|1E|@]|1F|@]|6|$]]|$18|4V|1A|4W|2|1C|1D|9G|1E|@]|1F|@]|6|$]]|$18|4X|1A|4Y|2|1C|1D|9H|1E|@]|1F|@]|6|$]]|$18|4Z|1A|50|2|1C|1D|9I|1E|@]|1F|@]|6|$]]|$18|51|1A|-4|2|1C|1D|9J|1E|@]|1F|@]|6|$]]|$18|52|1A|53|2|1C|1D|9K|1E|@]|1F|@]|6|$]]|$18|54|1A|55|2|56|1D|9L|1E|@]|1F|@]|6|$]]|$18|57|1A|A|2|33|1D|9M|1E|@]|1F|@$34|9N|35|9O|18|9P]]|6|$]]|$18|58|1A|A|2|33|1D|9Q|1E|@]|1F|@$34|9R|35|9S|18|9T]]|6|$]]|$18|59|1A|A|2|33|1D|9U|1E|@]|1F|@$34|9V|35|9W|18|9X]]|6|$]]|$18|5A|1A|-4|2|1C|1D|9Y|1E|@]|1F|@]|6|$]]|$18|5B|1A|5C|2|1C|1D|9Z|1E|@]|1F|@]|6|$]]|$18|5D|1A|A|2|33|1D|A0|1E|@]|1F|@$34|A1|35|A2|18|A3]]|6|$]]|$18|5E|1A|5F|2|1C|1D|A4|1E|@]|1F|@]|6|$]]|$18|5G|1A|5H|2|1C|1D|A5|1E|@]|1F|@]|6|$]]|$18|5I|1A|A|2|33|1D|A6|1E|@]|1F|@$34|A7|35|A8|18|A9]]|6|$]]|$18|5J|1A|5K|2|56|1D|AA|1E|@]|1F|@]|6|$]]|$18|5L|1A|5M|2|1C|1D|AB|1E|@]|1F|@]|6|$]]|$18|5N|1A|A|2|33|1D|AC|1E|@]|1F|@$34|AD|35|AE|18|AF]]|6|$]]|$18|5O|1A|A|2|33|1D|AG|1E|@]|1F|@$34|AH|35|AI|18|AJ]]|6|$]]|$18|5P|1A|5Q|2|1C|1D|AK|1E|@]|1F|@]|6|$]]|$18|5R|1A|5S|2|1C|1D|AL|1E|@]|1F|@]|6|$]]|$18|5T|1A|-4|2|1C|1D|AM|1E|@]|1F|@]|6|$]]|$18|5U|1A|5V|2|3R|1D|AN|1E|@]|1F|@]|6|$]]|$18|5W|1A|5X|2|1C|1D|AO|1E|@]|1F|@]|6|$]]|$18|5Y|1A|A|2|33|1D|AP|1E|@]|1F|@$34|AQ|35|AR|18|AS]]|6|$]]|$18|5Z|1A|60|2|1C|1D|AT|1E|@]|1F|@]|6|$]]|$18|61|1A|62|2|1C|1D|AU|1E|@]|1F|@]|6|$]]|$18|63|1A|64|2|1U|1D|AV|1E|@]|1F|@]|6|$]]|$18|65|1A|66|2|1U|1D|AW|1E|@]|1F|@]|6|$]]|$18|67|1A|68|2|1U|1D|AX|1E|@]|1F|@]|6|$]]|$18|69|1A|6A|2|1U|1D|AY|1E|@]|1F|@]|6|$]]|$18|6B|1A|6C|2|1U|1D|AZ|1E|@]|1F|@]|6|$]]|$18|6D|1A|6E|2|1U|1D|B0|1E|@]|1F|@]|6|$]]|$18|6F|1A|6G|2|1U|1D|B1|1E|@]|1F|@]|6|$]]|$18|6H|1A|6I|2|1U|1D|B2|1E|@]|1F|@]|6|$]]|$18|6J|1A|6K|2|1U|1D|B3|1E|@]|1F|@]|6|$]]|$18|6L|1A|6M|2|1U|1D|B4|1E|@]|1F|@]|6|$]]|$18|6N|1A|-4|2|1C|1D|B5|1E|@]|1F|@]|6|$]]|$18|6O|1A|6P|2|1C|1D|B6|1E|@]|1F|@]|6|$]]|$18|6Q|1A|A|2|33|1D|B7|1E|@]|1F|@$34|B8|35|B9|18|BA]]|6|$]]|$18|6R|1A|-4|2|1C|1D|BB|1E|@]|1F|@]|6|$]]|$18|6S|1A|6T|2|6U|1D|BC|1E|@]|1F|@]|6|$]]]]","plain":"最近我负责开发了一个跟Android相机有关的需求，新功能允许用户使用手机摄像头，快速拍摄特定尺寸（1：1或3：4）的照片，并支持在拍摄出的照片上做贴纸相关的操作。由于之前没有接触过Android相机开发，所以在整个开发过程中踩了不少坑，费了不少时间和精力。这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。\n一.Android中开发相机应用的两种方式\n Android系统提供了两种使用手机相机资源实现拍摄功能的方法，一种是直接通过Intent调用系统相机组件，这种方法快速方便，适用于直接获得照片的场景，如上传相册，微博、朋友圈发照片等。另一种是使用相机API来定制自定义相机，这种方法适用于需要定制相机界面或者开发特殊相机功能的场景，如需要对照片做裁剪、滤镜处理，添加贴纸，表情，地点标签等。这篇文章主要是从如何使用相机API来定制自定义相机这个方向展开的。\n二.相机API中关键类解析\n通过相机API实现拍摄功能涉及以下几个关键类和接口：\n\nCamera：最主要的类，用于管理和操作camera资源。它提供了完整的相机底层接口，支持相机资源切换，设置预览\u002F拍摄尺寸，设定光圈、曝光、聚焦等相关参数，获取预览\u002F拍摄帧数据等功能，主要方法有以下这些：\nopen()：获取camera实例。\nsetPreviewDisplay(SurfaceHolder)：绑定绘制预览图像的surface。surface是指向屏幕窗口原始图像缓冲区（raw buffer）的一个句柄，通过它可以获得这块屏幕上对应的canvas，进而完成在屏幕上绘制View的工作。通过surfaceHolder可以将Camera和surface连接起来，当camera和surface连接后，camera获得的预览帧数据就可以通过surface显示在屏幕上了。\nsetPrameters设置相机参数，包括前后摄像头，闪光灯模式、聚焦模式、预览和拍照尺寸等。\nstartPreview():开始预览，将camera底层硬件传来的预览帧数据显示在绑定的surface上。\nstopPreview():停止预览，关闭camra底层的帧数据传递以及surface上的绘制。\nrelease():释放Camera实例\ntakePicture(Camera.ShutterCallback shutter, Camera.PictureCallback raw, Camera.PictureCallback jpeg):这个是实现相机拍照的主要方法，包含了三个回调参数。shutter是快门按下时的回调，raw是获取拍照原始数据的回调，jpeg是获取经过压缩成jpg格式的图像数据的回调。\n\nSurfaceView：用于绘制相机预览图像的类，提供给用户实时的预览图像。普通的view以及派生类都是共享同一个surface的，所有的绘制都必须在UI线程中进行。而surfaceview是一种比较特殊的view，它并不与其他普通view共享surface，而是在内部持有了一个独立的surface,surfaceview负责管理这个surface的格式、尺寸以及显示位置。由于UI线程还要同时处理其他交互逻辑，因此对view的更新速度和帧率无法保证，而surfaceview由于持有一个独立的surface，因而可以在独立的线程中进行绘制，因此可以提供更高的帧率。自定义相机的预览图像由于对更新速度和帧率要求比较高，所以比较适合用surfaceview来显示。\n\nSurfaceHolder：surfaceholder是控制surface的一个抽象接口，它能够控制surface的尺寸和格式，修改surface的像素，监视surface的变化等等，surfaceholder的典型应用就是用于surfaceview中。surfaceview通过getHolder()方法获得surfaceholder 实例，通过后者管理监听surface 的状态。\n\nSurfaceHolder.Callback接口：负责监听surface状态变化的接口，有三个方法：\nsurfaceCreated(SurfaceHolder holder)：在surface创建后立即被调用。在开发自定义相机时，可以通过重载这个函数调用camera.open()、camera.setPreviewDisplay()，来实现获取相机资源、连接camera和surface等操作。\nsurfaceChanged(SurfaceHolder holder, int format, int width, int height):在surface发生format或size变化时调用。在开发自定义相机时，可以通过重载这个函数调用camera.startPreview来开启相机预览，使得camera预览帧数据可以传递给surface，从而实时显示相机预览图像。\nsurfaceDestroyed(SurfaceHolder holder)：在surface销毁之前被调用。在开发自定义相机时，可以通过重载这个函数调用camera.stopPreview()，camera.release()来实现停止相机预览及释放相机资源等操作。\n三.自定义相机的开发过程\n定制一个自定义相机应用，通常需要完成以下步骤，其流程图如图1所示：\n检测并访问相机资源 检查手机是否存在相机资源，如果存在，请求访问相机资源。\n创建预览类 创建继承自SurfaceView并实现SurfaceHolder接口的拍摄预览类。此类能够显示相机的实时预览图像。\n建立预览布局 有了拍摄预览类，即可创建一个布局文件，将预览画面与设计好的用户界面控件融合在一起。\n设置拍照监听器 给用户界面控件绑定监听器，使其能响应用户操作（如按下按钮）, 开始拍照过程。\n拍照并保存文件 将拍摄获得的图像转换成位图文件，最终输出保存成各种常用格式的图片。\n释放相机资源 相机是一个共享资源，必须对其生命周期进行细心的管理。当相机使用完毕后，应用程序必须正确地将其释放，以免其它程序访问使用时，发生冲突。\n[image.jpg]\n图1 定制自定义相机的过程\n对应到代码编写上可以分成三个步骤：\n第一步：在AndroidManifest.xml中添加Camera相关功能使用的权限，具体声明有以下这些：\n[image.jpg]\n第二步：编写相机操作功能类CameraOperationHelper。采用单例模式来统一管理相机资源，封装相机API的直接调用，并提供用于跟自定义相机Activity做UI交互的回调接口，其功能函数如下，主要有创建\\释放相机，连接\\开始\\关闭预览界面，拍照，自动对焦，切换前后摄像头，切换闪光灯模式等，具体实现可以参考官方API文档。\n[image.jpg]\n[image.jpg]\n第三步：编写自定义相机Activity，主要是定制相机界面，实现UI交互逻辑，如按钮点击事件处理，icon资源切换，镜头尺寸切换动画等。这里需要声明一个SurfaceView对象来实时显示相机预览画面。通过SurfaceHolder及其Callback接口来一同管理屏幕surface和相机资源的连接，相机预览图像的显示\u002F关闭。\n[image.jpg]\n四. 开发过程遇到的一些坑\n下面再讲讲我在开发自定义相机时踩过的一些坑：\n\n1. Activity设为竖屏时，SurfaceView预览图像颠倒90度。\n\n说明这个问题之前，先介绍下Android手机上几个方向的概念：\n屏幕方向：在Android系统中，屏幕的左上角是坐标系统的原点（0,0）坐标。原点向右延伸是X轴正方向，原点向下延伸是Y轴正方向。\n相机传感器方向：手机相机的图像数据都是来自于摄像头硬件的图像传感器，这个传感器在被固定到手机上后有一个默认的取景方向，如下图2所示，坐标原点位于手机横放时的左上角，即与横屏应用的屏幕X方向一致。换句话说，与竖屏应用的屏幕X方向呈90度角。\n[image.jpg]\n\n图2 相机传感器方向示意图 \n相机的预览方向：由于手机屏幕可以360度旋转，为了保证用户无论怎么旋转手机都能看到“正确”的预览画面（这个“正确”是指显示在UI预览界面的画面与人眼看到的眼前的画面是一致的），Android系统底层根据当前手机屏幕的方向对图像传感器采集到的数据进行了旋转处理，然后才送给显示系统，因此可以保证预览画面始终“正确”。在相机API中可以通过setDisplayOrientation()设置相机预览方向。在默认情况下，这个值为0，与图像传感器一致。因此对于横屏应用来说，由于屏幕方向和预览方向一致，预览图像不会颠倒90度。但是对于竖屏应用，屏幕方向和预览方向垂直，所以会出现颠倒90度现象。为了得到正确的预览画面，必须通过API将相机的预览方向旋转90，保持与屏幕方向一致，如图3所示。\n[image.jpg]\n\n图3 相机预览方向示意图\n（红色箭头为预览方向，蓝色方向为屏幕方向）\n相机的拍照方向：当点击拍照按钮，拍摄的照片是由图像传感器采集到的数据直接存储到SDCard上产生的，因此，相机的拍照方向与传感器方向是一致的。\n\n2. SurfaceView预览图像、拍摄照片拉伸变形\n\n说明这个问题之前，同样先说一下几个跟相机有关的尺寸。\nSurfaceView尺寸：即自定义相机应用中用于显示相机预览图像的View的尺寸，当它铺满全屏时就是屏幕的大小。这里surfaceview显示的预览图像暂且称作手机预览图像。\n\nPreviewsize：相机硬件提供的预览帧数据尺寸。预览帧数据传递给SurfaceView，实现预览图像的显示。这里预览帧数据对应的预览图像暂且称作相机预览图像。\nPicturesize：相机硬件提供的拍摄帧数据尺寸。拍摄帧数据可以生成位图文件，最终保存成.jpg或者.png等格式的图片。这里拍摄帧数据对应的图像称作相机拍摄图像。图4说明了以上几种图像及照片之间的关系。手机预览图像是直接提供给用户看的图像，它由相机预览图像生成，拍摄照片的数据则来自于相机拍摄图像。\n[image.jpg]\n图4 几种图像之间的关系\n下面说下我在开发过程中遇到的三种拉伸变形现象： \n1、手机预览画面中物体被拉伸变形。\n2、拍摄照片中物体被拉伸变形。\n3、点击拍照瞬间，手机预览画面会停顿下，此时的图像是拉伸变形的，然后预览画面恢复后图像又正常了。\n\n现象1的原因是SurfaceView和Previewsize的长宽比率不一致。因为手机预览视图的图像是由相机预览图像根据SurfaceView大小缩放得来的，当长宽比不一致时必然会导致图像变形。后两个现象的原因则是Previewsize和Picturesize的长宽比率不一致所致，查了相关的资料，发现其具体原因跟某些手机相机硬件的底层实现有关。总之为了避免以上几种变形现象的发生，在开发时最好将SurfaceView、PreviewSize、PictureSize三个尺寸保证长宽比例一致。具体实现可以先通过camera.getSupportedPreviewSizes()和camera.getSupportedPictureSizes()获得相机硬件支持的所有预览和拍摄尺寸，然后在里面筛选出和SurfaceView的长宽比一致并且大小合适的尺寸，通过camera.setPrameters来更新设置。注意：市场上手机相机硬件支持的尺寸一般都是主流的4:3或者16:9，所以SurfaceView尺寸不能太奇葩，最好也设置成这样的长宽比。\n3. 各种crash\n[image.jpg]\n[image.jpg]\n[image.jpg]\n\n前两个Crash的原因是：相机硬件在聚焦和拍照前必须要保证已经连接到surface，并且开启相机预览，surface有收到预览数据。如果在还没有执行camera. setPreviewDisplay或者未调用camera. startPreview之前,就调用camera.autofocus或camera.takepicture，就会出现这个运行时异常。对应到自定义相机的代码中，要注意在拍照按钮事件响应中执行camera.autofocus或camera.takepicture前，一定要检验camera有没有设置预览Surfaceview并开启了相机预览。这里有个方法可以判断预览状态：Camera.setPreviewCallback是预览帧数据的回调函数，它会在SurfaceView收到相机的预览帧数据时被调用，因此在里面可以设置是否允许对焦和拍照的标志位。\n[image.jpg]\n还有一点要注意，camera.takePicture()在执行过程中会执行camera.stopPreview来获取拍摄帧数据，表现为预览画面卡住，而如果此时用户点击了按钮的话，也就是调用camera.takepicture，也会出现上面的crash，因此在开发时，可能还需要屏蔽拍照按钮的连续点击。\n第三个crash则涉及图像的裁剪，由于要支持1：1或者4：3尺寸镜头，所以会需要对预览视图进行裁剪，由于是竖屏应用，所以裁剪区域的坐标系跟相机传感器方向是成90度角的，表现在裁剪里就是，屏幕上的x方向，对应在拍摄图像上是高度方向，而屏幕上的y方向，对应到拍摄图像上则是宽度方向。因此在计算时要一定注意坐标系的转换以及越界保护。\n[image.jpg]\n4. 前置摄像头的镜像效果\nAndroid相机硬件有个特殊设定，就是对于前置摄像头，在展示预览视图时采用类似镜面的效果，显示的是摄像头成像的镜像。而拍摄出的照片则仍采用摄像头成像。看到这里，大家可能会有些怀疑，不妨现在就试试自己Android手机上的前置摄像头，对比下预览图像和拍摄出照片的区别。这是由于底层相机在传递前置摄像头预览数据时做了水平翻转变换，即将x方向镜像翻转180度。这个变化对之前竖屏预览的方向也会造成影响，本来对于后置摄像头旋转90度即可使预览视图正确，而对前置摄像头，如果也旋转90度的话，看到的预览图像则是上下颠倒的（因为x方向翻转了180度），因此必须再旋转180度，才能显示正确，如图5所示，大家可以结合之前相机预览方向的示意图一起理解。\n[image.jpg]\n[image.jpg]\n图5 前置摄像头的预览方向示意图 \n此外，由于拍摄图像并没有做水平翻转，所以对于前置摄像头拍出来的照片，用户会发现跟预览时所见的是左右翻转的。这个在一定程度上会影响用户体验。为了解决这个问题，可以对前置摄像头拍摄的图像在生成位图文件时增加一个水平翻转矩阵变换。\n\n5. 锁屏下相机资源的释放问题\n为了节省手机电量，不浪费相机资源，在开发的自定义相机里，如果预览图像已不需要显示，如按Home键盘切换后台或者锁屏后，此时就应该关闭预览并把相机资源释放掉。参考官方API文档，当surfaceView变成可见时，会创建surface并触发surfaceHolder.callback接口中surfaceCreated回调函数。而surfaceview变成不可见时，则会销毁surface，并触发surfacedestroyed回调函数。我们可以在对应的回调函数里，处理相机的相关操作，如连接surface、开启\u002F关闭预览。 至于相机资源释放，则可以放在Acticity的onpause里执行。相应的，要重新恢复预览图像时，可以把相机资源申请和初始化放在Acticity的onResume里执行，然后通过创建surfaceview，将camera和surface相连并开启预览。\n[image.jpg]\n但是在开发过程中发现，对于按HOME键切后台场景，程序可以正常运行。对于锁屏场景，则在重新申请相机资源时会发生crash，说相机资源访问失败。那么原因是什么呢？我在代码里增加了调试log， 检查了代码的执行顺序，结果如下： \n在自定义相机页面按HOME键时的执行流程：\n程序运行-\u003E按HOME键 \nActivity调用的顺序是onPause-\u003EonStop \nSurfaceView调用了surfaceDestroyed方法 \n然后再切回程序 \nActivity调用的顺序是onRestart-\u003EonStart-\u003EonResume \nSurfaceView调用了surfaceCreated-\u003EsurfaceChanged方法 \n而对于锁屏，其执行流程则是：\nActivity只调用onPause方法 \n解锁后Activity调用onResume方法 \nSurfaceView中surfaceholder.callback的所有方法都没有执行 \n\n问题找到了，由于锁屏时，callback的回调方法没有执行，导致相机和预览的连接还没有断开，相机资源就被释放了，所以导致在重新申请相机资源时，系统报crash。根据上面的文档，推测是锁屏下系统并没有改变surfaceview的可见性，于是我尝试在onPause和onResume时通过手动设置surfaceview的visibile属性，结果发现可以正常触发回调函数了。由于在切后台或者锁屏时，用户本来就应该看不到surfaceview，因此这种手动更改surfaceview的可见性的方法，并不会对用户的体验造成影响。\n[image.jpg]\n\n文章来自公众号：QQ空间终端开发团队(qzonemobiledev)","brief":"最近我负责开发了一个跟Android相机有关的需求，新功能允许用户使用手机摄像头，快速拍摄特定尺寸（1：1或3：4）的照片，并支持在拍摄出的照片上做贴纸相关的操...","summary":"这篇文章总结了Android相机开发的相关知识、流程，以及容易遇到的坑，希望能帮助今后可能会接触Android相机开发的朋友快速上手，节省时间，少走弯路。","picture":"http:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002Fee0fa247d7fcc219a981668cefb469a0\u002Fimage.jpg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1477316177,"updateTime":1509441514,"viewCount":22941,"likeCount":5,"commentCount":7,"weight":0,"status":2,"draftId":0,"author":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1,"badgeInfo":{}},"column":{"id":1026,"name":"QQ空间开发团队的专栏","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F18.png","background":"","status":2,"creatorId":1068677,"memberCount":2,"articleCount":23,"followCount":66,"createdTime":1475305445,"creator":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},"tags":[{"id":10216,"name":"Android","articleCount":0,"disable":0},{"id":10292,"name":"API","articleCount":0,"disable":0}],"translator":{}},"commentsData":{"fetchStatus":"loaded","pageNumber":1,"pageSize":10,"total":7,"list":[{"id":358,"content":"等下次有机会接触到这方面的开发时可以看看 很不错","authorId":1259650,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1518102707,"likeCount":0,"author":{"id":1259650,"name":"黄桂期","label":"菜鸟一枚～","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1259650\u002Fwfusbbj7ve.jpg","province":"1057","city":"1058","company":"","title":"","school":"吉林财经大学","major":"计算机科学与技术","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":3510,"content":"谢谢楼主分享，少踩不少坑。","authorId":1221673,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1524825204,"likeCount":0,"author":{"id":1221673,"name":"苏雨丶","label":"","avatar":"\u002F\u002Fimgcache.qq.com\u002Fopen_proj\u002Fproj_qcloud_v2\u002Fgateway\u002Fq-and-a\u002Fcss\u002Fimg\u002Favatar-default.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"game","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":5553,"content":"学习了","authorId":1221916,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1526282786,"likeCount":0,"author":{"id":1221916,"name":"依然丶","label":"","avatar":"\u002F\u002Fimgcache.qq.com\u002Fopen_proj\u002Fproj_qcloud_v2\u002Fgateway\u002Fq-and-a\u002Fcss\u002Fimg\u002Favatar-default.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"game","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":10122,"content":"看过有关新旧api的文章，这也算一个坑吗","authorId":1221879,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1528271418,"likeCount":0,"author":{"id":1221879,"name":"上官兰雨","label":"","avatar":"\u002F\u002Fimgcache.qq.com\u002Fopen_proj\u002Fproj_qcloud_v2\u002Fgateway\u002Fq-and-a\u002Fcss\u002Fimg\u002Favatar-default.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"game","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":10127,"content":"这开发是各种应用的滤镜什么的吗","authorId":1512554,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1528272125,"likeCount":0,"author":{"id":1512554,"name":"东耳kai","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1512554\u002Fmb0c2nvcg4.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"itcc","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":10128,"content":"crush是什么故障","authorId":1221833,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1528272132,"likeCount":0,"author":{"id":1221833,"name":"上官元恒","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1221833\u002Fo8y7gc5scw.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"game","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}},{"id":13291,"content":"学习了","authorId":2304635,"articleId":1004416,"parentCommentId":0,"parentCommentAuthorId":1068677,"writeTime":1535595401,"likeCount":0,"author":{"id":2304635,"name":"用户2304635","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2304635\u002Fd6lg47gt39.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":false,"status":1},"parentCommentAuthor":{"id":1068677,"name":"QQ空间开发团队","label":"","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F4599f3d566f45b87a38807481730a591\u002Fimage.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"mobileapp","growthLevel":0,"isProfessionVerified":false,"status":1}}]},"sameColumnArticles":[{"id":1004408,"title":"TPatch动态补丁系统(iOS)","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1477017977,"updateTime":1509441514,"viewCount":2379,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0},{"id":1004407,"title":"ReactNative For Android 项目实战总结","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1476007995,"updateTime":1509441514,"viewCount":1964,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0},{"id":1004405,"title":"iOS 高性能图片架构与设计","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1476837475,"updateTime":1509441514,"viewCount":2230,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0},{"id":1004417,"title":"安卓 App 热补丁动态修复技术介绍","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1477361307,"updateTime":1509441514,"viewCount":1170,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0},{"id":1004418,"title":"Android GC 那点事","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1477373388,"updateTime":1509441514,"viewCount":1529,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0}],"adjacentArticles":{"prevArticle":{"id":1004415,"title":"高性能服务器架构思路( 五 ) : 分布式缓存","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":465996,"columnId":1036,"writeTime":1476929871,"updateTime":1501753165,"viewCount":3255,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0},"nextArticle":{"id":1004417,"title":"安卓 App 热补丁动态修复技术介绍","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{},"authorId":1068677,"columnId":1026,"writeTime":1477361307,"updateTime":1509441514,"viewCount":1170,"likeCount":0,"commentCount":0,"weight":0,"status":2,"draftId":0}},"relatedArticles":[{"id":1327125,"title":"【二代示波器教程】第11章 示波器设计—功能模块划分","content":"","plain":"","brief":"","summary":"二代示波器的界面上做了五个按钮，分别用于不同功能的配置，本章节就为大家讲解这五个按钮实现的功能。","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-2977066\u002F0qqq9o21ie.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2018-07-07 16:59"},"authorId":2977066,"columnId":5133,"writeTime":0,"updateTime":0,"viewCount":77,"likeCount":2,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":2977066,"name":"用户2977066","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2977066\u002F2yw1gep7le.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":5133,"name":"安富莱嵌入式技术分享","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F4.png","background":"","status":2,"creatorId":2977066,"memberCount":1,"articleCount":81,"followCount":12,"createdTime":1534921193}},{"id":1327122,"title":"【安富莱二代示波器教程】第7章 示波器设计—波形滑动浏览","content":"","plain":"","brief":"","summary":"类似手机的滑动功能用在示波器上还是比较实用的，可以用来调节波形位置和滑动浏览波形的存储记录。","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-2977066\u002F5ogqg7mfig.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2018-06-29 15:51"},"authorId":2977066,"columnId":5133,"writeTime":0,"updateTime":0,"viewCount":53,"likeCount":2,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":2977066,"name":"用户2977066","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2977066\u002F2yw1gep7le.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":5133,"name":"安富莱嵌入式技术分享","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F4.png","background":"","status":2,"creatorId":2977066,"memberCount":1,"articleCount":81,"followCount":12,"createdTime":1534921193}},{"id":1039997,"title":"VR中的动画就是这么玩哒","content":"","plain":"","brief":"","summary":"导读 \n大家是不是觉得VR中的动画特别神奇，其实它是基于Unity中的动画系统Mecanim实现的，Unity在5.0之后，Mecanim动画控制越来越强大好用...","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-751946\u002Fm4pfc5v7ro.png","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2016-12-23","author":"vaconzhang","nickName":"腾讯移动品质中心TMQ","userName":"gh_2052d3e8c27d","alias":""},"authorId":751946,"columnId":1088,"writeTime":0,"updateTime":0,"viewCount":213,"likeCount":6,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":751946,"name":"腾讯移动品质中心TMQ","label":"无品质，不前行","avatar":"https:\u002F\u002Fmc.qcloudimg.com\u002Fstatic\u002Fimg\u002F1835a2bf6b76478433da5dbb8712d51e\u002FTMQ.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":1088,"name":"腾讯移动品质中心TMQ的专栏","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F7.png","background":"","status":2,"creatorId":751946,"memberCount":1,"articleCount":272,"followCount":115,"createdTime":1487728052}},{"id":1157759,"title":"基于 HTML5 WebGL 的 3D 服务器与客户端的通信","content":"","plain":"","brief":"","summary":"","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"oschina","originalTime":""},"authorId":2212597,"columnId":3721,"writeTime":0,"updateTime":0,"viewCount":96,"likeCount":2,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":2212597,"name":"HT_hightopo","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F2212597\u002F44kwhp7wc7.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":3721,"name":"hightopo","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F20.png","background":"","status":2,"creatorId":2212597,"memberCount":1,"articleCount":141,"followCount":40,"createdTime":1526874709}},{"id":1023306,"title":"【插件开发】—— 13 GEF双击模型事件","content":"","plain":"","brief":"","summary":"  \n 前文回顾：\n 1 插件学习篇\n 2 简单的建立插件工程以及模型文件分析\n 3 利用扩展点，开发透视图\n 4 SWT编程须知\n 5 SWT简单控件的使用与...","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2014-11-20 19:44"},"authorId":1154259,"columnId":1740,"writeTime":0,"updateTime":0,"viewCount":190,"likeCount":8,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1154259,"name":"用户1154259","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1154259\u002F6yajbtxjg7.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":1740,"name":"xingoo, 一个梦想做发明家的程序员","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F14.png","background":"","status":2,"creatorId":1154259,"memberCount":1,"articleCount":787,"followCount":66,"createdTime":1513846126}},{"id":1101924,"title":"手把手教你打造一个纯CSS图标库","content":"","plain":"","brief":"","summary":"来，干了这碗安利\n写这篇文章的目的其实就是为了安利一下我的图标库：iconoo，所以，开门见山，star吧少年少妇们！（这样的我是不是应该要加个github互粉...","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1667431\u002F96zd5tc932.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2016-11-08","author":"","nickName":"大数据钻研","userName":"gh_b0d9ef35ee3e","alias":"bigdata118"},"authorId":1667431,"columnId":2531,"writeTime":0,"updateTime":0,"viewCount":290,"likeCount":4,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1667431,"name":"用户1667431","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1667431\u002Fnr21snftch.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":2531,"name":"大数据钻研","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F1.png","background":"","status":2,"creatorId":1667431,"memberCount":1,"articleCount":198,"followCount":41,"createdTime":1523868824}},{"id":1031857,"title":"【独家】一种手机上实现屏幕录制成gif的方案","content":"","plain":"","brief":"","summary":"前言：一直以来，很多做apk演示效果时，通过图片的方式，总是没有看起来那样炫丽和灵动。如果能在手机上，直接通过录制屏幕，而变成gif。那可是省去了好多时间。进而...","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1262904\u002F6z4qxkabx7.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"wechat","originalTime":"2016-12-27","author":"逆流的鱼yuiop","nickName":"何俊林","userName":"gh_0c62200dbb64","alias":"DriodDeveloper"},"authorId":1262904,"columnId":1998,"writeTime":0,"updateTime":0,"viewCount":186,"likeCount":7,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1262904,"name":"逆流的鱼yuiop","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1262904\u002Fa4cgdvxwwu.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":1998,"name":"何俊林","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F3.png","background":"","status":2,"creatorId":1262904,"memberCount":1,"articleCount":253,"followCount":55,"createdTime":1516698410}},{"id":1009608,"title":"移动端动画方案","content":"","plain":"","brief":"","summary":"前言\n花样直播项目客服端的动画基本已都使用web来做，总结分享一下\n方案列表\ncss3动画\ncanvas 动画\n播图片\ngif图片\n各个方案的优缺点\ncss3动...","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"","originalTime":"2016-05-03 14:10"},"authorId":1021320,"columnId":1677,"writeTime":0,"updateTime":0,"viewCount":182,"likeCount":9,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1021320,"name":"IMWeb前端团队","label":"IMWEB团队正式成立是时间是2011年6月7日，团队创立之初是负责腾讯最核心的基础业务，QQ注册， QQ登录（ptlogin），QQ资料和关系链拓展等基础服务。 后转型进行应用开发，分别投入Q+，QQ圈子， QQ匿名聊，QQ群整体业务等。目前主要负责腾讯在线教育战略产品腾讯课堂，多人社交互动视频以及活动 组织类项目的研发工作。 IMWeb团队成员目前已分布全国各大互联网企业，或有些在创业公司担当","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1021320\u002Fvd3193otj0.png","province":"1213","city":"1216","company":"腾讯","title":"前端开发工程师","school":"","major":"","homePage":"http:\u002F\u002Fimweb.io","region":1,"jobType":1,"graduationDate":"","education":0,"skills":["javascript","node","webpack","react","webrtc"],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":true,"status":1},"column":{"id":1677,"name":"IMWeb前端团队","desc":"IMWeb前端团队专栏","icon":"https:\u002F\u002Fask.qcloudimg.com\u002Fcolumn-icons\u002F1677\u002F1021320\u002Ffedv6af1bn.png","background":"","status":2,"creatorId":1021320,"memberCount":1,"articleCount":592,"followCount":115,"createdTime":1513155952}},{"id":1344200,"title":"一个创建产品动画说明视频的新手指南","content":"","plain":"","brief":"","summary":"英文原文：A Step-by-step Guide to Creating Animated Product Explainer Videos","picture":"https:\u002F\u002Fask.qcloudimg.com\u002Fhttp-save\u002Fyehe-1378593\u002Fenl544yz3f.jpeg","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"windcoder","originalTime":"2017-06-19"},"authorId":1378593,"columnId":72445,"writeTime":0,"updateTime":0,"viewCount":54,"likeCount":1,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1378593,"name":"汐楓","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1378593\u002F1ix0ivxxio.png","province":"1001","city":"","company":"","title":"","school":"","major":"","homePage":"https:\u002F\u002Fwindcoder.com\u002F","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"other","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":72445,"name":"WindCoder","desc":"所有文章首发于https:\u002F\u002Fwindcoder.com\u002F，文章均自动同步于此。","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F2.png","background":"","status":2,"creatorId":1378593,"memberCount":1,"articleCount":329,"followCount":26,"createdTime":1537152969}},{"id":1047582,"title":"一个最基本的布局控件-panel","content":"","plain":"","brief":"","summary":"Silverlight做了两个布局的控件了。\n Silverlight控件 - Carrousel\n Silverlight控件 - ScatterView\n所...","picture":"","sourceType":1,"sourceDetail":{},"channelType":0,"channelDetail":{"source":"cnblogs","originalTime":"2009-03-09 22:38"},"authorId":1172164,"columnId":1728,"writeTime":0,"updateTime":0,"viewCount":274,"likeCount":5,"commentCount":0,"weight":0,"status":2,"draftId":0,"author":{"id":1172164,"name":"用户1172164","label":"","avatar":"https:\u002F\u002Fask.qcloudimg.com\u002Favatar\u002F1172164\u002Faeyrhu23d1.png","province":"","city":"","company":"","title":"","school":"","major":"","homePage":"","region":1,"jobType":1,"graduationDate":"","education":0,"skills":[],"gender":1,"trade":"website_new","growthLevel":0,"isProfessionVerified":false,"status":1},"column":{"id":1728,"name":"我和未来有约会","desc":"","icon":"https:\u002F\u002Fimgcache.qq.com\u002Fqcloud\u002Fdeveloper\u002Fimages\u002Frelease\u002Fcolumn-icons\u002F18.png","background":"","status":2,"creatorId":1172164,"memberCount":1,"articleCount":152,"followCount":44,"createdTime":1513762742}}],"anchorToCommentsArea":false,"isFromOriginalSharing":false,"env":"production","documentBaseTitle":"云+社区 - 腾讯云","cdnDomain":"imgcache.qq.com","cssDomain":"imgcache.qq.com","session":{"isLogined":false,"isQcloudUser":false,"isOwner":false,"nickname":"","accountInfoCompleted":false,"profile":{}},"fromMiniProgram":false,"route":{"url":"\u002Fdeveloper\u002Farticle\u002F1004416","path":"\u002Fdeveloper\u002Farticle\u002F1004416","pathname":"\u002Fdeveloper\u002Farticle\u002F1004416","search":"","query":{},"segments":["developer","article","1004416"]}});
</script><script src="https://cloud.tencent.com/qccomponent/loader.js" async=""></script><script src="//imgcache.qq.com/qcloud/main/scripts/release/common/qcloudStatApi.js" async=""></script></body></html>