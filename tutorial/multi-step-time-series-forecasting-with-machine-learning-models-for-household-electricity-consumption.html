<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="pingback" href="https://machinelearningmastery.com/xmlrpc.php" />

<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>

<!-- This site is optimized with the Yoast SEO plugin v9.0.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption</title>
<link rel="canonical" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/" />
<link rel="publisher" href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/"/>
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption" />
<meta property="og:description" content="Given the rise of smart electricity meters and the wide adoption of electricity generation technology like solar panels, there is a wealth of electricity usage data available. This data represents a multivariate time series of power-related variables that in turn could be used to model and even forecast future electricity consumption. Machine learning algorithms predict &hellip;" />
<meta property="og:url" content="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/" />
<meta property="og:site_name" content="Machine Learning Mastery" />
<meta property="article:publisher" content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" />
<meta property="article:author" content="https://www.facebook.com/jason.brownlee.39" />
<meta property="article:section" content="Deep Learning for Time Series" />
<meta property="article:published_time" content="2018-10-04T19:00:38+00:00" />
<meta property="article:modified_time" content="2018-08-30T00:33:33+00:00" />
<meta property="og:updated_time" content="2018-08-30T00:33:33+00:00" />
<meta property="og:image" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms.png" />
<meta property="og:image:secure_url" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms.png" />
<meta property="og:image:width" content="1280" />
<meta property="og:image:height" content="960" />
<meta property="og:image:alt" content="Line Plot of Direct Per-Lead Time Multi-step Forecasts With Linear Algorithms" />
<script type='application/ld+json'>{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Feed" href="https://feeds.feedburner.com/MachineLearningMastery" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Comments Feed" href="https://machinelearningmastery.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery &raquo; Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption Comments Feed" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style type="text/css" media="all">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link rel='stylesheet' id='crayon-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wpautoterms_css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/auto-terms-of-service-and-privacy-policy/css/wpautoterms.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.4' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-style-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/ewd-ufaq-styles.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='ewd-ufaq-rrssb-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/ultimate-faqs/css/rrssb-min.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='woo-testimonials-css-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.8' type='text/css' media='all' />
<link rel='stylesheet' id='theme-stylesheet-css'  href='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21' type='text/css' media='all' />
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.8'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.8'></script>
<link rel='https://api.w.org/' href='https://machinelearningmastery.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://machinelearningmastery.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://machinelearningmastery.com/?p=6272' />
<link rel="alternate" type="application/json+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption%2F&#038;format=xml" />
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

    <script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>

<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>

<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css" />

<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css" />

<!-- Theme version -->
<meta name="generator" content="Canvas 5.9.21" />
<meta name="generator" content="WooFramework 6.2.9" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" sizes="32x32" />
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" />
<meta name="msapplication-TileImage" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" />
</head>
<body class="post-template-default single single-post postid-6272 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">

	<div id="inner-wrapper">

	<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>

	<header id="header" class="col-full">

		<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/09/icon-100x100.png" alt="Machine Learning Mastery" /></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
	    <div class="header-widget">
	        <div id="text-53" class="widget widget_text">			<div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
		</div><div id="search-3" class="widget widget_search"><div class="search_main">
    <form method="get" class="searchform" action="https://machinelearningmastery.com/" >
        <input type="text" class="field s" name="s" value="Search..." onfocus="if (this.value == 'Search...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search...';}" />
		<input type="hidden" name="post_type" value="post" />
        <button type="submit" class="fa fa-search submit" name="submit" value="Search"></button>
    </form>
    <div class="fix"></div>
</div></div>	    </div>
	
	</header>
	<nav id="navigation" class="col-full" role="navigation">

	
	<section class="menus">

		<a href="https://machinelearningmastery.com" class="nav-home"><span>Home</span></a>

	<h3>Main Menu</h3><ul id="main-nav" class="nav fl"><li id="menu-item-6503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li id="menu-item-6501" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li id="menu-item-6506" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506"><a href="#">Topics</a>
<ul class="sub-menu">
	<li id="menu-item-6508" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
	<li id="menu-item-6511" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
	<li id="menu-item-6509" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
	<li id="menu-item-6515" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
	<li id="menu-item-6512" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
	<li id="menu-item-6507" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
	<li id="menu-item-6513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
	<li id="menu-item-6516" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
	<li id="menu-item-6517" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
	<li id="menu-item-6522" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
	<li id="menu-item-6518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
	<li id="menu-item-6510" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
	<li id="menu-item-6519" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
	<li id="menu-item-6520" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
	<li id="menu-item-6523" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
	<li id="menu-item-6514" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li id="menu-item-6502" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li id="menu-item-6500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li id="menu-item-6504" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li id="menu-item-6505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul>	<div class="side-nav">
		</div><!-- /#side-nav -->

	</section><!-- /.menus -->

	<a href="#top" class="nav-close"><span>Return to Content</span></a>

</nav>
       
    <!-- #content Starts -->
	    <div id="content" class="col-full">
    
    	<div id="main-sidebar-container">    

            <!-- #main Starts -->
                        <section id="main">                       
<article class="post-6272 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
	<header>
	<h1 class="title entry-title">Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption</h1>	</header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" title="Posts by Jason Brownlee" rel="author">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-05T05:00:38+1100">October 5, 2018</abbr>  <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span>  </div>
	<section class="entry">
<p>Given the rise of smart electricity meters and the wide adoption of electricity generation technology like solar panels, there is a wealth of electricity usage data available.</p>
<p>This data represents a multivariate time series of power-related variables that in turn could be used to model and even forecast future electricity consumption.</p>
<p>Machine learning algorithms predict a single value and cannot be used directly for multi-step forecasting. Two strategies that can be used to make multi-step forecasts with machine learning algorithms are the recursive and the direct methods.</p>
<p>In this tutorial, you will discover how to develop recursive and direct multi-step forecasting models with machine learning algorithms.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a framework for evaluating linear, nonlinear, and ensemble machine learning algorithms for multi-step time series forecasting.</li>
<li>How to evaluate machine learning algorithms using a recursive multi-step time series forecasting strategy.</li>
<li>How to evaluate machine learning algorithms using a direct per-day and per-lead time multi-step time series forecasting strategy.</li>
</ul>
<p>Let’s get started.</p>
<div id="attachment_6276" style="width: 650px" class="wp-caption aligncenter"><img class="size-full wp-image-6276" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/Multi-step-Time-Series-Forecasting-with-Machine-Learning-Models-for-Household-Electricity-Consumption.jpg" alt="Multi-step Time Series Forecasting with Machine Learning Models for Household Electricity Consumption" width="640" height="398" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/Multi-step-Time-Series-Forecasting-with-Machine-Learning-Models-for-Household-Electricity-Consumption.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/Multi-step-Time-Series-Forecasting-with-Machine-Learning-Models-for-Household-Electricity-Consumption-300x187.jpg 300w" sizes="(max-width: 640px) 100vw, 640px" /><p class="wp-caption-text">Multi-step Time Series Forecasting with Machine Learning Models for Household Electricity Consumption<br />Photo by <a href="https://www.flickr.com/photos/seanfx/9827244314/">Sean McMenemy</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into five parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Load and Prepare Dataset</li>
<li>Model Evaluation</li>
<li>Recursive Multi-Step Forecasting</li>
<li>Direct Multi-Step Forecasting</li>
</ol>
<h2>Problem Description</h2>
<p>The &#8216;<a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Household Power Consumption</a>&#8216; dataset is a multivariate time series dataset that describes the electricity consumption for a single household over four years.</p>
<p>The data was collected between December 2006 and November 2010 and observations of power consumption within the household were collected every minute.</p>
<p>It is a multivariate series comprised of seven variables (besides the date and time); they are:</p>
<ul>
<li><strong>global_active_power</strong>: The total active power consumed by the household (kilowatts).</li>
<li><strong>global_reactive_power</strong>: The total reactive power consumed by the household (kilowatts).</li>
<li><strong>voltage</strong>: Average voltage (volts).</li>
<li><strong>global_intensity</strong>: Average current intensity (amps).</li>
<li><strong>sub_metering_1</strong>: Active energy for kitchen (watt-hours of active energy).</li>
<li><strong>sub_metering_2</strong>: Active energy for laundry (watt-hours of active energy).</li>
<li><strong>sub_metering_3</strong>: Active energy for climate control systems (watt-hours of active energy).</li>
</ul>
<p>Active and reactive energy refer to the technical details of <a href="https://en.wikipedia.org/wiki/AC_power">alternative current</a>.</p>
<p>A fourth sub-metering variable can be created by subtracting the sum of three defined sub-metering variables from the total active energy as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd0a033806937" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd0a033806937-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd0a033806937-1">sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Load and Prepare Dataset</h2>
<p>The dataset can be downloaded from the UCI Machine Learning repository as a single 20 megabyte .zip file:</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00235/household_power_consumption.zip">household_power_consumption.zip</a></li>
</ul>
<p>Download the dataset and unzip it into your current working directory. You will now have the file &#8220;<em>household_power_consumption.txt</em>&#8221; that is about 127 megabytes in size and contains all of the observations.</p>
<p>We can use the <em>read_csv()</em> function to load the data and combine the first two columns into a single date-time column that we can use as an index.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd13707740756" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0, low_memory=False, infer_datetime_format=True, parse_dates={'datetime':[0,1]}, index_col=['datetime'])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd13707740756-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd13707740756-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd13707740756-1"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd13707740756-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Next, we can mark all <a href="https://machinelearningmastery.com/handle-missing-timesteps-sequence-prediction-problems-python/">missing values</a> indicated with a &#8216;<em>?</em>&#8216; character with a <em>NaN</em> value, which is a float.</p>
<p>This will allow us to work with the data as one array of floating point values rather than mixed types (less efficient.)</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd16273629775" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd16273629775-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd16273629775-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd16273629775-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd16273629775-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd16273629775-1"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd16273629775-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd16273629775-3"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd16273629775-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We also need to fill in the missing values now that they have been marked.</p>
<p>A very simple approach would be to copy the observation from the same time the day before. We can implement this in a function named <em>fill_missing()</em> that will take the NumPy array of the data and copy values from exactly 24 hours ago.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd19519163449" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd19519163449-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd19519163449-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd19519163449-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd19519163449-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd19519163449-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd19519163449-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd19519163449-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd19519163449-1"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd19519163449-2"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd19519163449-3"><span class="crayon-h">	</span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd19519163449-4"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd19519163449-5"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd19519163449-6"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd19519163449-7"><span class="crayon-h">				</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can apply this function directly to the data within the DataFrame.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd1b762342215" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fill missing
fill_missing(dataset.values)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd1b762342215-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd1b762342215-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd1b762342215-1"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd1b762342215-2"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now we can create a new column that contains the remainder of the sub-metering, using the calculation from the previous section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd1e000560643" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + values[:,5] + values[:,6])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd1e000560643-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd1e000560643-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd1e000560643-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd1e000560643-1"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd1e000560643-2"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5bd2bf158dd1e000560643-3"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can now save the cleaned-up version of the dataset to a new file; in this case we will just change the file extension to .csv and save the dataset as &#8216;<em>household_power_consumption.csv</em>&#8216;.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd20782965626" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd20782965626-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd20782965626-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd20782965626-1"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd20782965626-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Tying all of this together, the complete example of loading, cleaning-up, and saving the dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd22628622732" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load and clean-up data
from numpy import nan
from numpy import isnan
from pandas import read_csv
from pandas import to_numeric

# fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]

# load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0, low_memory=False, infer_datetime_format=True, parse_dates={'datetime':[0,1]}, index_col=['datetime'])
# mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')
# fill missing
fill_missing(dataset.values)
# add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + values[:,5] + values[:,6])
# save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd22628622732-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf158dd22628622732-27">27</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-1"><span class="crayon-p"># load and clean-up data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">to_numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-6">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-7"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-8"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-9"><span class="crayon-h">	</span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-10"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-11"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-12"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-13"><span class="crayon-h">				</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-14">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-15"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-17"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-18"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-19"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-20"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-21"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-22"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-23"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-24"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-25"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd22628622732-26"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line" id="crayon-5bd2bf158dd22628622732-27"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>Running the example creates the new file &#8216;<em>household_power_consumption.csv</em>&#8216; that we can use as the starting point for our modeling project.</p>
<p><div class="woo-sc-hr"></div></p>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" target="_blank" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;">Download Your FREE Mini-Course</a><script data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" data-config="%7B%7D" type="text/javascript" src="https://machinelearningmastery.lpages.co/leadbox-1534880695.js"></script></p>
</center>
<p><div class="woo-sc-hr"></div></p>
<h2>Model Evaluation</h2>
<p>In this section, we will consider how we can develop and evaluate predictive models for the household power dataset.</p>
<p>This section is divided into four parts; they are:</p>
<ol>
<li>Problem Framing</li>
<li>Evaluation Metric</li>
<li>Train and Test Sets</li>
<li>Walk-Forward Validation</li>
</ol>
<h3>Problem Framing</h3>
<p>There are many ways to harness and explore the household power consumption dataset.</p>
<p>In this tutorial, we will use the data to explore a very specific question; that is:</p>
<blockquote><p>Given recent power consumption, what is the expected power consumption for the week ahead?</p></blockquote>
<p>This requires that a predictive model forecast the total active power for each day over the next seven days.</p>
<p>Technically, this framing of the problem is referred to as a multi-step time series forecasting problem, given the multiple forecast steps. A model that makes use of multiple input variables may be referred to as a multivariate multi-step time series forecasting model.</p>
<p>A model of this type could be helpful within the household in planning expenditures. It could also be helpful on the supply side for planning electricity demand for a specific household.</p>
<p>This framing of the dataset also suggests that it would be useful to downsample the per-minute observations of power consumption to daily totals. This is not required, but makes sense, given that we are interested in total power per day.</p>
<p>We can achieve this easily using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">resample() function</a> on the pandas DataFrame. Calling this function with the argument &#8216;<em>D</em>&#8216; allows the loaded data indexed by date-time to be grouped by day (<a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">see all offset aliases</a>). We can then calculate the sum of all observations for each day and create a new dataset of daily power consumption data for each of the eight variables.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd27216858609" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# resample minute data to total for each day
from pandas import read_csv
# load the new file
dataset = read_csv('household_power_consumption.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# resample data to daily
daily_groups = dataset.resample('D')
daily_data = daily_groups.sum()
# summarize
print(daily_data.shape)
print(daily_data.head())
# save
daily_data.to_csv('household_power_consumption_days.csv')</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd27216858609-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd27216858609-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-1"><span class="crayon-p"># resample minute data to total for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-3"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-5"><span class="crayon-p"># resample data to daily</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-6"><span class="crayon-v">daily_groups</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">resample</span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-7"><span class="crayon-v">daily_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">daily_groups</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-8"><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd27216858609-11"><span class="crayon-p"># save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd27216858609-12"><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Running the example creates a new daily total power consumption dataset and saves the result into a separate file named &#8216;<em>household_power_consumption_days.csv</em>&#8216;.</p>
<p>We can use this as the dataset for fitting and evaluating predictive models for the chosen framing of the problem.</p>
<h3>Evaluation Metric</h3>
<p>A forecast will be comprised of seven values, one for each day of the week ahead.</p>
<p>It is common with multi-step forecasting problems to evaluate each forecasted time step separately. This is helpful for a few reasons:</p>
<ul>
<li>To comment on the skill at a specific lead time (e.g. +1 day vs +3 days).</li>
<li>To contrast models based on their skills at different lead times (e.g. models good at +1 day vs models good at days +5).</li>
</ul>
<p>The units of the total power are kilowatts and it would be useful to have an error metric that was also in the same units. Both Root Mean Squared Error (RMSE) and Mean Absolute Error (MAE) fit this bill, although RMSE is more commonly used and will be adopted in this tutorial. Unlike MAE, RMSE is more punishing of forecast errors.</p>
<p>The performance metric for this problem will be the RMSE for each lead time from day 1 to day 7.</p>
<p>As a short-cut, it may be useful to summarize the performance of a model using a single score in order to aide in model selection.</p>
<p>One possible score that could be used would be the RMSE across all forecast days.</p>
<p>The function <em>evaluate_forecasts()</em> below will implement this behavior and return the performance of a model based on multiple seven-day forecasts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd2a784166870" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2a784166870-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2a784166870-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-1"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-3"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-4"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-6"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-7"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-8"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-9"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-10"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-11"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-12"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-13"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-14"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-15"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-16"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5bd2bf158dd2a784166870-17"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2a784166870-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the function will first return the overall RMSE regardless of day, then an array of RMSE scores for each day.</p>
<h3>Train and Test Sets</h3>
<p>We will use the first three years of data for training predictive models and the final year for evaluating models.</p>
<p>The data in a given dataset will be divided into standard weeks. These are weeks that begin on a Sunday and end on a Saturday.</p>
<p>This is a realistic and useful way for using the chosen framing of the model, where the power consumption for the week ahead can be predicted. It is also helpful with modeling, where models can be used to predict a specific day (e.g. Wednesday) or the entire sequence.</p>
<p>We will split the data into standard weeks, working backwards from the test dataset.</p>
<p>The final year of the data is in 2010 and the first Sunday for 2010 was January 3rd. The data ends in mid November 2010 and the closest final Saturday in the data is November 20th. This gives 46 weeks of test data.</p>
<p>The first and last rows of daily data for the test dataset are provided below for confirmation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd2e093659419" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992
...
2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd2e093659419-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd2e093659419-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd2e093659419-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd2e093659419-1">2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd2e093659419-2">...</div><div class="crayon-line" id="crayon-5bd2bf158dd2e093659419-3">2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The daily data starts in late 2006.</p>
<p>The first Sunday in the dataset is December 17th, which is the second row of data.</p>
<p>Organizing the data into standard weeks gives 159 full standard weeks for training a predictive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd31565810550" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004
...
2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd31565810550-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd31565810550-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd31565810550-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd31565810550-1">2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd31565810550-2">...</div><div class="crayon-line" id="crayon-5bd2bf158dd31565810550-3">2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The function <em>split_dataset()</em> below splits the daily data into train and test sets and organizes each into standard weeks.</p>
<p>Specific row offsets are used to split the data using knowledge of the dataset. The split datasets are then organized into weekly data using the NumPy <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">split() function</a>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd33366919156" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd33366919156-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd33366919156-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd33366919156-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd33366919156-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd33366919156-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd33366919156-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd33366919156-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd33366919156-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd33366919156-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd33366919156-2"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd33366919156-3"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd33366919156-4"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd33366919156-5"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd33366919156-6"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd33366919156-7"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd33366919156-8"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>We can test this function out by loading the daily dataset and printing the first and last rows of data from both the train and test sets to confirm they match the expectations above.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd35358736564" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# split into standard weeks
from numpy import split
from numpy import array
from pandas import read_csv

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
train, test = split_dataset(dataset.values)
# validate train data
print(train.shape)
print(train[0, 0, 0], train[-1, -1, 0])
# validate test
print(test.shape)
print(test[0, 0, 0], test[-1, -1, 0])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd35358736564-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf158dd35358736564-23">23</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-1"><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-6"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-7"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-8"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-9"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-10"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-11"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-12"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-13"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-14">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-15"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-17"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-18"><span class="crayon-p"># validate train data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-20"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-21"><span class="crayon-p"># validate test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd35358736564-22"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd35358736564-23"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0027 seconds] -->
<p>Running the example shows that indeed the train dataset has 159 weeks of data, whereas the test dataset has 46 weeks.</p>
<p>We can see that the total active power for the train and test dataset for the first and last rows match the data for the specific dates that we defined as the bounds on the standard weeks for each set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd38164171110" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
(159, 7, 8)
3390.46 1309.2679999999998
(46, 7, 8)
2083.4539999999984 2197.006000000004</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd38164171110-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd38164171110-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd38164171110-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd38164171110-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd38164171110-1">(159, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd38164171110-2">3390.46 1309.2679999999998</div><div class="crayon-line" id="crayon-5bd2bf158dd38164171110-3">(46, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd38164171110-4">2083.4539999999984 2197.006000000004</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Walk-Forward Validation</h3>
<p>Models will be evaluated using a scheme called walk-forward validation.</p>
<p>This is where a model is required to make a one week prediction, then the actual data for that week is made available to the model so that it can be used as the basis for making a prediction on the subsequent week. This is both realistic for how the model may be used in practice and beneficial to the models, allowing them to make use of the best available data.</p>
<p>We can demonstrate this below with separation of input data and output/predicted data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd3b287538268" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Input, 						Predict
[Week1]						Week2
[Week1 + Week2]				Week3
[Week1 + Week2 + Week3]		Week4
...</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd3b287538268-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3b287538268-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3b287538268-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3b287538268-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3b287538268-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd3b287538268-1">Input, 						Predict</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3b287538268-2">[Week1]						Week2</div><div class="crayon-line" id="crayon-5bd2bf158dd3b287538268-3">[Week1 + Week2]				Week3</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3b287538268-4">[Week1 + Week2 + Week3]		Week4</div><div class="crayon-line" id="crayon-5bd2bf158dd3b287538268-5">...</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The walk-forward validation approach to evaluating predictive models on this dataset is provided in a function below, named <em>evaluate_model()</em>.</p>
<p>A scikit-learn model object is provided as an argument to the function, along with the train and test datasets. An additional argument <em>n_input</em> is provided that is used to define the number of prior observations that the model will use as input in order to make a prediction.</p>
<p>The specifics of how a scikit-learn model is fit and makes predictions is covered in later sections.</p>
<p>The forecasts made by the model are then evaluated against the test dataset using the previously defined <em>evaluate_forecasts()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd3d549495326" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate a single model
def evaluate_model(model, train, test, n_input):
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = ...
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	predictions = array(predictions)
	# evaluate predictions days for each week
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd3d549495326-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd3d549495326-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-1"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-3"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-4"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-5"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-6"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-8"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-9"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-10"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-11"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-12"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-13"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-14"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-15"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd3d549495326-16"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd3d549495326-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>Once we have the evaluation for a model we can summarize the performance.</p>
<p>The function below, named <em>summarize_scores()</em>, will display the performance of a model as a single line for easy comparison with other models.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd40650745598" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd40650745598-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd40650745598-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd40650745598-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd40650745598-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd40650745598-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd40650745598-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd40650745598-3"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd40650745598-4"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We now have all of the elements to begin evaluating predictive models on the dataset.</p>
<h2>Recursive Multi-Step Forecasting</h2>
<p>Most predictive modeling algorithms will take some number of observations as input and predict a single output value.</p>
<p>As such, they cannot be used directly to make a multi-step time series forecast.</p>
<p>This applies to most linear, nonlinear, and ensemble machine learning algorithms.</p>
<p>One approach where machine learning algorithms can be used to make a multi-step time series forecast is to use them recursively.</p>
<p>This involves making a prediction for one time step, taking the prediction, and feeding it into the model as an input in order to predict the subsequent time step. This process is repeated until the desired number of steps have been forecasted.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd43912269897" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
X = [x1, x2, x3]
y1 = model.predict(X)

X = [x2, x3, y1]
y2 = model.predict(X)

X = [x3, y1, y2]
y3 = model.predict(X)

...</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd43912269897-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd43912269897-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd43912269897-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd43912269897-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd43912269897-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd43912269897-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd43912269897-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd43912269897-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd43912269897-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd43912269897-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd43912269897-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">x1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x3</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd43912269897-2"><span class="crayon-v">y1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd43912269897-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd43912269897-4"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">x2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd43912269897-5"><span class="crayon-v">y2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd43912269897-6">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd43912269897-7"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">x3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd43912269897-8"><span class="crayon-v">y3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd43912269897-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd43912269897-10"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>In this section, we will develop a test harness for fitting and evaluating machine learning algorithms provided in scikit-learn using a recursive model for multi-step forecasting.</p>
<p>The first step is to convert the prepared training data in window format into a single univariate series.</p>
<p>The <em>to_series()</em> function below will convert a list of weekly multivariate data into a single univariate series of daily total power consumed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd45293116721" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert windows of weekly multivariate data into a series of total power
def to_series(data):
	# extract just the total power from each week
	series = [week[:, 0] for week in data]
	# flatten into a single series
	series = array(series).flatten()
	return series</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd45293116721-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd45293116721-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd45293116721-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd45293116721-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd45293116721-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd45293116721-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd45293116721-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd45293116721-1"><span class="crayon-p"># convert windows of weekly multivariate data into a series of total power</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd45293116721-2"><span class="crayon-e">def </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd45293116721-3"><span class="crayon-h">	</span><span class="crayon-p"># extract just the total power from each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd45293116721-4"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">week</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">week </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd45293116721-5"><span class="crayon-h">	</span><span class="crayon-p"># flatten into a single series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd45293116721-6"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd45293116721-7"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Next, the sequence of daily power needs to be transformed into inputs and outputs suitable for fitting a supervised learning problem.</p>
<p>The prediction will be some function of the total power consumed on prior days. We can choose the number of prior days to use as inputs, such as one or two weeks. There will always be a single output: the total power consumed on the next day.</p>
<p>The model will be fit on the true observations from prior time steps. We need to iterate through the sequence of daily power consumed and split it into inputs and outputs. This is called a sliding window data representation.</p>
<p>The <em>to_supervised()</em> function below implements this behavior.</p>
<p>It takes a list of weekly data as input as well as the number of prior days to use as inputs for each sample that is created.</p>
<p>The first step is to convert the history into a single data series. The series is then enumerated, creating one input and output pair per time step. This framing of the problem will allow a model to learn to predict any day of the week given the observations of prior days. The function returns the inputs (X) and outputs (y) ready for training a model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd48260812007" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert history into inputs and outputs
def to_supervised(history, n_input):
	# convert history to a univariate series
	data = to_series(history)
	X, y = list(), list()
	ix_start = 0
	# step over the entire history one time step at a time
	for i in range(len(data)):
		# define the end of the input sequence
		ix_end = ix_start + n_input
		# ensure we have enough data for this instance
		if ix_end &lt; len(data):
			X.append(data[ix_start:ix_end])
			y.append(data[ix_end])
		# move along one time step
		ix_start += 1
	return array(X), array(y)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd48260812007-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd48260812007-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-3"><span class="crayon-h">	</span><span class="crayon-p"># convert history to a univariate series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-5"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-6"><span class="crayon-h">	</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-7"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-8"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-9"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-10"><span class="crayon-h">		</span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-11"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-12"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-13"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_start</span><span class="crayon-o">:</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-14"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-15"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd48260812007-16"><span class="crayon-h">		</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf158dd48260812007-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The scikit-learn library allows a model to be used as part of a pipeline. This allows data transforms to be applied automatically prior to fitting the model. More importantly, the transforms are prepared in the correct way, where they are prepared or fit on the training data and applied on the test data. This prevents data leakage when evaluating models.</p>
<p>We can use this capability when in evaluating models by creating a pipeline prior to fitting each model on the training dataset. We will both standardize and normalize the data prior to using the model.</p>
<p>The <em>make_pipeline()</em> function below implements this behavior, returning a Pipeline that can be used just like a model, e.g. it can be fit and it can make predictions.</p>
<p>The standardization and normalization operations are performed per column. In the <em>to_supervised()</em> function, we have essentially split one column of data (total power) into multiple columns, e.g. seven for seven days of input observations. This means that each of the seven columns in the input data will have a different mean and standard deviation for standardization and a different min and max for normalization.</p>
<p>Given that we used a sliding window, almost all values will appear in each column, therefore, this is not likely an issue. But it is important to note that it would be more rigorous to scale the data as a single column prior to splitting it into inputs and outputs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd4c704232354" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# create a feature preparation pipeline for a model
def make_pipeline(model):
	steps = list()
	# standardization
	steps.append(('standardize', StandardScaler()))
	# normalization
	steps.append(('normalize', MinMaxScaler()))
	# the model
	steps.append(('model', model))
	# create pipeline
	pipeline = Pipeline(steps=steps)
	return pipeline</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4c704232354-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4c704232354-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-1"><span class="crayon-p"># create a feature preparation pipeline for a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-2"><span class="crayon-e">def </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-3"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-4"><span class="crayon-h">	</span><span class="crayon-p"># standardization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-5"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'standardize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">StandardScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-6"><span class="crayon-h">	</span><span class="crayon-p"># normalization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-7"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'normalize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-8"><span class="crayon-h">	</span><span class="crayon-p"># the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-9"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'model'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-10"><span class="crayon-h">	</span><span class="crayon-p"># create pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4c704232354-11"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">steps</span><span class="crayon-o">=</span><span class="crayon-v">steps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4c704232354-12"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We can tie these elements together into a function called <em>sklearn_predict()</em>, listed below.</p>
<p>The function takes a scikit-learn model object, the training data, called history, and a specified number of prior days to use as inputs. It transforms the training data into inputs and outputs, wraps the model in a pipeline, fits it, and uses it to make a prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd4e788104007" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fit a model and make a forecast
def sklearn_predict(model, history, n_input):
	# prepare data
	train_x, train_y = to_supervised(history, n_input)
	# make pipeline
	pipeline = make_pipeline(model)
	# fit the model
	pipeline.fit(train_x, train_y)
	# predict the week, recursively
	yhat_sequence = forecast(pipeline, train_x[-1, :], n_input)
	return yhat_sequence</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4e788104007-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4e788104007-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4e788104007-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4e788104007-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd4e788104007-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd4e788104007-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-1"><span class="crayon-p"># fit a model and make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4e788104007-2"><span class="crayon-e">def </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4e788104007-4"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-5"><span class="crayon-h">	</span><span class="crayon-p"># make pipeline</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4e788104007-6"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-7"><span class="crayon-h">	</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4e788104007-8"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-9"><span class="crayon-h">	</span><span class="crayon-p"># predict the week, recursively</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd4e788104007-10"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">pipeline</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd4e788104007-11"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The model will use the last row from the training dataset as input in order to make the prediction.</p>
<p>The <em>forecast()</em> function will use the model to make a recursive multi-step forecast.</p>
<p>The recursive forecast involves iterating over each of the seven days required of the multi-step forecast.</p>
<p>The input data to the model is taken as the last few observations of the <em>input_data</em> list. This list is seeded with all of the observations from the last row of the training data, and as we make predictions with the model, they are added to the end of this list. Therefore, we can take the last <em>n_input</em> observations from this list in order to achieve the effect of providing prior outputs as inputs.</p>
<p>The model is used to make a prediction for the prepared input data and the output is added both to the list for the actual output sequence that we will return and the list of input data from which we will draw observations as input for the model on the next iteration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd52084541670" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# make a recursive multi-step forecast
def forecast(model, input_x, n_input):
	yhat_sequence = list()
	input_data = [x for x in input_x]
	for j in range(7):
		# prepare the input data
		X = array(input_data[-n_input:]).reshape(1, n_input)
		# make a one-step forecast
		yhat = model.predict(X)[0]
		# add to the result
		yhat_sequence.append(yhat)
		# add the prediction to the input
		input_data.append(yhat)
	return yhat_sequence</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd52084541670-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd52084541670-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-1"><span class="crayon-p"># make a recursive multi-step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-3"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-4"><span class="crayon-h">	</span><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-6"><span class="crayon-h">		</span><span class="crayon-p"># prepare the input data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-7"><span class="crayon-h">		</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">input_data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-8"><span class="crayon-h">		</span><span class="crayon-p"># make a one-step forecast</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-9"><span class="crayon-h">		</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-10"><span class="crayon-h">		</span><span class="crayon-p"># add to the result</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-11"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-12"><span class="crayon-h">		</span><span class="crayon-p"># add the prediction to the input</span></div><div class="crayon-line" id="crayon-5bd2bf158dd52084541670-13"><span class="crayon-h">		</span><span class="crayon-v">input_data</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd52084541670-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We now have all of the elements to fit and evaluate scikit-learn models using a recursive multi-step forecasting strategy.</p>
<p>We can update the <em>evaluate_model()</em> function defined in the previous section to call the <em>sklearn_predict()</em> function. The updated function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd54523057103" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# evaluate a single model
def evaluate_model(model, train, test, n_input):
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = sklearn_predict(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	predictions = array(predictions)
	# evaluate predictions days for each week
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd54523057103-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd54523057103-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-1"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-3"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-4"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-5"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-6"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-7"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-8"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-9"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-10"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-11"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-12"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-13"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-14"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-15"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd54523057103-16"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd54523057103-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>An important final function is the <em>get_models()</em> that defines a dictionary of scikit-learn model objects mapped to a shorthand name we can use for reporting.</p>
<p>We will start-off by evaluating a suite of linear algorithms. We would expect that these would perform similar to an autoregression model (e.g. AR(7) if seven days of inputs were used).</p>
<p>The <em>get_models()</em> function with ten linear models is defined below.</p>
<p>This is a spot check where we are interested in the general performance of a diverse range of algorithms rather than optimizing any given algorithm.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd57942049042" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['lars'] = Lars()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['ranscac'] = RANSACRegressor()
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd57942049042-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd57942049042-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-1"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-2"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-3"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-4"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-5"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-6"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-7"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-8"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-9"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-10"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-11"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-12"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ranscac'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RANSACRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-13"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd57942049042-14"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd57942049042-15"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Finally, we can tie all of this together.</p>
<p>First, the dataset is loaded and split into train and test sets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd5f834292699" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd5f834292699-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd5f834292699-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd5f834292699-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd5f834292699-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd5f834292699-1"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd5f834292699-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd5f834292699-3"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd5f834292699-4"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can then prepare the dictionary of models and define the number of prior days of observations to use as inputs to the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd62018576765" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# prepare the models to evaluate
models = get_models()
n_input = 7</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd62018576765-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd62018576765-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd62018576765-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd62018576765-1"><span class="crayon-p"># prepare the models to evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd62018576765-2"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd62018576765-3"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The models in the dictionary are then enumerated, evaluating each, summarizing their scores, and adding the results to a line plot.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd64558115576" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# recursive multi-step forecast with linear algorithms
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from sklearn.preprocessing import StandardScaler
from sklearn.preprocessing import MinMaxScaler
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.linear_model import Lasso
from sklearn.linear_model import Ridge
from sklearn.linear_model import ElasticNet
from sklearn.linear_model import HuberRegressor
from sklearn.linear_model import Lars
from sklearn.linear_model import LassoLars
from sklearn.linear_model import PassiveAggressiveRegressor
from sklearn.linear_model import RANSACRegressor
from sklearn.linear_model import SGDRegressor

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['lars'] = Lars()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['ranscac'] = RANSACRegressor()
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models

# create a feature preparation pipeline for a model
def make_pipeline(model):
	steps = list()
	# standardization
	steps.append(('standardize', StandardScaler()))
	# normalization
	steps.append(('normalize', MinMaxScaler()))
	# the model
	steps.append(('model', model))
	# create pipeline
	pipeline = Pipeline(steps=steps)
	return pipeline

# make a recursive multi-step forecast
def forecast(model, input_x, n_input):
	yhat_sequence = list()
	input_data = [x for x in input_x]
	for j in range(7):
		# prepare the input data
		X = array(input_data[-n_input:]).reshape(1, n_input)
		# make a one-step forecast
		yhat = model.predict(X)[0]
		# add to the result
		yhat_sequence.append(yhat)
		# add the prediction to the input
		input_data.append(yhat)
	return yhat_sequence

# convert windows of weekly multivariate data into a series of total power
def to_series(data):
	# extract just the total power from each week
	series = [week[:, 0] for week in data]
	# flatten into a single series
	series = array(series).flatten()
	return series

# convert history into inputs and outputs
def to_supervised(history, n_input):
	# convert history to a univariate series
	data = to_series(history)
	X, y = list(), list()
	ix_start = 0
	# step over the entire history one time step at a time
	for i in range(len(data)):
		# define the end of the input sequence
		ix_end = ix_start + n_input
		# ensure we have enough data for this instance
		if ix_end &lt; len(data):
			X.append(data[ix_start:ix_end])
			y.append(data[ix_end])
		# move along one time step
		ix_start += 1
	return array(X), array(y)

# fit a model and make a forecast
def sklearn_predict(model, history, n_input):
	# prepare data
	train_x, train_y = to_supervised(history, n_input)
	# make pipeline
	pipeline = make_pipeline(model)
	# fit the model
	pipeline.fit(train_x, train_y)
	# predict the week, recursively
	yhat_sequence = forecast(pipeline, train_x[-1, :], n_input)
	return yhat_sequence

# evaluate a single model
def evaluate_model(model, train, test, n_input):
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = sklearn_predict(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	predictions = array(predictions)
	# evaluate predictions days for each week
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# prepare the models to evaluate
models = get_models()
n_input = 7
# evaluate each model
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
for name, model in models.items():
	# evaluate and get scores
	score, scores = evaluate_model(model, train, test, n_input)
	# summarize scores
	summarize_scores(name, score, scores)
	# plot scores
	pyplot.plot(days, scores, marker='o', label=name)
# show plot
pyplot.legend()
pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-146">146</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-148">148</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-150">150</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-152">152</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-154">154</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-156">156</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-158">158</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-160">160</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-162">162</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-164">164</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-166">166</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-168">168</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-170">170</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd64558115576-172">172</div><div class="crayon-num" data-line="crayon-5bd2bf158dd64558115576-173">173</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-1"><span class="crayon-p"># recursive multi-step forecast with linear algorithms</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">StandardScaler</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">pipeline </span><span class="crayon-e">import </span><span class="crayon-e">Pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-11"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LinearRegression</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-12"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lasso</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-13"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Ridge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-14"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">ElasticNet</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-15"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">HuberRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-16"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lars</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-17"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LassoLars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-18"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">PassiveAggressiveRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-19"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">RANSACRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-20"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-v">SGDRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-22"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-23"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-24"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-25"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-26"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-27"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-28"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-29"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-30">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-31"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-32"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-33"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-34"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-35"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-36"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-37"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-38"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-39"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-40"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-41"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-42"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-43"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-44"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-45"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-46"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-47"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-48"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-50"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-51"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-52"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-53"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-54">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-55"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-56"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-57"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-58"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-59"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-60"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-61"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-62"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-63"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-64"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-65"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-66"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ranscac'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RANSACRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-67"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-68"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-69"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-70">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-71"><span class="crayon-p"># create a feature preparation pipeline for a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-72"><span class="crayon-e">def </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-73"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-74"><span class="crayon-h">	</span><span class="crayon-p"># standardization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-75"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'standardize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">StandardScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-76"><span class="crayon-h">	</span><span class="crayon-p"># normalization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-77"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'normalize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-78"><span class="crayon-h">	</span><span class="crayon-p"># the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-79"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'model'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-80"><span class="crayon-h">	</span><span class="crayon-p"># create pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-81"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">steps</span><span class="crayon-o">=</span><span class="crayon-v">steps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-82"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-84"><span class="crayon-p"># make a recursive multi-step forecast</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-85"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-86"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-87"><span class="crayon-h">	</span><span class="crayon-v">input_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-88"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-89"><span class="crayon-h">		</span><span class="crayon-p"># prepare the input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-90"><span class="crayon-h">		</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">input_data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-91"><span class="crayon-h">		</span><span class="crayon-p"># make a one-step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-92"><span class="crayon-h">		</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-93"><span class="crayon-h">		</span><span class="crayon-p"># add to the result</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-94"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-95"><span class="crayon-h">		</span><span class="crayon-p"># add the prediction to the input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-96"><span class="crayon-h">		</span><span class="crayon-v">input_data</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-97"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-98">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-99"><span class="crayon-p"># convert windows of weekly multivariate data into a series of total power</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-100"><span class="crayon-e">def </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-101"><span class="crayon-h">	</span><span class="crayon-p"># extract just the total power from each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-102"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">week</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">week </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-103"><span class="crayon-h">	</span><span class="crayon-p"># flatten into a single series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-104"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-105"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-106">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-107"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-108"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-109"><span class="crayon-h">	</span><span class="crayon-p"># convert history to a univariate series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-110"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-111"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-112"><span class="crayon-h">	</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-113"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-114"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-115"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-116"><span class="crayon-h">		</span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-117"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-118"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-119"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_start</span><span class="crayon-o">:</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-120"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-121"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-122"><span class="crayon-h">		</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-123"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-124">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-125"><span class="crayon-p"># fit a model and make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-126"><span class="crayon-e">def </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-127"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-128"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-129"><span class="crayon-h">	</span><span class="crayon-p"># make pipeline</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-130"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-131"><span class="crayon-h">	</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-132"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-133"><span class="crayon-h">	</span><span class="crayon-p"># predict the week, recursively</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-134"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">pipeline</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-135"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-136">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-137"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-138"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-139"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-140"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-141"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-142"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-143"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-144"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-145"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-146"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-147"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-148"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-149"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-150"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-151"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-152"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-153"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-154">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-155"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-156"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-157"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-158"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-159"><span class="crayon-p"># prepare the models to evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-160"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-161"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-162"><span class="crayon-p"># evaluate each model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-163"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-164"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-165"><span class="crayon-h">	</span><span class="crayon-p"># evaluate and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-166"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-167"><span class="crayon-h">	</span><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-168"><span class="crayon-h">	</span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-169"><span class="crayon-h">	</span><span class="crayon-p"># plot scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-170"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-171"><span class="crayon-p"># show plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd64558115576-172"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd64558115576-173"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0138 seconds] -->
<p>Running the example evaluates the ten linear algorithms and summarizes the results.</p>
<p>As each of the algorithms is evaluated and the performance is reported with a one-line summary, including the overall RMSE as well as the per-time step RMSE.</p>
<p>We can see that most of the evaluated models performed well, below 400 kilowatts in error over the whole week, with perhaps the Stochastic Gradient Descent (SGD) regressor performing the best with an overall RMSE of about 383.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd6b396908426" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Defined 10 models
lr: [388.388] 411.0, 389.1, 338.0, 370.8, 408.5, 308.3, 471.1
lasso: [386.838] 403.6, 388.9, 337.3, 371.1, 406.1, 307.6, 471.6
ridge: [387.659] 407.9, 388.6, 337.5, 371.2, 407.0, 307.7, 471.7
en: [469.337] 452.2, 451.9, 435.8, 485.7, 460.4, 405.8, 575.1
huber: [392.465] 412.1, 388.0, 337.9, 377.3, 405.6, 306.9, 492.5
lars: [388.388] 411.0, 389.1, 338.0, 370.8, 408.5, 308.3, 471.1
llars: [388.406] 396.1, 387.8, 339.3, 377.8, 402.9, 310.3, 481.9
pa: [399.402] 410.0, 391.7, 342.2, 389.7, 409.8, 315.9, 508.4
ranscac: [439.945] 454.0, 424.0, 369.5, 421.5, 457.5, 409.7, 526.9
sgd: [383.177] 400.3, 386.0, 333.0, 368.9, 401.5, 303.9, 466.9</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd6b396908426-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd6b396908426-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd6b396908426-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd6b396908426-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd6b396908426-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd6b396908426-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-1">Defined 10 models</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd6b396908426-2">lr: [388.388] 411.0, 389.1, 338.0, 370.8, 408.5, 308.3, 471.1</div><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-3">lasso: [386.838] 403.6, 388.9, 337.3, 371.1, 406.1, 307.6, 471.6</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd6b396908426-4">ridge: [387.659] 407.9, 388.6, 337.5, 371.2, 407.0, 307.7, 471.7</div><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-5">en: [469.337] 452.2, 451.9, 435.8, 485.7, 460.4, 405.8, 575.1</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd6b396908426-6">huber: [392.465] 412.1, 388.0, 337.9, 377.3, 405.6, 306.9, 492.5</div><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-7">lars: [388.388] 411.0, 389.1, 338.0, 370.8, 408.5, 308.3, 471.1</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd6b396908426-8">llars: [388.406] 396.1, 387.8, 339.3, 377.8, 402.9, 310.3, 481.9</div><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-9">pa: [399.402] 410.0, 391.7, 342.2, 389.7, 409.8, 315.9, 508.4</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd6b396908426-10">ranscac: [439.945] 454.0, 424.0, 369.5, 421.5, 457.5, 409.7, 526.9</div><div class="crayon-line" id="crayon-5bd2bf158dd6b396908426-11">sgd: [383.177] 400.3, 386.0, 333.0, 368.9, 401.5, 303.9, 466.9</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the daily RMSE for each of the 10 classifiers is also created.</p>
<p>We can see that all but two of the methods cluster together with equally well performing results across the seven day forecasts.</p>
<div id="attachment_6273" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6273" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Recursive-Multi-step-Forecasts-With-Linear-Algorithms.png" alt="Line Plot of Recursive Multi-step Forecasts With Linear Algorithms" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Recursive-Multi-step-Forecasts-With-Linear-Algorithms.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Recursive-Multi-step-Forecasts-With-Linear-Algorithms-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Recursive-Multi-step-Forecasts-With-Linear-Algorithms-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Recursive-Multi-step-Forecasts-With-Linear-Algorithms-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">Line Plot of Recursive Multi-step Forecasts With Linear Algorithms</p></div>
<p>Better results may be achieved by tuning the hyperparameters of some of the better performing algorithms. Further, it may be interesting to update the example to test a suite of nonlinear and ensemble algorithms.</p>
<p>An interesting experiment may be to evaluate the performance of one or a few of the better performing algorithms with more or fewer prior days as input.</p>
<h2>Direct Multi-Step Forecasting</h2>
<p>An alternate to the recursive strategy for multi-step forecasting is to use a different model for each of the days to be forecasted.</p>
<p>This is called a direct multi-step forecasting strategy.</p>
<p>Because we are interested in forecasting seven days, this would require preparing seven different models, each specialized for forecasting a different day.</p>
<p>There are two approaches to training such a model:</p>
<ul>
<li><strong>Predict Day</strong>. Models can be prepared to predict a specific day of the standard week, e.g. Monday.</li>
<li><strong>Predict Lead Time</strong>. Models can be prepared to predict a specific lead time, e.g. day 1.</li>
</ul>
<p>Predicting a day will be more specific, but will mean that less of the training data can be used for each model. Predicting a lead time makes use of more of the training data, but requires the model to generalize across the different days of the week.</p>
<p>We will explore both approaches in this section.</p>
<h3>Direct Day Approach</h3>
<p>First, we must update the <em>to_supervised()</em> function to prepare the data, such as the prior week of observations, used as input and an observation from a specific day in the following week used as the output.</p>
<p>The updated <em>to_supervised()</em> function that implements this behavior is listed below. It takes an argument <em>output_ix</em> that defines the day [0,6] in the following week to use as the output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd71339884206" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert history into inputs and outputs
def to_supervised(history, output_ix):
	X, y = list(), list()
	# step over the entire history one time step at a time
	for i in range(len(history)-1):
		X.append(history[i][:,0])
		y.append(history[i + 1][output_ix,0])
	return array(X), array(y)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd71339884206-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd71339884206-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd71339884206-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd71339884206-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd71339884206-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd71339884206-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd71339884206-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd71339884206-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd71339884206-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd71339884206-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd71339884206-3"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd71339884206-4"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5bd2bf158dd71339884206-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd71339884206-6"><span class="crayon-h">		</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd71339884206-7"><span class="crayon-h">		</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">output_ix</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd71339884206-8"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>This function can be called seven times, once for each of the seven models required.</p>
<p>Next, we can update the <em>sklearn_predict()</em> function to create a new dataset and a new model for each day in the one-week forecast.</p>
<p>The body of the function is mostly unchanged, only it is used within a loop over each day in the output sequence, where the index of the day &#8220;<em>i</em>&#8221; is passed to the call to <em>to_supervised()</em> in order to prepare a specific dataset for training a model to predict that day.</p>
<p>The function no longer takes an <em>n_input</em> argument, as we have fixed the input to be the seven days of the prior week.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd74873897435" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# fit a model and make a forecast
def sklearn_predict(model, history):
	yhat_sequence = list()
	# fit a model for each forecast day
	for i in range(7):
		# prepare data
		train_x, train_y = to_supervised(history, i)
		# make pipeline
		pipeline = make_pipeline(model)
		# fit the model
		pipeline.fit(train_x, train_y)
		# forecast
		x_input = array(train_x[-1, :]).reshape(1,7)
		yhat = pipeline.predict(x_input)[0]
		# store
		yhat_sequence.append(yhat)
	return yhat_sequence</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd74873897435-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd74873897435-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-1"><span class="crayon-p"># fit a model and make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-2"><span class="crayon-e">def </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-3"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-4"><span class="crayon-h">	</span><span class="crayon-p"># fit a model for each forecast day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-6"><span class="crayon-h">		</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-7"><span class="crayon-h">		</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-8"><span class="crayon-h">		</span><span class="crayon-p"># make pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-9"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-10"><span class="crayon-h">		</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-11"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-12"><span class="crayon-h">		</span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-13"><span class="crayon-h">		</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-14"><span class="crayon-h">		</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-15"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd74873897435-16"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd74873897435-17"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd78228817835" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# direct multi-step forecast by day
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from sklearn.preprocessing import StandardScaler
from sklearn.preprocessing import MinMaxScaler
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.linear_model import Lasso
from sklearn.linear_model import Ridge
from sklearn.linear_model import ElasticNet
from sklearn.linear_model import HuberRegressor
from sklearn.linear_model import Lars
from sklearn.linear_model import LassoLars
from sklearn.linear_model import PassiveAggressiveRegressor
from sklearn.linear_model import RANSACRegressor
from sklearn.linear_model import SGDRegressor

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['lars'] = Lars()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['ranscac'] = RANSACRegressor()
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models

# create a feature preparation pipeline for a model
def make_pipeline(model):
	steps = list()
	# standardization
	steps.append(('standardize', StandardScaler()))
	# normalization
	steps.append(('normalize', MinMaxScaler()))
	# the model
	steps.append(('model', model))
	# create pipeline
	pipeline = Pipeline(steps=steps)
	return pipeline

# convert history into inputs and outputs
def to_supervised(history, output_ix):
	X, y = list(), list()
	# step over the entire history one time step at a time
	for i in range(len(history)-1):
		X.append(history[i][:,0])
		y.append(history[i + 1][output_ix,0])
	return array(X), array(y)

# fit a model and make a forecast
def sklearn_predict(model, history):
	yhat_sequence = list()
	# fit a model for each forecast day
	for i in range(7):
		# prepare data
		train_x, train_y = to_supervised(history, i)
		# make pipeline
		pipeline = make_pipeline(model)
		# fit the model
		pipeline.fit(train_x, train_y)
		# forecast
		x_input = array(train_x[-1, :]).reshape(1,7)
		yhat = pipeline.predict(x_input)[0]
		# store
		yhat_sequence.append(yhat)
	return yhat_sequence

# evaluate a single model
def evaluate_model(model, train, test):
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = sklearn_predict(model, history)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	predictions = array(predictions)
	# evaluate predictions days for each week
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# prepare the models to evaluate
models = get_models()
# evaluate each model
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
for name, model in models.items():
	# evaluate and get scores
	score, scores = evaluate_model(model, train, test)
	# summarize scores
	summarize_scores(name, score, scores)
	# plot scores
	pyplot.plot(days, scores, marker='o', label=name)
# show plot
pyplot.legend()
pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf158dd78228817835-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd78228817835-146">146</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-1"><span class="crayon-p"># direct multi-step forecast by day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">StandardScaler</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">pipeline </span><span class="crayon-e">import </span><span class="crayon-e">Pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-11"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LinearRegression</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-12"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lasso</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-13"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Ridge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-14"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">ElasticNet</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-15"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">HuberRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-16"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lars</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-17"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LassoLars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-18"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">PassiveAggressiveRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-19"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">RANSACRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-20"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-v">SGDRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-22"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-23"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-24"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-25"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-26"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-27"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-28"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-29"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-30">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-31"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-32"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-33"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-34"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-35"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-36"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-37"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-38"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-39"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-40"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-41"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-42"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-43"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-44"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-45"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-46"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-47"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-48"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-50"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-51"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-52"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-53"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-54">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-55"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-56"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-57"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-58"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-59"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-60"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-61"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-62"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-63"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-64"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-65"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-66"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ranscac'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RANSACRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-67"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-68"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-69"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-70">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-71"><span class="crayon-p"># create a feature preparation pipeline for a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-72"><span class="crayon-e">def </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-73"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-74"><span class="crayon-h">	</span><span class="crayon-p"># standardization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-75"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'standardize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">StandardScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-76"><span class="crayon-h">	</span><span class="crayon-p"># normalization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-77"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'normalize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-78"><span class="crayon-h">	</span><span class="crayon-p"># the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-79"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'model'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-80"><span class="crayon-h">	</span><span class="crayon-p"># create pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-81"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">steps</span><span class="crayon-o">=</span><span class="crayon-v">steps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-82"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-84"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-85"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-86"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-87"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-88"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-89"><span class="crayon-h">		</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-90"><span class="crayon-h">		</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">output_ix</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-91"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-92">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-93"><span class="crayon-p"># fit a model and make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-94"><span class="crayon-e">def </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-95"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-96"><span class="crayon-h">	</span><span class="crayon-p"># fit a model for each forecast day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-97"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-98"><span class="crayon-h">		</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-99"><span class="crayon-h">		</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-100"><span class="crayon-h">		</span><span class="crayon-p"># make pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-101"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-102"><span class="crayon-h">		</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-103"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-104"><span class="crayon-h">		</span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-105"><span class="crayon-h">		</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-106"><span class="crayon-h">		</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-107"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-108"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-109"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-110">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-111"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-112"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-113"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-114"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-115"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-116"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-117"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-118"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-119"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-120"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-121"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-122"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-123"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-124"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-125"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-126"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-127"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-128">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-129"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-130"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-131"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-132"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-133"><span class="crayon-p"># prepare the models to evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-134"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-135"><span class="crayon-p"># evaluate each model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-136"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-137"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-138"><span class="crayon-h">	</span><span class="crayon-p"># evaluate and get scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-139"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-140"><span class="crayon-h">	</span><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-141"><span class="crayon-h">	</span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-142"><span class="crayon-h">	</span><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-143"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-144"><span class="crayon-p"># show plot</span></div><div class="crayon-line" id="crayon-5bd2bf158dd78228817835-145"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd78228817835-146"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0098 seconds] -->
<p>Running the example first summarizes the performance of each model.</p>
<p>We can see that the performance is slightly worse than the recursive model on this problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd7e583778758" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Defined 10 models
lr: [410.927] 463.8, 381.4, 351.9, 430.7, 387.8, 350.4, 488.8
lasso: [408.440] 458.4, 378.5, 352.9, 429.5, 388.0, 348.0, 483.5
ridge: [403.875] 447.1, 377.9, 347.5, 427.4, 384.1, 343.4, 479.7
en: [454.263] 471.8, 433.8, 415.8, 477.4, 434.4, 373.8, 551.8
huber: [409.500] 466.8, 380.2, 359.8, 432.4, 387.0, 351.3, 470.9
lars: [410.927] 463.8, 381.4, 351.9, 430.7, 387.8, 350.4, 488.8
llars: [406.490] 453.0, 378.8, 357.3, 428.1, 388.0, 345.0, 476.9
pa: [402.476] 428.4, 380.9, 356.5, 426.7, 390.4, 348.6, 471.4
ranscac: [497.225] 456.1, 423.0, 445.9, 547.6, 521.9, 451.5, 607.2
sgd: [403.526] 441.4, 378.2, 354.5, 423.9, 382.4, 345.8, 480.3</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd7e583778758-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd7e583778758-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd7e583778758-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd7e583778758-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd7e583778758-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd7e583778758-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-1">Defined 10 models</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd7e583778758-2">lr: [410.927] 463.8, 381.4, 351.9, 430.7, 387.8, 350.4, 488.8</div><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-3">lasso: [408.440] 458.4, 378.5, 352.9, 429.5, 388.0, 348.0, 483.5</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd7e583778758-4">ridge: [403.875] 447.1, 377.9, 347.5, 427.4, 384.1, 343.4, 479.7</div><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-5">en: [454.263] 471.8, 433.8, 415.8, 477.4, 434.4, 373.8, 551.8</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd7e583778758-6">huber: [409.500] 466.8, 380.2, 359.8, 432.4, 387.0, 351.3, 470.9</div><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-7">lars: [410.927] 463.8, 381.4, 351.9, 430.7, 387.8, 350.4, 488.8</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd7e583778758-8">llars: [406.490] 453.0, 378.8, 357.3, 428.1, 388.0, 345.0, 476.9</div><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-9">pa: [402.476] 428.4, 380.9, 356.5, 426.7, 390.4, 348.6, 471.4</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd7e583778758-10">ranscac: [497.225] 456.1, 423.0, 445.9, 547.6, 521.9, 451.5, 607.2</div><div class="crayon-line" id="crayon-5bd2bf158dd7e583778758-11">sgd: [403.526] 441.4, 378.2, 354.5, 423.9, 382.4, 345.8, 480.3</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the per-day RMSE scores for each model is also created, showing a similar grouping of models as was seen with the recursive model.</p>
<div id="attachment_6274" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6274" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Day-Multi-step-Forecasts-With-Linear-Algorithms.png" alt="Line Plot of Direct Per-Day Multi-step Forecasts With Linear Algorithms" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Day-Multi-step-Forecasts-With-Linear-Algorithms.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Day-Multi-step-Forecasts-With-Linear-Algorithms-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Day-Multi-step-Forecasts-With-Linear-Algorithms-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Day-Multi-step-Forecasts-With-Linear-Algorithms-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">Line Plot of Direct Per-Day Multi-step Forecasts With Linear Algorithms</p></div>
<h3>Direct Lead Time Approach</h3>
<p>The direct lead time approach is the same, except that the <em>to_supervised()</em> makes use of more of the training dataset.</p>
<p>The function is the same as it was defined in the recursive model example, except it takes an additional <em>output_ix</em> argument to define the day in the following week to use as the output.</p>
<p>The updated <em>to_supervised()</em> function for the direct per-lead time strategy is listed below.</p>
<p>Unlike the per-day strategy, this version of the function does support variable sized inputs (not just seven days), allowing you to experiment if you like.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd83690783594" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# convert history into inputs and outputs
def to_supervised(history, n_input, output_ix):
	# convert history to a univariate series
	data = to_series(history)
	X, y = list(), list()
	ix_start = 0
	# step over the entire history one time step at a time
	for i in range(len(data)):
		# define the end of the input sequence
		ix_end = ix_start + n_input
		ix_output = ix_end + output_ix
		# ensure we have enough data for this instance
		if ix_output &lt; len(data):
			X.append(data[ix_start:ix_end])
			y.append(data[ix_output])
		# move along one time step
		ix_start += 1
	return array(X), array(y)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd83690783594-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd83690783594-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-3"><span class="crayon-h">	</span><span class="crayon-p"># convert history to a univariate series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-5"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-6"><span class="crayon-h">	</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-7"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-8"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-9"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-10"><span class="crayon-h">		</span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-11"><span class="crayon-e">		</span><span class="crayon-v">ix_output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-12"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-13"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ix_output</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-14"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_start</span><span class="crayon-o">:</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-15"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_output</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-16"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5bd2bf158dd83690783594-17"><span class="crayon-h">		</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd83690783594-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd87637560679" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# direct multi-step forecast by lead time
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from sklearn.preprocessing import StandardScaler
from sklearn.preprocessing import MinMaxScaler
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.linear_model import Lasso
from sklearn.linear_model import Ridge
from sklearn.linear_model import ElasticNet
from sklearn.linear_model import HuberRegressor
from sklearn.linear_model import Lars
from sklearn.linear_model import LassoLars
from sklearn.linear_model import PassiveAggressiveRegressor
from sklearn.linear_model import RANSACRegressor
from sklearn.linear_model import SGDRegressor

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# prepare a list of ml models
def get_models(models=dict()):
	# linear models
	models['lr'] = LinearRegression()
	models['lasso'] = Lasso()
	models['ridge'] = Ridge()
	models['en'] = ElasticNet()
	models['huber'] = HuberRegressor()
	models['lars'] = Lars()
	models['llars'] = LassoLars()
	models['pa'] = PassiveAggressiveRegressor(max_iter=1000, tol=1e-3)
	models['ranscac'] = RANSACRegressor()
	models['sgd'] = SGDRegressor(max_iter=1000, tol=1e-3)
	print('Defined %d models' % len(models))
	return models

# create a feature preparation pipeline for a model
def make_pipeline(model):
	steps = list()
	# standardization
	steps.append(('standardize', StandardScaler()))
	# normalization
	steps.append(('normalize', MinMaxScaler()))
	# the model
	steps.append(('model', model))
	# create pipeline
	pipeline = Pipeline(steps=steps)
	return pipeline

# # convert windows of weekly multivariate data into a series of total power
def to_series(data):
	# extract just the total power from each week
	series = [week[:, 0] for week in data]
	# flatten into a single series
	series = array(series).flatten()
	return series

# convert history into inputs and outputs
def to_supervised(history, n_input, output_ix):
	# convert history to a univariate series
	data = to_series(history)
	X, y = list(), list()
	ix_start = 0
	# step over the entire history one time step at a time
	for i in range(len(data)):
		# define the end of the input sequence
		ix_end = ix_start + n_input
		ix_output = ix_end + output_ix
		# ensure we have enough data for this instance
		if ix_output &lt; len(data):
			X.append(data[ix_start:ix_end])
			y.append(data[ix_output])
		# move along one time step
		ix_start += 1
	return array(X), array(y)

# fit a model and make a forecast
def sklearn_predict(model, history, n_input):
	yhat_sequence = list()
	# fit a model for each forecast day
	for i in range(7):
		# prepare data
		train_x, train_y = to_supervised(history, n_input, i)
		# make pipeline
		pipeline = make_pipeline(model)
		# fit the model
		pipeline.fit(train_x, train_y)
		# forecast
		x_input = array(train_x[-1, :]).reshape(1,n_input)
		yhat = pipeline.predict(x_input)[0]
		# store
		yhat_sequence.append(yhat)
	return yhat_sequence

# evaluate a single model
def evaluate_model(model, train, test, n_input):
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = sklearn_predict(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	predictions = array(predictions)
	# evaluate predictions days for each week
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, infer_datetime_format=True, parse_dates=['datetime'], index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# prepare the models to evaluate
models = get_models()
n_input = 7
# evaluate each model
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
for name, model in models.items():
	# evaluate and get scores
	score, scores = evaluate_model(model, train, test, n_input)
	# summarize scores
	summarize_scores(name, score, scores)
	# plot scores
	pyplot.plot(days, scores, marker='o', label=name)
# show plot
pyplot.legend()
pyplot.show()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-12">12</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-14">14</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-16">16</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-18">18</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-20">20</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-22">22</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-24">24</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-26">26</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-28">28</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-30">30</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-32">32</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-34">34</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-36">36</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-38">38</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-40">40</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-42">42</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-44">44</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-46">46</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-48">48</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-50">50</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-52">52</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-54">54</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-56">56</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-58">58</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-60">60</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-62">62</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-64">64</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-66">66</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-68">68</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-70">70</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-72">72</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-74">74</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-76">76</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-78">78</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-80">80</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-82">82</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-84">84</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-86">86</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-88">88</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-90">90</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-92">92</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-94">94</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-96">96</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-98">98</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-100">100</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-102">102</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-104">104</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-106">106</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-108">108</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-110">110</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-112">112</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-114">114</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-116">116</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-118">118</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-120">120</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-122">122</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-124">124</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-126">126</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-128">128</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-130">130</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-132">132</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-134">134</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-136">136</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-138">138</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-140">140</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-142">142</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-144">144</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-146">146</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-148">148</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-150">150</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-152">152</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-154">154</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-156">156</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-158">158</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-160">160</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-162">162</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd87637560679-164">164</div><div class="crayon-num" data-line="crayon-5bd2bf158dd87637560679-165">165</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-1"><span class="crayon-p"># direct multi-step forecast by lead time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">StandardScaler</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">pipeline </span><span class="crayon-e">import </span><span class="crayon-e">Pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-11"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LinearRegression</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-12"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lasso</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-13"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Ridge</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-14"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">ElasticNet</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-15"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">HuberRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-16"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">Lars</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-17"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">LassoLars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-18"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">PassiveAggressiveRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-19"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-e">RANSACRegressor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-20"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-e">import </span><span class="crayon-v">SGDRegressor</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-22"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-23"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-24"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-25"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-26"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-27"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-28"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-29"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-30">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-31"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-32"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-33"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-34"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-35"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-36"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-37"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-38"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-39"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-40"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-41"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-42"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-43"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-44"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-45"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-46"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-47"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-48"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-50"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-51"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-52"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-53"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-54">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-55"><span class="crayon-p"># prepare a list of ml models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-56"><span class="crayon-e">def </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-o">=</span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-57"><span class="crayon-h">	</span><span class="crayon-p"># linear models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-58"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lr'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-59"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lasso'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-60"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ridge'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-61"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'en'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-62"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'huber'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">HuberRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-63"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'lars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-64"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'llars'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LassoLars</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-65"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'pa'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">PassiveAggressiveRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-66"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'ranscac'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RANSACRegressor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-67"><span class="crayon-h">	</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-s">'sgd'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">max_iter</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-o">=</span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-68"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Defined %d models'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-69"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-70">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-71"><span class="crayon-p"># create a feature preparation pipeline for a model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-72"><span class="crayon-e">def </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-73"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-74"><span class="crayon-h">	</span><span class="crayon-p"># standardization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-75"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'standardize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">StandardScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-76"><span class="crayon-h">	</span><span class="crayon-p"># normalization</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-77"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'normalize'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-78"><span class="crayon-h">	</span><span class="crayon-p"># the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-79"><span class="crayon-h">	</span><span class="crayon-v">steps</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'model'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-80"><span class="crayon-h">	</span><span class="crayon-p"># create pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-81"><span class="crayon-h">	</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">steps</span><span class="crayon-o">=</span><span class="crayon-v">steps</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-82"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-84"><span class="crayon-p"># # convert windows of weekly multivariate data into a series of total power</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-85"><span class="crayon-e">def </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-86"><span class="crayon-h">	</span><span class="crayon-p"># extract just the total power from each week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-87"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">week</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">week </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-88"><span class="crayon-h">	</span><span class="crayon-p"># flatten into a single series</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-89"><span class="crayon-h">	</span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-90"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">series</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-91">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-92"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-93"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-94"><span class="crayon-h">	</span><span class="crayon-p"># convert history to a univariate series</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-95"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_series</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-96"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-97"><span class="crayon-h">	</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-98"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-99"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-100"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-101"><span class="crayon-h">		</span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-102"><span class="crayon-e">		</span><span class="crayon-v">ix_output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ix_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">output_ix</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-103"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-104"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ix_output</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-105"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_start</span><span class="crayon-o">:</span><span class="crayon-v">ix_end</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-106"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">ix_output</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-107"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-108"><span class="crayon-h">		</span><span class="crayon-v">ix_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-109"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-110">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-111"><span class="crayon-p"># fit a model and make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-112"><span class="crayon-e">def </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-113"><span class="crayon-h">	</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-114"><span class="crayon-h">	</span><span class="crayon-p"># fit a model for each forecast day</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-115"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-116"><span class="crayon-h">		</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-117"><span class="crayon-h">		</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-118"><span class="crayon-h">		</span><span class="crayon-p"># make pipeline</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-119"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_pipeline</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-120"><span class="crayon-h">		</span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-121"><span class="crayon-h">		</span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-122"><span class="crayon-h">		</span><span class="crayon-p"># forecast</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-123"><span class="crayon-h">		</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-124"><span class="crayon-h">		</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pipeline</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-125"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-126"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-127"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat_sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-128">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-129"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-130"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-131"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-132"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-133"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-134"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-135"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-136"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-137"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sklearn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-138"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-139"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-140"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-141"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-142"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-143"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-144"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-145"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-146">&nbsp;</div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-147"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-148"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-149"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-150"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-151"><span class="crayon-p"># prepare the models to evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-152"><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_models</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-153"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-154"><span class="crayon-p"># evaluate each model</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-155"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-156"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">model </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-157"><span class="crayon-h">	</span><span class="crayon-p"># evaluate and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-158"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-159"><span class="crayon-h">	</span><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-160"><span class="crayon-h">	</span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-161"><span class="crayon-h">	</span><span class="crayon-p"># plot scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-162"><span class="crayon-h">	</span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-v">name</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-163"><span class="crayon-p"># show plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd87637560679-164"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5bd2bf158dd87637560679-165"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0108 seconds] -->
<p>Running the example summarizes the overall and per-day RMSE for each of the evaluated linear models.</p>
<p>We can see that generally the per-lead time approach resulted in better performance than the per-day version. This is likely because the approach made more of the training data available to the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5bd2bf158dd8e750767536" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Defined 10 models
lr: [394.983] 411.0, 400.7, 340.2, 382.9, 385.1, 362.8, 469.4
lasso: [391.767] 403.6, 394.4, 336.1, 382.7, 384.2, 360.4, 468.1
ridge: [393.444] 407.9, 397.8, 338.9, 383.2, 383.2, 360.4, 469.6
en: [461.986] 452.2, 448.3, 430.3, 480.4, 448.9, 396.0, 560.6
huber: [394.287] 412.1, 394.0, 333.4, 384.1, 383.1, 364.3, 474.4
lars: [394.983] 411.0, 400.7, 340.2, 382.9, 385.1, 362.8, 469.4
llars: [390.075] 396.1, 390.1, 334.3, 384.4, 385.2, 355.6, 470.9
pa: [389.340] 409.7, 380.6, 328.3, 388.6, 370.1, 351.8, 478.4
ranscac: [439.298] 387.2, 462.4, 394.4, 427.7, 412.9, 447.9, 526.8
sgd: [390.184] 396.7, 386.7, 337.6, 391.4, 374.0, 357.1, 473.5</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd8e750767536-2">2</div><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd8e750767536-4">4</div><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd8e750767536-6">6</div><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd8e750767536-8">8</div><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5bd2bf158dd8e750767536-10">10</div><div class="crayon-num" data-line="crayon-5bd2bf158dd8e750767536-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-1">Defined 10 models</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd8e750767536-2">lr: [394.983] 411.0, 400.7, 340.2, 382.9, 385.1, 362.8, 469.4</div><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-3">lasso: [391.767] 403.6, 394.4, 336.1, 382.7, 384.2, 360.4, 468.1</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd8e750767536-4">ridge: [393.444] 407.9, 397.8, 338.9, 383.2, 383.2, 360.4, 469.6</div><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-5">en: [461.986] 452.2, 448.3, 430.3, 480.4, 448.9, 396.0, 560.6</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd8e750767536-6">huber: [394.287] 412.1, 394.0, 333.4, 384.1, 383.1, 364.3, 474.4</div><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-7">lars: [394.983] 411.0, 400.7, 340.2, 382.9, 385.1, 362.8, 469.4</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd8e750767536-8">llars: [390.075] 396.1, 390.1, 334.3, 384.4, 385.2, 355.6, 470.9</div><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-9">pa: [389.340] 409.7, 380.6, 328.3, 388.6, 370.1, 351.8, 478.4</div><div class="crayon-line crayon-striped-line" id="crayon-5bd2bf158dd8e750767536-10">ranscac: [439.298] 387.2, 462.4, 394.4, 427.7, 412.9, 447.9, 526.8</div><div class="crayon-line" id="crayon-5bd2bf158dd8e750767536-11">sgd: [390.184] 396.7, 386.7, 337.6, 391.4, 374.0, 357.1, 473.5</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>A line plot of the per-day RMSE scores was again created.</p>
<div id="attachment_6275" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6275" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms.png" alt="Line Plot of Direct Per-Lead Time Multi-step Forecasts With Linear Algorithms" width="1280" height="960" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-Direct-Per-Lead-Time-Multi-step-Forecasts-With-Linear-Algorithms-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" /><p class="wp-caption-text">Line Plot of Direct Per-Lead Time Multi-step Forecasts With Linear Algorithms</p></div>
<p>It may be interesting to explore a blending of the per-day and per-time step approaches to modeling the problem.</p>
<p>It may also be interesting to see if increasing the number of prior days used as input for the per-lead time improves performance, e.g. using two weeks of data instead of one week.</p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Tune Models</strong>. Select one well-performing model and tune the model hyperparameters in order to further improve performance.</li>
<li><strong>Tune Data Preparation</strong>. All data was standardized and normalized prior to fitting each model; explore whether these methods are necessary and whether more or different combinations of data scaling methods can result in better performance.</li>
<li><strong>Explore Input Size</strong>. The input size was limited to seven days of prior observations; explore more and fewer days of observations as input and their impact on model performance.</li>
<li><strong>Nonlinear Algorithms</strong>. Explore a suite of nonlinear and ensemble machine learning algorithms to see if they can lift performance, such as SVM and Random Forest.</li>
<li><strong>Multivariate Direct Models</strong>. Develop direct models that make use of all input variables for the prior week, not just the total daily power consumed. This will require flattening the 2D arrays of seven days of eight variables into 1D vectors.</li>
</ul>
<p>If you explore any of these extensions, I&#8217;d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>API</h3>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">pandas.read_csv API</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">pandas.DataFrame.resample API</a></li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">Resample Offset Aliases</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">sklearn.metrics.mean_squared_error API</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">numpy.split API</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Individual household electric power consumption Data Set, UCI Machine Learning Repository.</a></li>
<li><a href="https://en.wikipedia.org/wiki/AC_power">AC power, Wikipedia.</a></li>
<li><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/">4 Strategies for Multi-Step Time Series Forecasting</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop recursive and direct multi-step forecasting models with machine learning algorithms.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a framework for evaluating linear, nonlinear, and ensemble machine learning algorithms for multi-step time series forecasting.</li>
<li>How to evaluate machine learning algorithms using a recursive multi-step time series forecasting strategy.</li>
<li>How to evaluate machine learning algorithms using a direct per-day and per-lead time multi-step time series forecasting strategy.</li>
</ul>
<p>Do you have any questions?<br />
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52">			<div class="textwidget"><p><center><br />
<div class="woo-sc-hr"></div></p>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="/deep-learning-for-time-series-forecasting/"><img style="border: 0;" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" alt="Deep Learning for Time Series Forecasting" align="left" /></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>&#8230;with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br />
<a href="/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br />
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more&#8230;</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br />
<div class="woo-sc-hr"></div><br />
</center></p>
</div>
		</div></div>	</section><!-- /.entry -->
	<div class="fix"></div>
<aside id="post-author">
	<div class="profile-image"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' /></div>
	<div class="profile-content">
		<h4>About Jason Brownlee</h4>
		Jason Brownlee, Ph.D. is a machine learning specialist who teaches developers how to get results with modern machine learning methods via hands-on tutorials.				<div class="profile-link">
			<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">&rarr;</span>			</a>
		</div><!--#profile-link-->
			</div>
	<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
	        <div class="post-entries">
	            <div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-develop-an-autoregression-forecast-model-for-household-electricity-consumption/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop an Autoregression Forecast Model for Household Electricity Consumption</a></div>
	            <div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" rel="next">How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
	            <div class="fix"></div>
	        </div>

		<div id="comments">		 	<h3 id="comments-title">19 Responses to <em>Multi-step Time Series Forecasting with Machine Learning for Household Electricity Consumption</em></h3>
		 	<ol class="commentlist">
				
		<li id="comment-450740" class="comment even thread-even depth-1">

	      	<div id="li-comment-450740" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/fc003b843310a3976e3fbd8916257853?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/fc003b843310a3976e3fbd8916257853?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Rakesh</span>
	                <span class="date">October 5, 2018 at 6:13 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-450740" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>How do you handle seasonality in the time series when using machine learning?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-450740' onclick='return addComment.moveForm( "comment-450740", "450740", "respond", "6272" )' aria-label='Reply to Rakesh'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-450761" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-450761" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 5, 2018 at 2:28 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-450761" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You can calculate a seasonal difference or let the model learn the relationship.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-450761' onclick='return addComment.moveForm( "comment-450761", "450761", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451031" class="comment even thread-odd thread-alt depth-1">

	      	<div id="li-comment-451031" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Fei Sun</span>
	                <span class="date">October 9, 2018 at 5:55 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451031" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>When model use recursive forecasting strategy, I think the history should use<br />
                   &#8221; history.append(yhat)&#8221; </p>
<p>would you explan why using:&#8221; history.append(test[i, :])&#8221; in your model?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451031' onclick='return addComment.moveForm( "comment-451031", "451031", "respond", "6272" )' aria-label='Reply to Fei Sun'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451062" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-451062" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 9, 2018 at 8:47 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451062" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I explain the different strategies and when to use them here:<br />
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451062' onclick='return addComment.moveForm( "comment-451062", "451062", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451145" class="comment even thread-even depth-1">

	      	<div id="li-comment-451145" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 10, 2018 at 1:57 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451145" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason, thanks for the excellent and informative article. How would we observe the (46) predicted values for each day? </p>
<p>Also, the objective was to answer the question: &#8220;Given recent power consumption, what is the expected power consumption for the week ahead?&#8221;<br />
Therefore, how would we from these models create a 7 day future forecast?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451145' onclick='return addComment.moveForm( "comment-451145", "451145", "respond", "6272" )' aria-label='Reply to Marcus Harvey'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451180" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-451180" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 10, 2018 at 6:14 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451180" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You can choose a model and configuration, train a final model and start using it to make forecasts.</p>
<p>Perhaps I don&#8217;t follow, what problem are you having exactly?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451180' onclick='return addComment.moveForm( "comment-451180", "451180", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451479" class="comment even depth-3">

	      	<div id="li-comment-451479" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 12, 2018 at 8:07 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451479" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I can only see the RSME values for each model, when I think it would also be beneficial to see the predicted values. For example, it is possible that the SGD model doesn&#8217;t capture the trend as well as another model, despite the fact it has the lowest overall RSME. </p>
<p>How would I go about using one of these models for future forecasting? Is this simply an extension of the script, or would we have to create a separate piece of code elsewhere?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451479' onclick='return addComment.moveForm( "comment-451479", "451479", "respond", "6272" )' aria-label='Reply to Marcus Harvey'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451518" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4">

	      	<div id="li-comment-451518" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 13, 2018 at 6:12 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451518" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You can make a prediction by calling model.predict()</p>
<p>In fact, I show how and give a function to do it.</p>
<p>Which part is challenging? I&#8217;ll do my best to help.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451518' onclick='return addComment.moveForm( "comment-451518", "451518", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451708" class="comment even depth-5">

	      	<div id="li-comment-451708" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 16, 2018 at 12:29 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451708" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I have tried the following into a cell after we have plotted all the models:</p>
<p>for model in models.items():<br />
    model.predict(test)</p>
<p>But it comes back with the error: AttributeError: &#8216;tuple&#8217; object has no attribute &#8216;predict&#8217;.</p>
<p>I do not know where I would insert model.predict(), as every &#8220;section&#8221; kind of relies on the &#8220;section&#8221; above it. Likewise with the future forecasting.</p>

				
	                <div class="reply">
	                    	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->

		<li id="comment-451738" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5">

	      	<div id="li-comment-451738" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 16, 2018 at 6:38 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451738" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I recommend fitting a new final model on all available data and using it to make a prediction.</p>
<p>More here:<br />
<a href="https://machinelearningmastery.com/make-predictions-scikit-learn/" rel="nofollow">https://machinelearningmastery.com/make-predictions-scikit-learn/</a></p>

				
	                <div class="reply">
	                    	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->

		<li id="comment-451711" class="comment even depth-5">

	      	<div id="li-comment-451711" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 16, 2018 at 12:38 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451711" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Adding in: print predictions under the line: predictions = array(predictions), in the evaluate_model code does give me the predicted values, but as there are so many predictions the output is messy. Is there a way to obtain the average predicted value for each week?</p>

				
	                <div class="reply">
	                    	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->

		<li id="comment-451713" class="comment odd alt depth-5">

	      	<div id="li-comment-451713" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 16, 2018 at 12:45 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451713" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Apologies for flooding you with replies. Inserting: print(sum(predictions)/len(test)) under the predictions = array(predictions) line does the job. However I am still unsure how future forecasting is achieved.</p>

				
	                <div class="reply">
	                    	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451341" class="comment even thread-odd thread-alt depth-1">

	      	<div id="li-comment-451341" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/8f550c6c3b9face8ab00d72a5b32f014?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/8f550c6c3b9face8ab00d72a5b32f014?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Kais</span>
	                <span class="date">October 11, 2018 at 5:57 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451341" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason,</p>
<p>Really cool and interesting content we have here! Congrats on the great job you are doing!</p>
<p>Do you have any reference about what you mentioned &#8220;Multivariate Direct Models&#8221;?</p>
<p>Many Thanks</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451341' onclick='return addComment.moveForm( "comment-451341", "451341", "respond", "6272" )' aria-label='Reply to Kais'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451386" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2">

	      	<div id="li-comment-451386" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 12, 2018 at 6:36 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451386" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Yes, I have examples of direct models here:<br />
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/</a></p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451386' onclick='return addComment.moveForm( "comment-451386", "451386", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451792" class="comment even thread-even depth-1">

	      	<div id="li-comment-451792" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 16, 2018 at 9:07 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451792" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks for the advice Jason. I am almost there&#8230;</p>
<p>from sklearn.linear_model import SGDRegressor<br />
from pandas import read_csv</p>
<p>df = read_csv(&#8216;household_power_consumption_days.csv&#8217;, header=0, infer_datetime_format=True, parse_dates=[&#8216;datetime&#8217;], index_col=[&#8216;datetime&#8217;])</p>
<p>X_train = df.drop([&#8216;Global_active_power&#8217;],axis=1)<br />
Y_train = df[&#8216;Global_active_power&#8217;]</p>
<p>model = SGDRegressor(max_iter=1000, tol=1e-3)<br />
model.fit(X_train, Y_train)</p>
<p>Y_new = model.predict(X_new)</p>
<p># show the inputs and predicted outputs<br />
for i in range(len(X_new)):<br />
    print(&#8220;X_train=%s, Predicted=%s&#8221; % (X_new[i], Y_new[i]))</p>
<p>I cannot work out what to define X_new as? Let&#8217;s say, I would like the predictions for the next 3 days (11/27/2010,11/28/2010 and 11/29/2010)?  Also, would I need to drop the datetime column from Y_train?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451792' onclick='return addComment.moveForm( "comment-451792", "451792", "respond", "6272" )' aria-label='Reply to Marcus Harvey'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451800" class="comment odd alt depth-2">

	      	<div id="li-comment-451800" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 16, 2018 at 9:52 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451800" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>The make predictions article linked is for Regression. Surely it could not be used for Time Series future forecasting, as we do not know any of the future values for any of the features?</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451800' onclick='return addComment.moveForm( "comment-451800", "451800", "respond", "6272" )' aria-label='Reply to Marcus Harvey'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->

		<li id="comment-451841" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-451841" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 17, 2018 at 6:49 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451841" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Xnew is any input data required to make a prediction.</p>
<p>I explain exactly how to make a prediction here:<br />
<a href="https://machinelearningmastery.com/faq/single-faq/how-do-i-make-predictions" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-do-i-make-predictions</a></p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451841' onclick='return addComment.moveForm( "comment-451841", "451841", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451924" class="comment odd alt depth-3">

	      	<div id="li-comment-451924" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/45b1b2f307295d3a3c2741c0be54c690?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name">Marcus Harvey</span>
	                <span class="date">October 18, 2018 at 1:36 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451924" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>But we may have no input data to set as X_new. Future forecasts rely solely on the present data.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451924' onclick='return addComment.moveForm( "comment-451924", "451924", "respond", "6272" )' aria-label='Reply to Marcus Harvey'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451950" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-451950" class="comment-container">

					                <div class="avatar"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&#038;d=mm&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href='http://MachineLearningMastery.com' rel='external nofollow' class='url'>Jason Brownlee</a></span>
	                <span class="date">October 18, 2018 at 6:34 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#comment-451950" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You must frame your problem in such a way that the data you do have can be used to make a prediction.</p>

				
	                <div class="reply">
	                    <a rel='nofollow' class='comment-reply-link' href='#comment-451950' onclick='return addComment.moveForm( "comment-451950", "451950", "respond", "6272" )' aria-label='Reply to Jason Brownlee'>Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			</ol>
		 	</div>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/multi-step-time-series-forecasting-with-machine-learning-models-for-household-electricity-consumption/#respond" style="display:none;">Click here to cancel reply.</a></small></h3>			<form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea tabindex="4" id="comment" name="comment" cols="50" rows="10" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><input id="author" name="author" type="text" class="txt" tabindex="1" value="" size="30" aria-required='true' /><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input id="email" name="email" type="text" class="txt" tabindex="2" value="" size="30" aria-required='true' /><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input id="url" name="url" type="text" class="txt" tabindex="3" value="" size="30" /><label for="url">Website</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit Comment" /> <input type='hidden' name='comment_post_ID' value='6272' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="fc265f8d7f" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="179"/></p>			</form>
			</div><!-- #respond -->
	     
            </section><!-- /#main -->
                
            <aside id="sidebar">
<div id="woo_blogauthorinfo-2" class="widget widget_woo_blogauthorinfo"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt='' src='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&#038;d=mm&#038;r=g' srcset='https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&#038;d=mm&#038;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' /></span>
<p>Hi, I'm Jason Brownlee, Ph.D.
<br>
My goal is to make developers like <em>YOU</em> awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div id="text-51" class="widget widget_text">			<div class="textwidget"><p><center><br />
<strong>Deep Learning for Time Series</strong><br />
Forecast the future with MLPs, CNNs, and LSTMs.</p>
<p><a href="/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br />
<a href="/deep-learning-for-time-series-forecasting/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/08/Cover-220.png" /></a><br />
</center></p>
</div>
		</div>
		<div id="woo_tabs-2" class="widget widget_woo_tabs"> 		<div id="tabs">

            <ul class="wooTabs">
                                <li class="popular"><a href="#tab-pop">Popular</a></li>                                                            </ul>

            <div class="clear"></div>

            <div class="boxes box inside">

	            
                                <ul id="tab-pop" class="list">
                    	<li>
		<a href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/" title="How to Develop a Deep Learning Photo Caption Generator from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/09/example-150x150.jpg" class="thumbnail wp-post-image" alt="Photo of a dog at the beach." title="How to Develop a Deep Learning Photo Caption Generator from Scratch" /></a>		<a title="How to Develop a Deep Learning Photo Caption Generator from Scratch" href="https://machinelearningmastery.com/develop-a-deep-learning-caption-generation-model-in-python/">How to Develop a Deep Learning Photo Caption Generator from Scratch</a>
		<span class="meta">November 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Neural Machine Translation System in Keras" title="How to Develop a Neural Machine Translation System from Scratch" /></a>		<a title="How to Develop a Neural Machine Translation System from Scratch" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/">How to Develop a Neural Machine Translation System from Scratch</a>
		<span class="meta">January 10, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" /></a>		<a title="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</a>
		<span class="meta">October 26, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" /></a>		<a title="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a>
		<span class="meta">November 2, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" title="How to Use the Keras Functional API for Deep Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/multiple_inputs-150x150.png" class="thumbnail wp-post-image" alt="Neural Network Graph With Multiple Inputs" title="How to Use the Keras Functional API for Deep Learning" /></a>		<a title="How to Use the Keras Functional API for Deep Learning" href="https://machinelearningmastery.com/keras-functional-api-deep-learning/">How to Use the Keras Functional API for Deep Learning</a>
		<span class="meta">October 27, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-a-Word-Level-Neural-Language-Model-and-Use-it-to-Generate-Text-150x150.jpg" class="thumbnail wp-post-image" alt="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" /></a>		<a title="How to Develop a Word-Level Neural Language Model and Use it to Generate Text" href="https://machinelearningmastery.com/how-to-develop-a-word-level-neural-language-model-in-keras/">How to Develop a Word-Level Neural Language Model and Use it to Generate Text</a>
		<span class="meta">November 10, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img width="45" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Difference-Between-Classification-and-Regression-in-Machine-Learning-150x150.jpg" class="thumbnail wp-post-image" alt="Difference Between Classification and Regression in Machine Learning" title="Difference Between Classification and Regression in Machine Learning" /></a>		<a title="Difference Between Classification and Regression in Machine Learning" href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/">Difference Between Classification and Regression in Machine Learning</a>
		<span class="meta">December 11, 2017</span>
		<div class="fix"></div>
	</li>
	                </ul>
                                                                
            </div><!-- /.boxes -->

        </div><!-- /wooTabs -->

        </div>         <div id="custom_html-2" class="widget_text widget widget_custom_html"><h3>You might also like&#8230;</h3><div class="textwidget custom-html-widget"><ul>
	<li><a href="/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
  <li><a href="/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
	<li><a href="/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
	<li><a href="/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
	<li><a href="/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->

		</div><!-- /#main-sidebar-container -->         

		
    </div><!-- /#content -->
	
	<footer id="footer" class="col-full">

		
		<div id="copyright" class="col-left">
			<p>&copy; 2018 Machine Learning Mastery. All Rights Reserved. </p>		</div>

		<div id="credit" class="col-right">
			<p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/disclaimer/">Disclaimer</a> | 
<a href="/terms-of-service/">Terms</a> | 
<a href="/contact/">Contact</a>
</p></p>		</div>

	</footer>

	
	</div><!-- /#inner-wrapper -->

</div><!-- /#wrapper -->

<div class="fix"></div><!--/.fix-->

<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.4'></script>
<script type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.8'></script>
<script async="async" type='text/javascript' src='https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.8'></script>
</body>
</html>